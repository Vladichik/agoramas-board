/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{355:function(t,e,n){"use strict";(function(t){var e=n(306),r=n(305),o=n(310),c=n(307),h=n(356),f=n(308),b={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},l=function(t){function n(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(e.c)(n,t),n}(Error),d=new o.b("@firebase/firestore");function v(){return d.logLevel}function y(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(d.logLevel<=o.a.DEBUG){var i=n.map(I);d.debug.apply(d,Object(e.g)(["Firestore (8.0.0): "+t],i))}}function m(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(d.logLevel<=o.a.ERROR){var i=n.map(I);d.error.apply(d,Object(e.g)(["Firestore (8.0.0): "+t],i))}}function w(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(d.logLevel<=o.a.WARN){var i=n.map(I);d.warn.apply(d,Object(e.g)(["Firestore (8.0.0): "+t],i))}}function I(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function E(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.0.0) INTERNAL ASSERTION FAILED: "+t;throw m(e),new Error(e)}function _(t,e){t||E()}function T(t,e){return t}function O(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var A=function(){function t(){}return t.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=O(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function N(t,e){return t<e?-1:t>e?1:0}function S(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function D(t){return t+"\0"}var j=function(){function t(t){this.i=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.i,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.i)},t.prototype.o=function(){return 2*this.i.length},t.prototype.h=function(t){return N(this.i,t.i)},t.prototype.isEqual=function(t){return this.i===t.i},t}();j.u=new j("");var x=function(){function t(t){this.l=t}return t.fromBase64String=function(e){try{return new t(j.fromBase64String(e))}catch(e){throw new l(b.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(j.fromUint8Array(e))},t.prototype.toBase64=function(){return this.l.toBase64()},t.prototype.toUint8Array=function(){return this.l.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this.l.isEqual(t.l)},t}();function k(){if("undefined"==typeof Uint8Array)throw new l(b.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function q(){if("undefined"==typeof atob)throw new l(b.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var P=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n.fromBase64String=function(t){q();try{return new n(j.fromBase64String(t))}catch(t){throw new l(b.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},n.fromUint8Array=function(t){return k(),new n(j.fromUint8Array(t))},n.prototype.toBase64=function(){return q(),t.prototype.toBase64.call(this)},n.prototype.toUint8Array=function(){return k(),t.prototype.toUint8Array.call(this)},n.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},n}(x),L=function(t,e,n,r,i,o){this._=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.T=o},C=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"I",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.h=function(t){return N(this.projectId,t.projectId)||N(this.database,t.database)},t}();function V(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function R(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function M(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var U=function(){function t(t,e){this.m=t,this.A=e,this.R={}}return t.prototype.get=function(t){var e=this.m(t),n=this.R[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],u=o[0],s=o[1];if(this.A(u,t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.m(t),r=this.R[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.A(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.R[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.m(t),n=this.R[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.A(n[r][0],t))return 1===n.length?delete this.R[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){R(this.R,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],u=o[0],s=o[1];t(u,s)}}))},t.prototype.P=function(){return M(this.R)},t}(),F=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new l(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new l(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new l(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new l(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.g=function(t){return this.seconds===t.seconds?N(this.nanoseconds,t.nanoseconds):N(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),G=function(){function t(t){this.timestamp=t}return t.V=function(e){return new t(e)},t.min=function(){return new t(new F(0,0))},t.prototype.h=function(t){return this.timestamp.g(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.p=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.v=function(){return this.timestamp},t}(),B=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&E(),void 0===n?n=t.length-e:n>t.length-e&&E(),this.segments=t,this.offset=e,this.S=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.S},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.D(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.C(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.N=function(t){return t=void 0===t?1:t,this.C(this.segments,this.offset+t,this.length-t)},t.prototype.F=function(){return this.C(this.segments,this.offset,this.length-1)},t.prototype.k=function(){return this.segments[this.offset]},t.prototype.O=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.P=function(){return 0===this.length},t.prototype.M=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.$=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.L=function(){return this.segments.slice(this.offset,this.limit())},t.D=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),z=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n.prototype.C=function(t,e,r){return new n(t,e,r)},n.prototype.B=function(){return this.L().join("/")},n.prototype.toString=function(){return this.B()},n.q=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=[],i=0,o=t;i<o.length;i++){var u=o[i];if(u.indexOf("//")>=0)throw new l(b.INVALID_ARGUMENT,"Invalid segment ("+u+"). Paths must not contain // in them.");r.push.apply(r,u.split("/").filter((function(t){return t.length>0})))}return new n(r)},n.U=function(){return new n([])},n}(B),K=/^[_a-zA-Z][_a-zA-Z0-9]*$/,H=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n.prototype.C=function(t,e,r){return new n(t,e,r)},n.K=function(t){return K.test(t)},n.prototype.B=function(){return this.L().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),n.K(t)||(t="`"+t+"`"),t})).join(".")},n.prototype.toString=function(){return this.B()},n.prototype.W=function(){return 1===this.length&&"__name__"===this.get(0)},n.j=function(){return new n(["__name__"])},n.G=function(t){for(var e=[],r="",i=0,o=function(){if(0===r.length)throw new l(b.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(r),r=""},u=!1;i<t.length;){var s=t[i];if("\\"===s){if(i+1===t.length)throw new l(b.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[i+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new l(b.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=a,i+=2}else"`"===s?(u=!u,i++):"."!==s||u?(r+=s,i++):(o(),i++)}if(o(),u)throw new l(b.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)},n.U=function(){return new n([])},n}(B),W=function(){function t(t){this.path=t}return t.H=function(e){return new t(z.q(e))},t.J=function(e){return new t(z.q(e).N(5))},t.prototype.Y=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===z.D(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.D=function(t,e){return z.D(t.path,e.path)},t.X=function(t){return t.length%2==0},t.Z=function(e){return new t(new z(e.slice()))},t}();function X(t){return null==t}function Y(t){return 0===t&&1/t==-1/0}function Q(t){return"number"==typeof t&&Number.isInteger(t)&&!Y(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var rt=function(t,e,n,r,i,o,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=u,this.tt=null};function J(t,e,n,r,i,o,u){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===u&&(u=null),new rt(t,e,n,r,i,o,u)}function $(t){var e=T(t);if(null===e.tt){var n=e.path.B();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.B()+t.op.toString()+Bt(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return(e=t).field.B()+e.dir;var e})).join(","),X(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Kn(e.startAt)),e.endAt&&(n+="|ub:",n+=Kn(e.endAt)),e.tt=n}return e.tt}function Z(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Qn(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!Ut(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Wn(t.startAt,e.startAt)&&Wn(t.endAt,e.endAt)}function tt(t){return W.X(t.path)&&null===t.collectionGroup&&0===t.filters.length}var et,nt,it=function(){function t(t,e,n,r,i,o,u){void 0===i&&(i=G.min()),void 0===o&&(o=G.min()),void 0===u&&(u=j.u),this.target=t,this.targetId=e,this.et=n,this.sequenceNumber=r,this.nt=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u}return t.prototype.st=function(e){return new t(this.target,this.targetId,this.et,e,this.nt,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.it=function(e,n){return new t(this.target,this.targetId,this.et,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.rt=function(e){return new t(this.target,this.targetId,this.et,this.sequenceNumber,this.nt,e,this.resumeToken)},t}(),ot=function(t){this.count=t};function st(t){switch(t){case b.OK:return E();case b.CANCELLED:case b.UNKNOWN:case b.DEADLINE_EXCEEDED:case b.RESOURCE_EXHAUSTED:case b.INTERNAL:case b.UNAVAILABLE:case b.UNAUTHENTICATED:return!1;case b.INVALID_ARGUMENT:case b.NOT_FOUND:case b.ALREADY_EXISTS:case b.PERMISSION_DENIED:case b.FAILED_PRECONDITION:case b.ABORTED:case b.OUT_OF_RANGE:case b.UNIMPLEMENTED:case b.DATA_LOSS:return!0;default:return E()}}function ut(t){if(void 0===t)return m("GRPC error has no .code"),b.UNKNOWN;switch(t){case et.OK:return b.OK;case et.CANCELLED:return b.CANCELLED;case et.UNKNOWN:return b.UNKNOWN;case et.DEADLINE_EXCEEDED:return b.DEADLINE_EXCEEDED;case et.RESOURCE_EXHAUSTED:return b.RESOURCE_EXHAUSTED;case et.INTERNAL:return b.INTERNAL;case et.UNAVAILABLE:return b.UNAVAILABLE;case et.UNAUTHENTICATED:return b.UNAUTHENTICATED;case et.INVALID_ARGUMENT:return b.INVALID_ARGUMENT;case et.NOT_FOUND:return b.NOT_FOUND;case et.ALREADY_EXISTS:return b.ALREADY_EXISTS;case et.PERMISSION_DENIED:return b.PERMISSION_DENIED;case et.FAILED_PRECONDITION:return b.FAILED_PRECONDITION;case et.ABORTED:return b.ABORTED;case et.OUT_OF_RANGE:return b.OUT_OF_RANGE;case et.UNIMPLEMENTED:return b.UNIMPLEMENTED;case et.DATA_LOSS:return b.DATA_LOSS;default:return E()}}(nt=et||(et={}))[nt.OK=0]="OK",nt[nt.CANCELLED=1]="CANCELLED",nt[nt.UNKNOWN=2]="UNKNOWN",nt[nt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",nt[nt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",nt[nt.NOT_FOUND=5]="NOT_FOUND",nt[nt.ALREADY_EXISTS=6]="ALREADY_EXISTS",nt[nt.PERMISSION_DENIED=7]="PERMISSION_DENIED",nt[nt.UNAUTHENTICATED=16]="UNAUTHENTICATED",nt[nt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",nt[nt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",nt[nt.ABORTED=10]="ABORTED",nt[nt.OUT_OF_RANGE=11]="OUT_OF_RANGE",nt[nt.UNIMPLEMENTED=12]="UNIMPLEMENTED",nt[nt.INTERNAL=13]="INTERNAL",nt[nt.UNAVAILABLE=14]="UNAVAILABLE",nt[nt.DATA_LOSS=15]="DATA_LOSS";var dt=function(){function t(t,e){this.D=t,this.root=e||ct.EMPTY}return t.prototype.ot=function(e,n){return new t(this.D,this.root.ot(e,n,this.D).copy(null,null,ct.at,null,null))},t.prototype.remove=function(e){return new t(this.D,this.root.remove(e,this.D).copy(null,null,ct.at,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.P();){var n=this.D(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.P();){var r=this.D(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.P=function(){return this.root.P()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.ht=function(){return this.root.ht()},t.prototype.ct=function(){return this.root.ct()},t.prototype.ut=function(t){return this.root.ut(t)},t.prototype.forEach=function(t){this.ut((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.ut((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.lt=function(t){return this.root.lt(t)},t.prototype._t=function(){return new at(this.root,null,this.D,!1)},t.prototype.ft=function(t){return new at(this.root,t,this.D,!1)},t.prototype.dt=function(){return new at(this.root,null,this.D,!0)},t.prototype.wt=function(t){return new at(this.root,t,this.D,!0)},t}(),at=function(){function t(t,e,n,r){this.Et=r,this.Tt=[];for(var i=1;!t.P();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Et?t.left:t.right;else{if(0===i){this.Tt.push(t);break}this.Tt.push(t),t=this.Et?t.right:t.left}}return t.prototype.It=function(){var t=this.Tt.pop(),e={key:t.key,value:t.value};if(this.Et)for(t=t.left;!t.P();)this.Tt.push(t),t=t.right;else for(t=t.right;!t.P();)this.Tt.push(t),t=t.left;return e},t.prototype.At=function(){return this.Tt.length>0},t.prototype.Rt=function(){if(0===this.Tt.length)return null;var t=this.Tt[this.Tt.length-1];return{key:t.key,value:t.value}},t}(),ct=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.P=function(){return!1},t.prototype.ut=function(t){return this.left.ut(t)||t(this.key,this.value)||this.right.ut(t)},t.prototype.lt=function(t){return this.right.lt(t)||t(this.key,this.value)||this.left.lt(t)},t.prototype.min=function(){return this.left.P()?this:this.left.min()},t.prototype.ht=function(){return this.min().key},t.prototype.ct=function(){return this.right.P()?this.key:this.right.ct()},t.prototype.ot=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.ot(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.ot(t,e,n))).Pt()},t.prototype.gt=function(){if(this.left.P())return t.EMPTY;var e=this;return e.left.Vt()||e.left.left.Vt()||(e=e.yt()),(e=e.copy(null,null,null,e.left.gt(),null)).Pt()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.P()||i.left.Vt()||i.left.left.Vt()||(i=i.yt()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.Vt()&&(i=i.bt()),i.right.P()||i.right.Vt()||i.right.left.Vt()||(i=i.vt()),0===n(e,i.key)){if(i.right.P())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.gt())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.Pt()},t.prototype.Vt=function(){return this.color},t.prototype.Pt=function(){var t=this;return t.right.Vt()&&!t.left.Vt()&&(t=t.St()),t.left.Vt()&&t.left.left.Vt()&&(t=t.bt()),t.left.Vt()&&t.right.Vt()&&(t=t.Dt()),t},t.prototype.yt=function(){var t=this.Dt();return t.right.left.Vt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.bt())).St()).Dt()),t},t.prototype.vt=function(){var t=this.Dt();return t.left.left.Vt()&&(t=(t=t.bt()).Dt()),t},t.prototype.St=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.bt=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.Dt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.Ct=function(){var t=this.Nt();return Math.pow(2,t)<=this.size+1},t.prototype.Nt=function(){if(this.Vt()&&this.left.Vt())throw E();if(this.right.Vt())throw E();var t=this.left.Nt();if(t!==this.right.Nt())throw E();return t+(this.Vt()?0:1)},t}();ct.EMPTY=null,ct.RED=!0,ct.at=!1,ct.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw E()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw E()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw E()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw E()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw E()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.ot=function(t,e,n){return new ct(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.P=function(){return!0},t.prototype.ut=function(t){return!1},t.prototype.lt=function(t){return!1},t.prototype.ht=function(){return null},t.prototype.ct=function(){return null},t.prototype.Vt=function(){return!1},t.prototype.Ct=function(){return!0},t.prototype.Nt=function(){return 0},t}());var ht=function(){function t(t){this.D=t,this.data=new dt(this.D)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.ht()},t.prototype.last=function(){return this.data.ct()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.ut((function(e,n){return t(e),!1}))},t.prototype.xt=function(t,e){for(var n=this.data.ft(t[0]);n.At();){var r=n.It();if(this.D(r.key,t[1])>=0)return;e(r.key)}},t.prototype.Ft=function(t,e){var n;for(n=void 0!==e?this.data.ft(e):this.data._t();n.At();)if(!t(n.It().key))return},t.prototype.kt=function(t){var e=this.data.ft(t);return e.At()?e.It().key:null},t.prototype._t=function(){return new ft(this.data._t())},t.prototype.ft=function(t){return new ft(this.data.ft(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).ot(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.P=function(){return this.data.P()},t.prototype.Ot=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data._t(),r=e.data._t();n.At();){var i=n.It().key,o=r.It().key;if(0!==this.D(i,o))return!1}return!0},t.prototype.L=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.D);return n.data=e,n},t}(),ft=function(){function t(t){this.Mt=t}return t.prototype.It=function(){return this.Mt.It().key},t.prototype.At=function(){return this.Mt.At()},t}(),lt=new dt(W.D);function pt(){return lt}function vt(){return pt()}var yt=new dt(W.D);function gt(){return yt}var bt=new dt(W.D),mt=new ht(W.D);function wt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=mt,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var It=new ht(N);function Et(){return It}var _t=function(){function t(t){this.D=t?function(e,n){return t(e,n)||W.D(e.key,n.key)}:function(t,e){return W.D(t.key,e.key)},this.$t=gt(),this.Lt=new dt(this.D)}return t.Bt=function(e){return new t(e.D)},t.prototype.has=function(t){return null!=this.$t.get(t)},t.prototype.get=function(t){return this.$t.get(t)},t.prototype.first=function(){return this.Lt.ht()},t.prototype.last=function(){return this.Lt.ct()},t.prototype.P=function(){return this.Lt.P()},t.prototype.indexOf=function(t){var e=this.$t.get(t);return e?this.Lt.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.Lt.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.Lt.ut((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.$t.ot(t.key,t),e.Lt.ot(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.$t.remove(t),this.Lt.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.Lt._t(),r=e.Lt._t();n.At();){var i=n.It().key,o=r.It().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.D=this.D,r.$t=e,r.Lt=n,r},t}(),Tt=function(){function t(){this.qt=new dt(W.D)}return t.prototype.track=function(t){var e=t.doc.key,n=this.qt.get(e);n?0!==t.type&&3===n.type?this.qt=this.qt.ot(e,t):3===t.type&&1!==n.type?this.qt=this.qt.ot(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.qt=this.qt.ot(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.qt=this.qt.ot(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.qt=this.qt.remove(e):1===t.type&&2===n.type?this.qt=this.qt.ot(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.qt=this.qt.ot(e,{type:2,doc:t.doc}):E():this.qt=this.qt.ot(e,t)},t.prototype.Ut=function(){var t=[];return this.qt.ut((function(e,n){t.push(n)})),t},t}(),Ot=function(){function t(t,e,n,r,i,o,u,s){this.query=t,this.docs=e,this.Kt=n,this.docChanges=r,this.Qt=i,this.fromCache=o,this.Wt=u,this.jt=s}return t.Gt=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,_t.Bt(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.Qt.P()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Wt===t.Wt&&this.Qt.isEqual(t.Qt)&&xn(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Kt.isEqual(t.Kt)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),At=function(){function t(t,e,n,r,i){this.nt=t,this.zt=e,this.Ht=n,this.Jt=r,this.Yt=i}return t.Xt=function(e,n){var r=new Map;return r.set(e,Nt.Zt(e,n)),new t(G.min(),r,Et(),pt(),wt())},t}(),Nt=function(){function t(t,e,n,r,i){this.resumeToken=t,this.te=e,this.ee=n,this.ne=r,this.se=i}return t.Zt=function(e,n){return new t(j.u,n,wt(),wt(),wt())},t}(),St=function(t,e,n,r){this.ie=t,this.removedTargetIds=e,this.key=n,this.re=r},Dt=function(t,e){this.targetId=t,this.oe=e},jt=function(t,e,n,r){void 0===n&&(n=j.u),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},xt=function(){function t(){this.ae=0,this.he=Lt(),this.ce=j.u,this.ue=!1,this.le=!0}return Object.defineProperty(t.prototype,"te",{get:function(){return this.ue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.ce},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_e",{get:function(){return 0!==this.ae},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fe",{get:function(){return this.le},enumerable:!1,configurable:!0}),t.prototype.de=function(t){t.o()>0&&(this.le=!0,this.ce=t)},t.prototype.we=function(){var t=wt(),e=wt(),n=wt();return this.he.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:E()}})),new Nt(this.ce,this.ue,t,e,n)},t.prototype.Ee=function(){this.le=!1,this.he=Lt()},t.prototype.Te=function(t,e){this.le=!0,this.he=this.he.ot(t,e)},t.prototype.Ie=function(t){this.le=!0,this.he=this.he.remove(t)},t.prototype.me=function(){this.ae+=1},t.prototype.Ae=function(){this.ae-=1},t.prototype.Re=function(){this.le=!0,this.ue=!0},t}(),kt=function(){function t(t){this.Pe=t,this.ge=new Map,this.Ve=pt(),this.ye=Pt(),this.pe=new ht(N)}return t.prototype.be=function(t){for(var e=0,n=t.ie;e<n.length;e++){var r=n[e];t.re instanceof vn?this.ve(r,t.re):t.re instanceof yn&&this.Se(r,t.key,t.re)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var u=o[i];this.Se(u,t.key,t.re)}},t.prototype.De=function(t){var e=this;this.Ce(t,(function(n){var r=e.Ne(n);switch(t.state){case 0:e.xe(n)&&r.de(t.resumeToken);break;case 1:r.Ae(),r._e||r.Ee(),r.de(t.resumeToken);break;case 2:r.Ae(),r._e||e.removeTarget(n);break;case 3:e.xe(n)&&(r.Re(),r.de(t.resumeToken));break;case 4:e.xe(n)&&(e.Fe(n),r.de(t.resumeToken));break;default:E()}}))},t.prototype.Ce=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.ge.forEach((function(t,r){n.xe(r)&&e(r)}))},t.prototype.ke=function(t){var e=t.targetId,n=t.oe.count,r=this.Oe(e);if(r){var i=r.target;if(tt(i))if(0===n){var o=new W(i.path);this.Se(e,o,new yn(o,G.min()))}else _(1===n);else this.Me(e)!==n&&(this.Fe(e),this.pe=this.pe.add(e))}},t.prototype.$e=function(t){var e=this,n=new Map;this.ge.forEach((function(r,i){var o=e.Oe(i);if(o){if(r.te&&tt(o.target)){var u=new W(o.target.path);null!==e.Ve.get(u)||e.Le(i,u)||e.Se(i,u,new yn(u,t))}r.fe&&(n.set(i,r.we()),r.Ee())}}));var r=wt();this.ye.forEach((function(t,n){var i=!0;n.Ft((function(t){var n=e.Oe(t);return!n||2===n.et||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new At(t,n,this.pe,this.Ve,r);return this.Ve=pt(),this.ye=Pt(),this.pe=new ht(N),i},t.prototype.ve=function(t,e){if(this.xe(t)){var n=this.Le(t,e.key)?2:0;this.Ne(t).Te(e.key,n),this.Ve=this.Ve.ot(e.key,e),this.ye=this.ye.ot(e.key,this.Be(e.key).add(t))}},t.prototype.Se=function(t,e,n){if(this.xe(t)){var r=this.Ne(t);this.Le(t,e)?r.Te(e,1):r.Ie(e),this.ye=this.ye.ot(e,this.Be(e).delete(t)),n&&(this.Ve=this.Ve.ot(e,n))}},t.prototype.removeTarget=function(t){this.ge.delete(t)},t.prototype.Me=function(t){var e=this.Ne(t).we();return this.Pe.qe(t).size+e.ee.size-e.se.size},t.prototype.me=function(t){this.Ne(t).me()},t.prototype.Ne=function(t){var e=this.ge.get(t);return e||(e=new xt,this.ge.set(t,e)),e},t.prototype.Be=function(t){var e=this.ye.get(t);return e||(e=new ht(N),this.ye=this.ye.ot(t,e)),e},t.prototype.xe=function(t){var e=null!==this.Oe(t);return e||y("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.Oe=function(t){var e=this.ge.get(t);return e&&e._e?null:this.Pe.Ue(t)},t.prototype.Fe=function(t){var e=this;this.ge.set(t,new xt),this.Pe.qe(t).forEach((function(n){e.Se(t,n,null)}))},t.prototype.Le=function(t,e){return this.Pe.qe(t).has(e)},t}();function Pt(){return new dt(W.D)}function Lt(){return new dt(W.D)}function Ct(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Vt(t){var e=zt(t.mapValue.fields.__local_write_time__.timestampValue);return new F(e.seconds,e.nanos)}var Rt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mt(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ct(t)?4:10:E()}function Ut(t,e){var n=Mt(t);if(n!==Mt(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Vt(t).isEqual(Vt(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=zt(t.timestampValue),r=zt(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Ht(t.bytesValue).isEqual(Ht(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Kt(t.geoPointValue.latitude)===Kt(e.geoPointValue.latitude)&&Kt(t.geoPointValue.longitude)===Kt(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Kt(t.integerValue)===Kt(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Kt(t.doubleValue),r=Kt(e.doubleValue);return n===r?Y(n)===Y(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return S(t.arrayValue.values||[],e.arrayValue.values||[],Ut);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(V(n)!==V(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Ut(n[i],r[i])))return!1;return!0}(t,e);default:return E()}}function qt(t,e){return void 0!==(t.values||[]).find((function(t){return Ut(t,e)}))}function Ft(t,e){var n=Mt(t),r=Mt(e);if(n!==r)return N(n,r);switch(n){case 0:return 0;case 1:return N(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Kt(t.integerValue||t.doubleValue),r=Kt(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Gt(t.timestampValue,e.timestampValue);case 4:return Gt(Vt(t),Vt(e));case 5:return N(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Ht(t),r=Ht(e);return n.h(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=N(n[i],r[i]);if(0!==o)return o}return N(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=N(Kt(t.latitude),Kt(e.latitude));return 0!==n?n:N(Kt(t.longitude),Kt(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Ft(n[i],r[i]);if(o)return o}return N(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var u=0;u<r.length&&u<o.length;++u){var s=N(r[u],o[u]);if(0!==s)return s;var a=Ft(n[r[u]],i[o[u]]);if(0!==a)return a}return N(r.length,o.length)}(t.mapValue,e.mapValue);default:throw E()}}function Gt(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return N(t,e);var n=zt(t),r=zt(e),i=N(n.seconds,r.seconds);return 0!==i?i:N(n.nanos,r.nanos)}function Bt(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=zt(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ht(e.bytesValue).toBase64():"referenceValue"in e?(r=e.referenceValue,W.J(r).toString()):"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,o=0,i=e.values||[];o<i.length;o++)r?r=!1:n+=",",n+=t(i[o]);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,o=0,i=Object.keys(e.fields||{}).sort();o<i.length;o++){var c=i[o];r?r=!1:n+=",",n+=c+":"+t(e.fields[c])}return n+"}"}(e.mapValue):E();var n,r}(t)}function zt(t){if(_(!!t),"string"==typeof t){var e=0,n=Rt.exec(t);if(_(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Kt(t.seconds),nanos:Kt(t.nanos)}}function Kt(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ht(t){return"string"==typeof t?j.fromBase64String(t):j.fromUint8Array(t)}function Wt(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.B()}}function Xt(t){return!!t&&"integerValue"in t}function Yt(t){return!!t&&"arrayValue"in t}function Qt(t){return!!t&&"nullValue"in t}function Jt(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function $t(t){return!!t&&"mapValue"in t}var Zt={asc:"ASCENDING",desc:"DESCENDING"},te={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ee=function(t,e){this._=t,this.Ke=e};function ne(t){return{integerValue:""+t}}function re(t,e){if(t.Ke){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Y(e)?"-0":e}}function ie(t,e){return Q(e)?ne(e):re(t,e)}function oe(t,e){return t.Ke?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function se(t,e){return t.Ke?e.toBase64():e.toUint8Array()}function ue(t,e){return oe(t,e.v())}function ae(t){return _(!!t),G.V(function(t){var e=zt(t);return new F(e.seconds,e.nanos)}(t))}function ce(t,e){return function(t){return new z(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).B()}function he(t){var e=z.q(t);return _(ke(e)),e}function fe(t,e){return ce(t._,e.path)}function le(t,e){var n=he(e);return _(n.get(1)===t._.projectId),_(!n.get(3)&&!t._.database||n.get(3)===t._.database),new W(ye(n))}function pe(t,e){return ce(t._,e)}function de(t){var e=he(t);return 4===e.length?z.U():ye(e)}function ve(t){return new z(["projects",t._.projectId,"databases",t._.database]).B()}function ye(t){return _(t.length>4&&"documents"===t.get(4)),t.N(5)}function ge(t,e,n){return{name:fe(t,e),fields:n.proto.mapValue.fields}}function be(t,e){var n;if(e instanceof nn)n={update:ge(t,e.key,e.value)};else if(e instanceof cn)n={delete:fe(t,e.key)};else if(e instanceof rn)n={update:ge(t,e.key,e.data),updateMask:xe(e.Qe)};else if(e instanceof sn)n={transform:{document:fe(t,e.key),fieldTransforms:e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof Re)return{fieldPath:e.field.B(),setToServerValue:"REQUEST_TIME"};if(n instanceof Me)return{fieldPath:e.field.B(),appendMissingElements:{values:n.elements}};if(n instanceof qe)return{fieldPath:e.field.B(),removeAllFromArray:{values:n.elements}};if(n instanceof Ge)return{fieldPath:e.field.B(),increment:n.We};throw E()}(0,t)}))}};else{if(!(e instanceof hn))return E();n={verify:fe(t,e.key)}}return e.Ge.je||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ue(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:E()}(t,e.Ge)),n}function me(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Xe.updateTime(ae(t.updateTime)):void 0!==t.exists?Xe.exists(t.exists):Xe.ze()}(e.currentDocument):Xe.ze();if(e.update){e.update.name;var r=le(t,e.update.name),i=new fn({mapValue:{fields:e.update.fields}});if(e.updateMask){var o=function(t){var e=t.fieldPaths||[];return new Ke(e.map((function(t){return H.G(t)})))}(e.updateMask);return new rn(r,i,o,n)}return new nn(r,i,n)}if(e.delete){var u=le(t,e.delete);return new cn(u,n)}if(e.transform){var s=le(t,e.transform.document),a=e.transform.fieldTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)_("REQUEST_TIME"===e.setToServerValue),n=new Re;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new Me(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new qe(i)}else"increment"in e?n=new Ge(t,e.increment):E();var o=H.G(e.fieldPath);return new He(o,n)}(t,e)}));return _(!0===n.exists),new sn(s,a)}if(e.verify){var c=le(t,e.verify);return new hn(c,n)}return E()}function we(t,e){return{documents:[pe(t,e.path)]}}function Ie(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=pe(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=pe(t,r.F()),n.structuredQuery.from=[{collectionId:r.O()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(Jt(t.value))return{unaryFilter:{field:Ne(t.field),op:"IS_NAN"}};if(Qt(t.value))return{unaryFilter:{field:Ne(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Jt(t.value))return{unaryFilter:{field:Ne(t.field),op:"IS_NOT_NAN"}};if(Qt(t.value))return{unaryFilter:{field:Ne(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ne(t.field),op:Ae(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:Ne(t.field),direction:Oe(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var u=function(t,e){return t.Ke||X(e)?e:{value:e}}(t,e.limit);return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=_e(e.startAt)),e.endAt&&(n.structuredQuery.endAt=_e(e.endAt)),n}function Ee(t){var e=de(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){_(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var u=[];n.where&&(u=function t(e){return e?void 0!==e.unaryFilter?[je(e)]:void 0!==e.fieldFilter?[De(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):E():[]}(n.where));var s=[];n.orderBy&&(s=n.orderBy.map((function(t){return function(t){return new Xn(Se(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var a=null;n.limit&&(a=function(t){var e;return X(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Te(n.startAt));var h=null;return n.endAt&&(h=Te(n.endAt)),Nn(mn(e,i,s,u,a,"F",c,h))}function _e(t){return{before:t.before,values:t.position}}function Te(t){var e=!!t.before,n=t.values||[];return new tr(n,e)}function Oe(t){return Zt[t]}function Ae(t){return te[t]}function Ne(t){return{fieldPath:t.B()}}function Se(t){return H.G(t.fieldPath)}function De(t){return Vn.create(Se(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return E()}}(t.fieldFilter.op),t.fieldFilter.value)}function je(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Se(t.unaryFilter.field);return Vn.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Se(t.unaryFilter.field);return Vn.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Se(t.unaryFilter.field);return Vn.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Se(t.unaryFilter.field);return Vn.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return E()}}function xe(t){var e=[];return t.fields.forEach((function(t){return e.push(t.B())})),{fieldPaths:e}}function ke(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}var Pe=function(){this.He=void 0};function Le(t,e,n){return t instanceof Re?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Me?Ue(t,e):t instanceof qe?Fe(t,e):function(t,e){var n=Ve(t,e),r=Be(n)+Be(t.We);return Xt(n)&&Xt(t.We)?ne(r):re(t.serializer,r)}(t,e)}function Ce(t,e,n){return t instanceof Me?Ue(t,e):t instanceof qe?Fe(t,e):n}function Ve(t,e){return t instanceof Ge?Xt(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Re=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n}(Pe),Me=function(t){function n(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(e.c)(n,t),n}(Pe);function Ue(t,e){for(var n=ze(e),r=function(t){n.some((function(e){return Ut(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var qe=function(t){function n(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(e.c)(n,t),n}(Pe);function Fe(t,e){for(var n=ze(e),r=function(t){n=n.filter((function(e){return!Ut(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Ge=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).serializer=e,r.We=n,r}return Object(e.c)(n,t),n}(Pe);function Be(t){return Kt(t.integerValue||t.doubleValue)}function ze(t){return Yt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Ke=function(){function t(t){this.fields=t,t.sort(H.D)}return t.prototype.Je=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].M(t))return!0;return!1},t.prototype.isEqual=function(t){return S(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),He=function(t,e){this.field=t,this.transform=e},We=function(t,e){this.version=t,this.transformResults=e},Xe=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.ze=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"je",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Ye(t,e){return void 0!==t.updateTime?e instanceof vn&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof vn}var Qe=function(){};function Je(t,e,n){return t instanceof nn?function(t,e,n){return new vn(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof rn?function(t,e,n){if(!Ye(t.Ge,e))return new gn(t.key,n.version);var r=on(t,e);return new vn(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof sn?function(t,e,n){if(_(null!=n.transformResults),!Ye(t.Ge,e))return new gn(t.key,n.version);var r=un(t,e),i=function(t,e,n){var r=[];_(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],u=o.transform,s=null;e instanceof vn&&(s=e.field(o.field)),r.push(Ce(u,s,n[i]))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,u=an(t,r.data(),i);return new vn(t.key,o,u,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new yn(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function $e(t,e,n,r){return t instanceof nn?function(t,e){if(!Ye(t.Ge,e))return e;var n=en(e);return new vn(t.key,n,t.value,{Ye:!0})}(t,e):t instanceof rn?function(t,e){if(!Ye(t.Ge,e))return e;var n=en(e),r=on(t,e);return new vn(t.key,n,r,{Ye:!0})}(t,e):t instanceof sn?function(t,e,n,r){if(!Ye(t.Ge,e))return e;var i=un(t,e),o=function(t,e,n,r){for(var i=[],o=0,u=t;o<u.length;o++){var s=u[o],a=s.transform,c=null;n instanceof vn&&(c=n.field(s.field)),null===c&&r instanceof vn&&(c=r.field(s.field)),i.push(Le(a,c,e))}return i}(t.fieldTransforms,n,e,r),u=an(t,i.data(),o);return new vn(t.key,i.version,u,{Ye:!0})}(t,e,r,n):function(t,e){return Ye(t.Ge,e)?new yn(t.key,G.min()):e}(t,e)}function Ze(t,e){return t instanceof sn?function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],u=e instanceof vn?e.field(o.field):void 0,s=Ve(o.transform,u||null);null!=s&&(n=null==n?(new ln).set(o.field,s):n.set(o.field,s))}return n?n.Xe():null}(t,e):null}function tn(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ge.isEqual(e.Ge)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Qe.isEqual(e.Qe):2!==t.type||S(t.fieldTransforms,t.fieldTransforms,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Me&&e instanceof Me||t instanceof qe&&e instanceof qe?S(t.elements,e.elements,Ut):t instanceof Ge&&e instanceof Ge?Ut(t.We,e.We):t instanceof Re&&e instanceof Re}(t.transform,e.transform)}(t,e)})))}function en(t){return t instanceof vn?t.version:G.min()}var nn=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).key=e,i.value=n,i.Ge=r,i.type=0,i}return Object(e.c)(n,t),n}(Qe),rn=function(t){function n(e,n,r,i){var o=this;return(o=t.call(this)||this).key=e,o.data=n,o.Qe=r,o.Ge=i,o.type=1,o}return Object(e.c)(n,t),n}(Qe);function on(t,e){return function(t,e){var n=new ln(e);return t.Qe.fields.forEach((function(e){if(!e.P()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}})),n.Xe()}(t,e instanceof vn?e.data():fn.empty())}var sn=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.fieldTransforms=n,r.type=2,r.Ge=Xe.exists(!0),r}return Object(e.c)(n,t),n}(Qe);function un(t,e){return e}function an(t,e,n){for(var r=new ln(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Xe()}var cn=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ge=n,r.type=3,r}return Object(e.c)(n,t),n}(Qe),hn=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ge=n,r.type=4,r}return Object(e.c)(n,t),n}(Qe),fn=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.P())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!$t(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.O()])||null},t.prototype.isEqual=function(t){return Ut(this.proto,t.proto)},t}(),ln=function(){function t(t){void 0===t&&(t=fn.empty()),this.Ze=t,this.tn=new Map}return t.prototype.set=function(t,e){return this.en(t,e),this},t.prototype.delete=function(t){return this.en(t,null),this},t.prototype.en=function(t,e){for(var n=this.tn,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===Mt(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.O(),e)},t.prototype.Xe=function(){var t=this.nn(H.U(),this.tn);return null!=t?new fn(t):this.Ze},t.prototype.nn=function(t,e){var n=this,r=!1,i=this.Ze.field(t),o=$t(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var u=n.nn(t.child(i),e);null!=u&&(o[i]=u,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},t}();function pn(t){var e=[];return R(t.fields||{},(function(t,n){var r=new H([t]);if($t(n)){var i=pn(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,u=i;o<u.length;o++){var s=u[o];e.push(r.child(s))}}else e.push(r)})),new Ke(e)}var dn=function(t,e){this.key=t,this.version=e},vn=function(t){function n(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).sn=r,o.Ye=!!i.Ye,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return Object(e.c)(n,t),n.prototype.field=function(t){return this.sn.field(t)},n.prototype.data=function(){return this.sn},n.prototype.rn=function(){return this.sn.proto},n.prototype.isEqual=function(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ye===t.Ye&&this.hasCommittedMutations===t.hasCommittedMutations&&this.sn.isEqual(t.sn)},n.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.sn.toString()+", {hasLocalMutations: "+this.Ye+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return this.Ye||this.hasCommittedMutations},enumerable:!1,configurable:!0}),n}(dn),yn=function(t){function n(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return Object(e.c)(n,t),n.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){return t instanceof n&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},n}(dn),gn=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){return t instanceof n&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},n}(dn),bn=function(t,e,n,r,i,o,u,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===u&&(u=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.on=n,this.filters=r,this.limit=i,this.an=o,this.startAt=u,this.endAt=s,this.hn=null,this.cn=null,this.startAt,this.endAt};function mn(t,e,n,r,i,o,u,s){return new bn(t,e,n,r,i,o,u,s)}function wn(t){return new bn(t)}function In(t){return!X(t.limit)&&"F"===t.an}function En(t){return!X(t.limit)&&"L"===t.an}function _n(t){return t.on.length>0?t.on[0].field:null}function Tn(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.un())return r.field}return null}function On(t){return null!==t.collectionGroup}function An(t){var e=T(t);if(null===e.hn){e.hn=[];var n=Tn(e),r=_n(e);if(null!==n&&null===r)n.W()||e.hn.push(new Xn(n)),e.hn.push(new Xn(H.j(),"asc"));else{for(var i=!1,o=0,u=e.on;o<u.length;o++){var s=u[o];e.hn.push(s),s.field.W()&&(i=!0)}if(!i){var a=e.on.length>0?e.on[e.on.length-1].dir:"asc";e.hn.push(new Xn(H.j(),a))}}}return e.hn}function Nn(t){var e=T(t);if(!e.cn)if("F"===e.an)e.cn=J(e.path,e.collectionGroup,An(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=An(e);r<i.length;r++){var o=i[r],u="desc"===o.dir?"asc":"desc";n.push(new Xn(o.field,u))}var s=e.endAt?new tr(e.endAt.position,!e.endAt.before):null,a=e.startAt?new tr(e.startAt.position,!e.startAt.before):null;e.cn=J(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.cn}function Sn(t,e,n){return new bn(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Dn(t,e){return new bn(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),t.limit,t.an,e,t.endAt)}function jn(t,e){return new bn(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),t.limit,t.an,t.startAt,e)}function xn(t,e){return Z(Nn(t),Nn(e))&&t.an===e.an}function kn(t){return $(Nn(t))+"|lt:"+t.an}function Pn(t){return"Query(target="+function(t){var e=t.path.B();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.B()+" "+e.op+" "+Bt(e.value);var e})).join(", ")+"]"),X(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return(e=t).field.B()+" ("+e.dir+")";var e})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Kn(t.startAt)),t.endAt&&(e+=", endAt: "+Kn(t.endAt)),"Target("+e+")"}(Nn(t))+"; limitType="+t.an+")"}function Ln(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.Y(t.collectionGroup)&&t.path.M(n):W.X(t.path)?t.path.isEqual(n):t.path.$(n)}(t,e)&&function(t,e){for(var n=0,r=t.on;n<r.length;n++){var i=r[n];if(!i.field.W()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Hn(t.startAt,An(t),e)||t.endAt&&Hn(t.endAt,An(t),e))}(t,e)}function Cn(t){return function(e,n){for(var r=!1,i=0,o=An(t);i<o.length;i++){var u=o[i],s=Yn(u,e,n);if(0!==s)return s;r=r||u.field.W()}return 0}}var Vn=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(e.c)(n,t),n.create=function(t,e,r){return t.W()?"in"===e||"not-in"===e?this.ln(t,e,r):new Rn(t,e,r):"array-contains"===e?new Fn(t,r):"in"===e?new Gn(t,r):"not-in"===e?new Bn(t,r):"array-contains-any"===e?new zn(t,r):new n(t,e,r)},n.ln=function(t,e,n){return"in"===e?new Mn(t,n):new Un(t,n)},n.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this._n(Ft(e,this.value)):null!==e&&Mt(this.value)===Mt(e)&&this._n(Ft(e,this.value))},n.prototype._n=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return E()}},n.prototype.un=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},n}((function(){})),Rn=function(t){function n(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=W.J(r.referenceValue),i}return Object(e.c)(n,t),n.prototype.matches=function(t){var e=W.D(t.key,this.key);return this._n(e)},n}(Vn),Mn=function(t){function n(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=qn("in",n),r}return Object(e.c)(n,t),n.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},n}(Vn),Un=function(t){function n(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=qn("not-in",n),r}return Object(e.c)(n,t),n.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},n}(Vn);function qn(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return W.J(t.referenceValue)}))}var Fn=function(t){function n(e,n){return t.call(this,e,"array-contains",n)||this}return Object(e.c)(n,t),n.prototype.matches=function(t){var e=t.field(this.field);return Yt(e)&&qt(e.arrayValue,this.value)},n}(Vn),Gn=function(t){function n(e,n){return t.call(this,e,"in",n)||this}return Object(e.c)(n,t),n.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&qt(this.value.arrayValue,e)},n}(Vn),Bn=function(t){function n(e,n){return t.call(this,e,"not-in",n)||this}return Object(e.c)(n,t),n.prototype.matches=function(t){if(qt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.field(this.field);return null!==e&&!qt(this.value.arrayValue,e)},n}(Vn),zn=function(t){function n(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(e.c)(n,t),n.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!Yt(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return qt(e.value.arrayValue,t)}))},n}(Vn),tr=function(t,e){this.position=t,this.before=e};function Kn(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return Bt(t)})).join(",")}function Hn(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],u=t.position[i];if(r=o.field.W()?W.D(W.J(u.referenceValue),n.key):Ft(u,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Wn(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Ut(t.position[n],e.position[n]))return!1;return!0}var Xn=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Yn(t,e,n){var r=t.field.W()?W.D(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?Ft(r,i):E()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return E()}}function Qn(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var Jn=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},$n=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.fn=t,this.dn=e,this.wn=n,this.En=r,this.Tn=i,this.In=0,this.mn=null,this.An=Date.now(),this.reset()}return t.prototype.reset=function(){this.In=0},t.prototype.Rn=function(){this.In=this.Tn},t.prototype.Pn=function(t){var e=this;this.cancel();var n=Math.floor(this.In+this.gn()),r=Math.max(0,Date.now()-this.An),i=Math.max(0,n-r);i>0&&y("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.In+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.mn=this.fn.Vn(this.dn,i,(function(){return e.An=Date.now(),t()})),this.In*=this.En,this.In<this.wn&&(this.In=this.wn),this.In>this.Tn&&(this.In=this.Tn)},t.prototype.yn=function(){null!==this.mn&&(this.mn.pn(),this.mn=null)},t.prototype.cancel=function(){null!==this.mn&&(this.mn.cancel(),this.mn=null)},t.prototype.gn=function(){return(Math.random()-.5)*this.In},t}(),Zn=function(){function t(t){var e=this;this.bn=null,this.vn=null,this.result=void 0,this.error=void 0,this.Sn=!1,this.Dn=!1,t((function(t){e.Sn=!0,e.result=t,e.bn&&e.bn(t)}),(function(t){e.Sn=!0,e.error=t,e.vn&&e.vn(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.Dn&&E(),this.Dn=!0,this.Sn?this.error?this.Cn(n,this.error):this.Nn(e,this.result):new t((function(t,i){r.bn=function(n){r.Nn(e,n).next(t,i)},r.vn=function(e){r.Cn(n,e).next(t,i)}}))},t.prototype.xn=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.Fn=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.Nn=function(e,n){return e?this.Fn((function(){return e(n)})):t.resolve(n)},t.prototype.Cn=function(e,n){return e?this.Fn((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.kn=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.On=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.kn(r)},t}(),hr=function(){function n(t,e,r){this.name=t,this.version=e,this.Mn=r,12.2===n.$n(Object(c.p)())&&m("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return n.delete=function(t){return y("SimpleDb","Removing database:",t),sr(window.indexedDB.deleteDatabase(t)).xn()},n.Ln=function(){if("undefined"==typeof indexedDB)return!1;if(n.Bn())return!0;var t=Object(c.p)(),e=n.$n(t),r=0<e&&e<10,i=n.qn(t),o=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||o)},n.Bn=function(){var e;return void 0!==t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.Un)},n.Kn=function(t,e){return t.store(e)},n.$n=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},n.qn=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},n.prototype.Qn=function(t){return Object(e.b)(this,void 0,void 0,(function(){var n,r=this;return Object(e.d)(this,(function(e){switch(e.label){case 0:return this.db?[3,2]:(y("SimpleDb","Opening database:",this.name),n=this,[4,new Promise((function(e,n){var i=indexedDB.open(r.name,r.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){n(new nr(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var r=e.target.error;"VersionError"===r.name?n(new l(b.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new nr(t,r))},i.onupgradeneeded=function(t){y("SimpleDb",'Database "'+r.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;r.Mn.createOrUpgrade(e,i.transaction,t.oldVersion,r.version).next((function(){y("SimpleDb","Database upgrade to version "+r.version+" complete")}))}}))]);case 1:n.db=e.sent(),e.label=2;case 2:return[2,(this.Wn&&(this.db.onversionchange=function(t){return r.Wn(t)}),this.db)]}}))}))},n.prototype.jn=function(t){this.Wn=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},n.prototype.runTransaction=function(t,n,i,r){return Object(e.b)(this,void 0,void 0,(function(){var o,u,s,a,c;return Object(e.d)(this,(function(h){switch(h.label){case 0:o="readonly"===n,u=0,s=function(){var n,s,c,h,f;return Object(e.d)(this,(function(e){switch(e.label){case 0:++u,e.label=1;case 1:return e.trys.push([1,4,,5]),[4,a.Qn(t)];case 2:return a.db=e.sent(),n=ir.open(a.db,t,o?"readonly":"readwrite",i),s=r(n).catch((function(t){return n.abort(t),Zn.reject(t)})).xn(),c={},s.catch((function(){})),[4,n.Gn];case 3:return[2,(c.value=(e.sent(),s),c)];case 4:return h=e.sent(),f="FirebaseError"!==h.name&&u<3,y("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),a.close(),f?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}}))},a=this,h.label=1;case 1:return[5,s()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}}))}))},n.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},n}(),er=function(){function t(t){this.zn=t,this.Hn=!1,this.Jn=null}return Object.defineProperty(t.prototype,"Sn",{get:function(){return this.Hn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Yn",{get:function(){return this.Jn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.zn=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Hn=!0},t.prototype.Xn=function(t){this.Jn=t},t.prototype.delete=function(){return sr(this.zn.delete())},t}(),nr=function(t){function n(e,n){var r=this;return(r=t.call(this,b.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(e.c)(n,t),n}(l);function rr(t){return"IndexedDbTransactionError"===t.name}var ir=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.Zn=new Jn,this.transaction.oncomplete=function(){n.Zn.resolve()},this.transaction.onabort=function(){e.error?n.Zn.reject(new nr(t,e.error)):n.Zn.resolve()},this.transaction.onerror=function(e){var r=ar(e.target.error);n.Zn.reject(new nr(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new nr(n,e)}},Object.defineProperty(t.prototype,"Gn",{get:function(){return this.Zn.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.Zn.reject(t),this.aborted||(y("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new or(e)},t}(),or=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(y("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(y("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),sr(n)},t.prototype.add=function(t){return y("SimpleDb","ADD",this.store.name,t,t),sr(this.store.add(t))},t.prototype.get=function(t){var e=this;return sr(this.store.get(t)).next((function(n){return void 0===n&&(n=null),y("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return y("SimpleDb","DELETE",this.store.name,t),sr(this.store.delete(t))},t.prototype.count=function(){return y("SimpleDb","COUNT",this.store.name),sr(this.store.count())},t.prototype.ts=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.es(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.ns=function(t,e){y("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.ss=!1;var r=this.cursor(n);return this.es(r,(function(t,e,n){return n.delete()}))},t.prototype.rs=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.es(r,e)},t.prototype.os=function(t){var e=this.cursor({});return new Zn((function(n,r){e.onerror=function(t){var e=ar(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.es=function(t,e){var n=[];return new Zn((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new er(i),u=e(i.primaryKey,i.value,o);if(u instanceof Zn){var s=u.catch((function(t){return o.done(),Zn.reject(t)}));n.push(s)}o.Sn?r():null===o.Yn?i.continue():i.continue(o.Yn)}else r()}})).next((function(){return Zn.kn(n)}))},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.ss?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function sr(t){return new Zn((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=ar(t.target.error);n(e)}}))}var ur=!1;function ar(t){var e=hr.$n(Object(c.p)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new l("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return ur||(ur=!0,setTimeout((function(){throw r}),0)),r}}return t}function cr(){return"undefined"!=typeof window?window:null}function br(){return"undefined"!=typeof document?document:null}var fr=function(){function t(t,e,n,r,i){this.hs=t,this.dn=e,this.cs=n,this.op=r,this.us=i,this.ls=new Jn,this.then=this.ls.promise.then.bind(this.ls.promise),this.ls.promise.catch((function(t){}))}return t._s=function(e,n,r,i,o){var u=new t(e,n,Date.now()+r,i,o);return u.start(r),u},t.prototype.start=function(t){var e=this;this.fs=setTimeout((function(){return e.ds()}),t)},t.prototype.pn=function(){return this.ds()},t.prototype.cancel=function(t){null!==this.fs&&(this.clearTimeout(),this.ls.reject(new l(b.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.ds=function(){var t=this;this.hs.ws((function(){return null!==t.fs?(t.clearTimeout(),t.op().then((function(e){return t.ls.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.fs&&(this.us(this),clearTimeout(this.fs),this.fs=null)},t}(),lr=function(){function t(){var t=this;this.Es=Promise.resolve(),this.Ts=[],this.Is=!1,this.As=[],this.Rs=null,this.Ps=!1,this.gs=[],this.Vs=new $n(this,"async_queue_retry"),this.ys=function(){var e=br();e&&y("AsyncQueue","Visibility state changed to  ",e.visibilityState),t.Vs.yn()};var e=br();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.ys)}return Object.defineProperty(t.prototype,"ps",{get:function(){return this.Is},enumerable:!1,configurable:!0}),t.prototype.ws=function(t){this.enqueue(t)},t.prototype.bs=function(t){this.vs(),this.Ss(t)},t.prototype.Ds=function(){if(!this.Is){this.Is=!0;var t=br();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ys)}},t.prototype.enqueue=function(t){return this.vs(),this.Is?new Promise((function(t){})):this.Ss(t)},t.prototype.Cs=function(t){var e=this;this.ws((function(){return e.Ts.push(t),e.Ns()}))},t.prototype.Ns=function(){return Object(e.b)(this,void 0,void 0,(function(){var t,n=this;return Object(e.d)(this,(function(e){switch(e.label){case 0:if(0===this.Ts.length)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.Ts[0]()];case 2:return e.sent(),this.Ts.shift(),this.Vs.reset(),[3,4];case 3:if(!rr(t=e.sent()))throw t;return y("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.Ts.length>0&&this.Vs.Pn((function(){return n.Ns()})),e.label=5;case 5:return[2]}}))}))},t.prototype.Ss=function(t){var e=this,n=this.Es.then((function(){return e.Ps=!0,t().catch((function(t){throw e.Rs=t,e.Ps=!1,m("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.Ps=!1,t}))}));return this.Es=n,n},t.prototype.Vn=function(t,e,n){var r=this;this.vs(),this.gs.indexOf(t)>-1&&(e=0);var i=fr._s(this,t,e,n,(function(t){return r.xs(t)}));return this.As.push(i),i},t.prototype.vs=function(){this.Rs&&E()},t.prototype.Fs=function(){},t.prototype.ks=function(){return Object(e.b)(this,void 0,void 0,(function(){var t;return Object(e.d)(this,(function(e){switch(e.label){case 0:return[4,t=this.Es];case 1:e.sent(),e.label=2;case 2:if(t!==this.Es)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.Os=function(t){for(var e=0,n=this.As;e<n.length;e++)if(n[e].dn===t)return!0;return!1},t.prototype.Ms=function(t){var e=this;return this.ks().then((function(){e.As.sort((function(t,e){return t.cs-e.cs}));for(var n=0,r=e.As;n<r.length;n++){var i=r[n];if(i.pn(),"all"!==t&&i.dn===t)break}return e.ks()}))},t.prototype.$s=function(t){this.gs.push(t)},t.prototype.xs=function(t){var e=this.As.indexOf(t);this.As.splice(e,1)},t}();function pr(t,e){if(m("AsyncQueue",e+": "+t),rr(t))return new l(b.UNAVAILABLE,e+": "+t);throw t}var dr=function(){this.Ls=void 0,this.listeners=[]},vr=function(){this.Bs=new U((function(t){return kn(t)}),xn),this.onlineState="Unknown",this.qs=new Set};function yr(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u,s,a,c;return Object(e.d)(this,(function(e){switch(e.label){case 0:if(r=T(t),i=n.query,o=!1,(u=r.Bs.get(i))||(o=!0,u=new dr),!o)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),s=u,[4,r.Us(i)];case 2:return s.Ls=e.sent(),[3,4];case 3:return a=e.sent(),c=pr(a,"Initialization of query '"+Pn(n.query)+"' failed"),[2,void n.onError(c)];case 4:return r.Bs.set(i,u),u.listeners.push(n),n.Ks(r.onlineState),u.Ls&&n.Qs(u.Ls)&&Ir(r),[2]}}))}))}function gr(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u,s;return Object(e.d)(this,(function(e){return r=T(t),i=n.query,o=!1,(u=r.Bs.get(i))&&(s=u.listeners.indexOf(n))>=0&&(u.listeners.splice(s,1),o=0===u.listeners.length),o?[2,(r.Bs.delete(i),r.Ws(i))]:[2]}))}))}function mr(t,e){for(var n=T(t),r=!1,i=0,o=e;i<o.length;i++){var u=o[i],s=u.query,a=n.Bs.get(s);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].Qs(u)&&(r=!0);a.Ls=u}}r&&Ir(n)}function wr(t,e,n){var r=T(t),i=r.Bs.get(e);if(i)for(var o=0,u=i.listeners;o<u.length;o++)u[o].onError(n);r.Bs.delete(e)}function Ir(t){t.qs.forEach((function(t){t.next()}))}var Er=function(){function t(t,e,n){this.query=t,this.js=e,this.Gs=!1,this.zs=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Qs=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Ot(t.query,t.docs,t.Kt,e,t.Qt,t.fromCache,t.Wt,!0)}var o=!1;return this.Gs?this.Hs(t)&&(this.js.next(t),o=!0):this.Js(t,this.onlineState)&&(this.Ys(t),o=!0),this.zs=t,o},t.prototype.onError=function(t){this.js.error(t)},t.prototype.Ks=function(t){this.onlineState=t;var e=!1;return this.zs&&!this.Gs&&this.Js(this.zs,t)&&(this.Ys(this.zs),e=!0),e},t.prototype.Js=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Xs&&n||t.docs.P()&&"Offline"!==e)},t.prototype.Hs=function(t){if(t.docChanges.length>0)return!0;var e=this.zs&&this.zs.hasPendingWrites!==t.hasPendingWrites;return!(!t.Wt&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.Ys=function(t){t=Ot.Gt(t.query,t.docs,t.Qt,t.fromCache),this.Gs=!0,this.js.next(t)},t}(),_r=function(){function t(t){this.uid=t}return t.prototype.Zs=function(){return null!=this.uid},t.prototype.ti=function(){return this.Zs()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();_r.UNAUTHENTICATED=new _r(null),_r.ei=new _r("google-credentials-uid"),_r.ni=new _r("first-party-uid");var Tr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.si=function(t){return n.ii(t)},this.ri=function(t){return e.oi(t)})}return t.prototype.ii=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.ri&&this.ri(t),t},t}();function Or(t,e){return"firestore_clients_"+t+"_"+e}function Ar(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Zs()&&(r+="_"+e.uid),r}function Nr(t,e){return"firestore_targets_"+t+"_"+e}Tr.ai=-1;var Sr=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.hi=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),u=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(u=new l(i.error.code,i.error.message)),o?new t(e,n,i.state,u):(m("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Dr=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.hi=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new l(r.error.code,r.error.message)),i?new t(e,r.state,o):(m("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),jr=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.hi=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Et(),u=0;i&&u<r.activeTargetIds.length;++u)i=Q(r.activeTargetIds[u]),o=o.add(r.activeTargetIds[u]);return i?new t(e,o):(m("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),xr=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.hi=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(m("SharedClientState","Failed to parse online state: "+e),null)},t}(),kr=function(){function t(){this.activeTargetIds=Et()}return t.prototype.ui=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.li=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.ci=function(){var t={activeTargetIds:this.activeTargetIds.L(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Pr=function(){function t(t,e,n,r,i){this.window=t,this.fn=e,this.persistenceKey=n,this._i=r,this.fi=null,this.di=null,this.si=null,this.wi=this.Ei.bind(this),this.Ti=new dt(N),this.Ii=!1,this.mi=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ai=Or(this.persistenceKey,this._i),this.Ri=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Ti=this.Ti.ot(this._i,new kr),this.Pi=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.gi=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Vi=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.yi=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.wi)}return t.Ln=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(e.b)(this,void 0,void 0,(function(){var t,n,r,i,o,u,s,a,c,h,f,l=this;return Object(e.d)(this,(function(e){switch(e.label){case 0:return[4,this.fi.pi()];case 1:for(t=e.sent(),n=0,r=t;n<r.length;n++)(i=r[n])!==this._i&&(o=this.getItem(Or(this.persistenceKey,i)))&&(u=jr.hi(i,o))&&(this.Ti=this.Ti.ot(u.clientId,u));for(this.bi(),(s=this.storage.getItem(this.yi))&&(a=this.vi(s))&&this.Si(a),c=0,h=this.mi;c<h.length;c++)f=h[c],this.Ei(f);return this.mi=[],this.window.addEventListener("unload",(function(){return l.Di()})),this.Ii=!0,[2]}}))}))},t.prototype.oi=function(t){this.setItem(this.Ri,JSON.stringify(t))},t.prototype.Ci=function(){return this.Ni(this.Ti)},t.prototype.xi=function(t){var e=!1;return this.Ti.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.Fi=function(t){this.ki(t,"pending")},t.prototype.Oi=function(t,e,n){this.ki(t,e,n),this.Mi(t)},t.prototype.$i=function(t){var e="not-current";if(this.xi(t)){var n=this.storage.getItem(Nr(this.persistenceKey,t));if(n){var r=Dr.hi(t,n);r&&(e=r.state)}}return this.Li.ui(t),this.bi(),e},t.prototype.Bi=function(t){this.Li.li(t),this.bi()},t.prototype.qi=function(t){return this.Li.activeTargetIds.has(t)},t.prototype.Ui=function(t){this.removeItem(Nr(this.persistenceKey,t))},t.prototype.Ki=function(t,e,n){this.Qi(t,e,n)},t.prototype.Wi=function(t,e,n){var r=this;e.forEach((function(t){r.Mi(t)})),this.currentUser=t,n.forEach((function(t){r.Fi(t)}))},t.prototype.ji=function(t){this.Gi(t)},t.prototype.Di=function(){this.Ii&&(this.window.removeEventListener("storage",this.wi),this.removeItem(this.Ai),this.Ii=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return y("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){y("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){y("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Ei=function(t){var n=this,i=t;if(i.storageArea===this.storage){if(y("SharedClientState","EVENT",i.key,i.newValue),i.key===this.Ai)return void m("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.fn.Cs((function(){return Object(e.b)(n,void 0,void 0,(function(){var t,n,r,o,u,s;return Object(e.d)(this,(function(e){if(this.Ii){if(null!==i.key)if(this.Pi.test(i.key)){if(null==i.newValue)return t=this.zi(i.key),[2,this.Hi(t,null)];if(n=this.Ji(i.key,i.newValue))return[2,this.Hi(n.clientId,n)]}else if(this.gi.test(i.key)){if(null!==i.newValue&&(r=this.Yi(i.key,i.newValue)))return[2,this.Xi(r)]}else if(this.Vi.test(i.key)){if(null!==i.newValue&&(o=this.Zi(i.key,i.newValue)))return[2,this.tr(o)]}else if(i.key===this.yi){if(null!==i.newValue&&(u=this.vi(i.newValue)))return[2,this.Si(u)]}else i.key===this.Ri&&(s=function(t){var e=Tr.ai;if(null!=t)try{var n=JSON.parse(t);_("number"==typeof n),e=n}catch(t){m("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(i.newValue))!==Tr.ai&&this.si(s)}else this.mi.push(i);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Li",{get:function(){return this.Ti.get(this._i)},enumerable:!1,configurable:!0}),t.prototype.bi=function(){this.setItem(this.Ai,this.Li.ci())},t.prototype.ki=function(t,e,n){var r=new Sr(this.currentUser,t,e,n),i=Ar(this.persistenceKey,this.currentUser,t);this.setItem(i,r.ci())},t.prototype.Mi=function(t){var e=Ar(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Gi=function(t){var e={clientId:this._i,onlineState:t};this.storage.setItem(this.yi,JSON.stringify(e))},t.prototype.Qi=function(t,e,n){var r=Nr(this.persistenceKey,t),i=new Dr(t,e,n);this.setItem(r,i.ci())},t.prototype.zi=function(t){var e=this.Pi.exec(t);return e?e[1]:null},t.prototype.Ji=function(t,e){var n=this.zi(t);return jr.hi(n,e)},t.prototype.Yi=function(t,e){var n=this.gi.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Sr.hi(new _r(i),r,e)},t.prototype.Zi=function(t,e){var n=this.Vi.exec(t),r=Number(n[1]);return Dr.hi(r,e)},t.prototype.vi=function(t){return xr.hi(t)},t.prototype.Xi=function(t){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.fi.er(t.batchId,t.state,t.error)]:(y("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.tr=function(t){return this.fi.nr(t.targetId,t.state,t.error)},t.prototype.Hi=function(t,e){var n=this,r=e?this.Ti.ot(t,e):this.Ti.remove(t),i=this.Ni(this.Ti),o=this.Ni(r),u=[],s=[];return o.forEach((function(t){i.has(t)||u.push(t)})),i.forEach((function(t){o.has(t)||s.push(t)})),this.fi.sr(u,s).then((function(){n.Ti=r}))},t.prototype.Si=function(t){this.Ti.get(t.clientId)&&this.di(t.onlineState)},t.prototype.Ni=function(t){var e=Et();return t.forEach((function(t,n){e=e.Ot(n.activeTargetIds)})),e},t}(),Lr=function(){function t(){this.ir=new kr,this.rr={},this.di=null,this.si=null}return t.prototype.Fi=function(t){},t.prototype.Oi=function(t,e,n){},t.prototype.$i=function(t){return this.ir.ui(t),this.rr[t]||"not-current"},t.prototype.Ki=function(t,e,n){this.rr[t]=e},t.prototype.Bi=function(t){this.ir.li(t)},t.prototype.qi=function(t){return this.ir.activeTargetIds.has(t)},t.prototype.Ui=function(t){delete this.rr[t]},t.prototype.Ci=function(){return this.ir.activeTargetIds},t.prototype.xi=function(t){return this.ir.activeTargetIds.has(t)},t.prototype.start=function(){return this.ir=new kr,Promise.resolve()},t.prototype.Wi=function(t,e,n){},t.prototype.ji=function(t){},t.prototype.Di=function(){},t.prototype.oi=function(t){},t}(),Cr=function(){function t(t,e,n,r){this.batchId=t,this.ar=e,this.baseMutations=n,this.mutations=r}return t.prototype.hr=function(t,e,n){for(var r=n.cr,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=Je(o,e,r[i]))}return e},t.prototype.ur=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=$e(i,e,e,this.ar))}for(var o=e,u=0,s=this.mutations;u<s.length;u++){var a=s[u];a.key.isEqual(t)&&(e=$e(a,e,o,this.ar))}return e},t.prototype.lr=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.ur(r.key,t.get(r.key));i&&(n=n.ot(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),wt())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&S(this.mutations,t.mutations,(function(t,e){return tn(t,e)}))&&S(this.baseMutations,t.baseMutations,(function(t,e){return tn(t,e)}))},t}(),Vr=function(){function t(t,e,n,r){this.batch=t,this._r=e,this.cr=n,this.dr=r}return t.from=function(e,n,r){_(e.mutations.length===r.length);for(var i=bt,o=e.mutations,u=0;u<o.length;u++)i=i.ot(o[u].key,r[u].version);return new t(e,n,r,i)},t}(),Rr=function(){function t(){this.wr=new U((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.Er=!1}return Object.defineProperty(t.prototype,"readTime",{get:function(){return this.Tr},set:function(t){this.Tr=t},enumerable:!1,configurable:!0}),t.prototype.Ir=function(t,e){this.mr(),this.readTime=e,this.wr.set(t.key,t)},t.prototype.Ar=function(t,e){this.mr(),e&&(this.readTime=e),this.wr.set(t,null)},t.prototype.Rr=function(t,e){this.mr();var n=this.wr.get(e);return void 0!==n?Zn.resolve(n):this.Pr(t,e)},t.prototype.getEntries=function(t,e){return this.gr(t,e)},t.prototype.apply=function(t){return this.mr(),this.Er=!0,this.Vr(t)},t.prototype.mr=function(){},t}(),Mr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ur=function(){function t(){this.yr=[]}return t.prototype.pr=function(t){this.yr.push(t)},t.prototype.br=function(){this.yr.forEach((function(t){return t()}))},t}(),qr=function(){function t(t,e,n){this.vr=t,this.Sr=e,this.Dr=n}return t.prototype.Cr=function(t,e){var n=this;return this.Sr.Nr(t,e).next((function(r){return n.Fr(t,e,r)}))},t.prototype.Fr=function(t,e,n){return this.vr.Rr(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].ur(e,t);return t}))},t.prototype.kr=function(t,e,n){var r=vt();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].ur(t,e);r=r.ot(t,e)})),r},t.prototype.Or=function(t,e){var n=this;return this.vr.getEntries(t,e).next((function(e){return n.Mr(t,e)}))},t.prototype.Mr=function(t,e){var n=this;return this.Sr.$r(t,e).next((function(r){var i=n.kr(t,e,r),o=pt();return i.forEach((function(t,e){e||(e=new yn(t,G.min())),o=o.ot(t,e)})),o}))},t.prototype.Lr=function(t,e,n){return function(t){return W.X(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Br(t,e.path):On(e)?this.qr(t,e,n):this.Ur(t,e,n)},t.prototype.Br=function(t,e){return this.Cr(t,new W(e)).next((function(t){var e=gt();return t instanceof vn&&(e=e.ot(t.key,t)),e}))},t.prototype.qr=function(t,e,n){var r=this,i=e.collectionGroup,o=gt();return this.Dr.Kr(t,i).next((function(u){return Zn.forEach(u,(function(u){var s=function(t,e){return new bn(e,null,t.on.slice(),t.filters.slice(),t.limit,t.an,t.startAt,t.endAt)}(e,u.child(i));return r.Ur(t,s,n).next((function(t){t.forEach((function(t,e){o=o.ot(t,e)}))}))})).next((function(){return o}))}))},t.prototype.Ur=function(t,e,n){var r,i,o=this;return this.vr.Lr(t,e,n).next((function(n){return r=n,o.Sr.Qr(t,e)})).next((function(e){return i=e,o.Wr(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],u=0,s=o.mutations;u<s.length;u++){var a=s[u],c=a.key,h=r.get(c),f=$e(a,h,h,o.ar);r=f instanceof vn?r.ot(c,f):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){Ln(e,n)||(r=r.remove(t))})),r}))},t.prototype.Wr=function(t,e,n){for(var r=wt(),i=0,o=e;i<o.length;i++)for(var u=0,s=o[i].mutations;u<s.length;u++){var a=s[u];a instanceof rn&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.vr.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof vn&&(c=c.ot(t,e))})),c}))},t}(),Fr=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.jr=n,this.Gr=r}return t.zr=function(e,n){for(var r=wt(),i=wt(),o=0,u=n.docChanges;o<u.length;o++){var s=u[o];switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}}return new t(e,n.fromCache,r,i)},t}();function Gr(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],u=N(n,i);return 0===u?N(r,o):u}var Br=function(){function t(t){this.Hr=t,this.buffer=new ht(Gr),this.Jr=0}return t.prototype.Yr=function(){return++this.Jr},t.prototype.Xr=function(t){var e=[t,this.Yr()];if(this.buffer.size<this.Hr)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Gr(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),zr={Zr:!1,eo:0,no:0,so:0},Kr=function(){function t(t,e,n){this.io=t,this.ro=e,this.oo=n}return t.ao=function(e){return new t(e,t.ho,t.co)},t}();Kr.uo=-1,Kr.lo=1048576,Kr._o=41943040,Kr.ho=10,Kr.co=1e3,Kr.fo=new Kr(Kr._o,Kr.ho,Kr.co),Kr.do=new Kr(Kr.uo,0,0);var Hr=function(){function t(t,e){this.wo=t,this.hs=e,this.Eo=!1,this.To=null}return t.prototype.start=function(t){this.wo.params.io!==Kr.uo&&this.Io(t)},t.prototype.stop=function(){this.To&&(this.To.cancel(),this.To=null)},Object.defineProperty(t.prototype,"Ii",{get:function(){return null!==this.To},enumerable:!1,configurable:!0}),t.prototype.Io=function(t){var n=this,i=this.Eo?3e5:6e4;y("LruGarbageCollector","Garbage collection scheduled in "+i+"ms"),this.To=this.hs.Vn("lru_garbage_collection",i,(function(){return Object(e.b)(n,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){switch(e.label){case 0:this.To=null,this.Eo=!0,e.label=1;case 1:return e.trys.push([1,3,,7]),[4,t.mo(this.wo)];case 2:return e.sent(),[3,7];case 3:return rr(n=e.sent())?(y("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n),[3,6]):[3,4];case 4:return[4,fo(n)];case 5:e.sent(),e.label=6;case 6:return[3,7];case 7:return[4,this.Io(t)];case 8:return e.sent(),[2]}}))}))}))},t}(),Wr=function(){function t(t,e){this.Ao=t,this.params=e}return t.prototype.Ro=function(t,e){return this.Ao.Po(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.Vo=function(t,e){var n=this;if(0===e)return Zn.resolve(Tr.ai);var r=new Br(e);return this.Ao.Ce(t,(function(t){return r.Xr(t.sequenceNumber)})).next((function(){return n.Ao.yo(t,(function(t){return r.Xr(t)}))})).next((function(){return r.maxValue}))},t.prototype.po=function(t,e,n){return this.Ao.po(t,e,n)},t.prototype.bo=function(t,e){return this.Ao.bo(t,e)},t.prototype.vo=function(t,e){var n=this;return this.params.io===Kr.uo?(y("LruGarbageCollector","Garbage collection skipped; disabled"),Zn.resolve(zr)):this.So(t).next((function(r){return r<n.params.io?(y("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.io),zr):n.Do(t,e)}))},t.prototype.So=function(t){return this.Ao.So(t)},t.prototype.Do=function(t,e){var n,r,i,c,s,a,h,f=this,l=Date.now();return this.Ro(t,this.params.ro).next((function(e){return e>f.params.oo?(y("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+f.params.oo+" from "+e),r=f.params.oo):r=e,c=Date.now(),f.Vo(t,r)})).next((function(r){return n=r,s=Date.now(),f.po(t,n,e)})).next((function(e){return i=e,a=Date.now(),f.bo(t,n)})).next((function(t){return h=Date.now(),v()<=o.a.DEBUG&&y("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(c-l)+"ms\n\tDetermined least recently used "+r+" in "+(s-c)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(h-a)+"ms\nTotal Duration: "+(h-l)+"ms"),Zn.resolve({Zr:!0,eo:r,no:i,so:t})}))},t}();function Xr(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Qr(e)),e=Yr(t.get(n),e);return Qr(e)}function Yr(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Qr(t){return t+""}function Jr(t){var e=t.length;if(_(e>=2),2===e)return _(""===t.charAt(0)&&""===t.charAt(1)),z.U();for(var n=e-2,r=[],i="",o=0;o<e;){var u=t.indexOf("",o);switch((u<0||u>n)&&E(),t.charAt(u+1)){case"":var s=t.substring(o,u),a=void 0;0===i.length?a=s:(a=i+=s,i=""),r.push(a);break;case"":i+=t.substring(o,u),i+="\0";break;case"":i+=t.substring(o,u+1);break;default:E()}o=u+2}return new z(r)}var $r=function(t){this.Co=t};function Zr(t,e){if(e.document)return function(t,e,n){var r=le(t,e.name),i=ae(e.updateTime),o=new fn({mapValue:{fields:e.fields}});return new vn(r,i,o,{hasCommittedMutations:!!n})}(t.Co,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=W.Z(e.noDocument.path),r=ri(e.noDocument.readTime);return new yn(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=W.Z(e.unknownDocument.path),o=ri(e.unknownDocument.version);return new gn(i,o)}return E()}function ti(t,e,n){var r=ei(n),i=e.key.path.F().L();if(e instanceof vn){var o=function(t,e){return{name:fe(t,e.key),fields:e.rn().mapValue.fields,updateTime:oe(t,e.version.v())}}(t.Co,e),u=e.hasCommittedMutations;return new ji(null,null,o,u,r,i)}if(e instanceof yn){var s=e.key.path.L(),a=li(e.version),c=e.hasCommittedMutations;return new ji(null,new Si(s,a),null,c,r,i)}if(e instanceof gn){var h=e.key.path.L(),f=li(e.version);return new ji(new Di(h,f),null,null,!0,r,i)}return E()}function ei(t){var e=t.v();return[e.seconds,e.nanoseconds]}function ni(t){var e=new F(t[0],t[1]);return G.V(e)}function li(t){var e=t.v();return new _i(e.seconds,e.nanoseconds)}function ri(t){var e=new F(t.seconds,t.nanoseconds);return G.V(e)}function ii(t,e){var n=(e.baseMutations||[]).map((function(e){return me(t.Co,e)})),r=e.mutations.map((function(e){return me(t.Co,e)})),i=F.fromMillis(e.localWriteTimeMs);return new Cr(e.batchId,i,n,r)}function oi(t){var e,n,r=ri(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?ri(t.lastLimboFreeSnapshotVersion):G.min();return void 0!==t.query.documents?(_(1===(n=t.query).documents.length),e=Nn(wn(de(n.documents[0])))):e=Ee(t.query),new it(e,t.targetId,0,t.lastListenSequenceNumber,r,i,j.fromBase64String(t.resumeToken))}function si(t,e){var n,r=li(e.nt),i=li(e.lastLimboFreeSnapshotVersion);n=tt(e.target)?we(t.Co,e.target):Ie(t.Co,e.target);var o=e.resumeToken.toBase64();return new ki(e.targetId,$(e.target),r,o,e.sequenceNumber,i,n)}var ui=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.Dr=n,this.No=r,this.xo={}}return t.Fo=function(e,n,r,i){return _(""!==e.uid),new t(e.Zs()?e.uid:"",n,r,i)},t.prototype.ko=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return hi(t).rs({index:Ai.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.Oo=function(t,e,n,r){var i=this,o=fi(t),u=hi(t);return u.add({}).next((function(s){_("number"==typeof s);for(var a=new Cr(s,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return be(t.Co,e)})),i=n.mutations.map((function(e){return be(t.Co,e)}));return new Ai(e,n.batchId,n.ar.toMillis(),r,i)}(i.serializer,i.userId,a),h=[],f=new ht((function(t,e){return N(t.B(),e.B())})),l=0,p=r;l<p.length;l++){var d=p[l],v=Ni.key(i.userId,d.key.path,s);f=f.add(d.key.path.F()),h.push(u.put(c)),h.push(o.put(v,Ni.PLACEHOLDER))}return f.forEach((function(e){h.push(i.Dr.Mo(t,e))})),t.pr((function(){i.xo[s]=a.keys()})),Zn.kn(h).next((function(){return a}))}))},t.prototype.$o=function(t,e){var n=this;return hi(t).get(e).next((function(t){return t?(_(t.userId===n.userId),ii(n.serializer,t)):null}))},t.prototype.Lo=function(t,e){var n=this;return this.xo[e]?Zn.resolve(this.xo[e]):this.$o(t,e).next((function(t){if(t){var r=t.keys();return n.xo[e]=r,r}return null}))},t.prototype.Bo=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return hi(t).rs({index:Ai.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(_(e.batchId>=r),o=ii(n.serializer,e)),i.done()})).next((function(){return o}))},t.prototype.qo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return hi(t).rs({index:Ai.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.Uo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return hi(t).ts(Ai.userMutationsIndex,n).next((function(t){return t.map((function(t){return ii(e.serializer,t)}))}))},t.prototype.Nr=function(t,e){var n=this,r=Ni.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return fi(t).rs({range:i},(function(r,i,u){var s=r[0],a=r[1],c=r[2],h=Jr(a);if(s===n.userId&&e.path.isEqual(h))return hi(t).get(c).next((function(t){if(!t)throw E();_(t.userId===n.userId),o.push(ii(n.serializer,t))}));u.done()})).next((function(){return o}))},t.prototype.$r=function(t,e){var n=this,r=new ht(N),i=[];return e.forEach((function(e){var o=Ni.prefixForPath(n.userId,e.path),u=IDBKeyRange.lowerBound(o),s=fi(t).rs({range:u},(function(t,i,o){var u=t[0],s=t[1],a=t[2],c=Jr(s);u===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()}));i.push(s)})),Zn.kn(i).next((function(){return n.Ko(t,r)}))},t.prototype.Qr=function(t,e){var n=this,r=e.path,i=r.length+1,o=Ni.prefixForPath(this.userId,r),u=IDBKeyRange.lowerBound(o),s=new ht(N);return fi(t).rs({range:u},(function(t,e,o){var u=t[0],a=t[1],c=t[2],h=Jr(a);u===n.userId&&r.M(h)?h.length===i&&(s=s.add(c)):o.done()})).next((function(){return n.Ko(t,s)}))},t.prototype.Ko=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(hi(t).get(e).next((function(t){if(null===t)throw E();_(t.userId===n.userId),r.push(ii(n.serializer,t))})))})),Zn.kn(i).next((function(){return r}))},t.prototype.Qo=function(t,e){var n=this;return ci(t.Wo,this.userId,e).next((function(r){return t.pr((function(){n.jo(e.batchId)})),Zn.forEach(r,(function(e){return n.No.Go(t,e)}))}))},t.prototype.jo=function(t){delete this.xo[t]},t.prototype.zo=function(t){var e=this;return this.ko(t).next((function(n){if(!n)return Zn.resolve();var r=IDBKeyRange.lowerBound(Ni.prefixForUser(e.userId)),i=[];return fi(t).rs({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Jr(t[1]);i.push(o)}else r.done()})).next((function(){_(0===i.length)}))}))},t.prototype.Ho=function(t,e){return ai(t,this.userId,e)},t.prototype.Jo=function(t){var e=this;return pi(t).get(this.userId).next((function(t){return t||new Oi(e.userId,-1,"")}))},t}();function ai(t,e,n){var r=Ni.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),u=!1;return fi(t).rs({range:o,ss:!0},(function(t,n,r){var o=t[0],s=t[1];t[2],o===e&&s===i&&(u=!0),r.done()})).next((function(){return u}))}function ci(t,e,n){var r=t.store(Ai.store),i=t.store(Ni.store),o=[],u=IDBKeyRange.only(n.batchId),s=0,a=r.rs({range:u},(function(t,e,n){return s++,n.delete()}));o.push(a.next((function(){_(1===s)})));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=Ni.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return Zn.kn(o).next((function(){return c}))}function hi(t){return Xi.Kn(t,Ai.store)}function fi(t){return Xi.Kn(t,Ni.store)}function pi(t){return Xi.Kn(t,Oi.store)}var di=function(){function t(t,e){this.serializer=t,this.Dr=e}return t.prototype.Ir=function(t,e,n){return gi(t).put(bi(e),n)},t.prototype.Ar=function(t,e){var n=gi(t),r=bi(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.Yo(t,r)}))},t.prototype.Rr=function(t,e){var n=this;return gi(t).get(bi(e)).next((function(t){return n.Xo(t)}))},t.prototype.Zo=function(t,e){var n=this;return gi(t).get(bi(e)).next((function(t){var e=n.Xo(t);return e?{ta:e,size:mi(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=vt();return this.ea(t,e,(function(t,e){var i=n.Xo(e);r=r.ot(t,i)})).next((function(){return r}))},t.prototype.na=function(t,e){var n=this,r=vt(),i=new dt(W.D);return this.ea(t,e,(function(t,e){var o=n.Xo(e);o?(r=r.ot(t,o),i=i.ot(t,mi(e))):(r=r.ot(t,null),i=i.ot(t,0))})).next((function(){return{sa:r,ia:i}}))},t.prototype.ea=function(t,e,n){if(e.P())return Zn.resolve();var r=IDBKeyRange.bound(e.first().path.L(),e.last().path.L()),i=e._t(),o=i.It();return gi(t).rs({range:r},(function(t,e,r){for(var u=W.Z(t);o&&W.D(o,u)<0;)n(o,null),o=i.It();o&&o.isEqual(u)&&(n(o,e),o=i.At()?i.It():null),o?r.Xn(o.path.L()):r.done()})).next((function(){for(;o;)n(o,null),o=i.At()?i.It():null}))},t.prototype.Lr=function(t,e,n){var r=this,i=gt(),o=e.path.length+1,u={};if(n.isEqual(G.min())){var s=e.path.L();u.range=IDBKeyRange.lowerBound(s)}else{var a=e.path.L(),c=ei(n);u.range=IDBKeyRange.lowerBound([a,c],!0),u.index=ji.collectionReadTimeIndex}return gi(t).rs(u,(function(t,n,u){if(t.length===o){var s=Zr(r.serializer,n);e.path.M(s.key.path)?s instanceof vn&&Ln(e,s)&&(i=i.ot(s.key,s)):u.done()}})).next((function(){return i}))},t.prototype.ra=function(t){return new vi(this,!!t&&t.oa)},t.prototype.aa=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return yi(t).get(xi.key).next((function(t){return _(!!t),t}))},t.prototype.Yo=function(t,e){return yi(t).put(xi.key,e)},t.prototype.Xo=function(t){if(t){var e=Zr(this.serializer,t);return e instanceof yn&&e.version.isEqual(G.min())?null:e}return null},t}(),vi=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).ha=e,r.oa=n,r.ca=new U((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return Object(e.c)(n,t),n.prototype.Vr=function(t){var e=this,n=[],r=0,i=new ht((function(t,e){return N(t.B(),e.B())}));return this.wr.forEach((function(o,u){var s=e.ca.get(o);if(u){var a=ti(e.ha.serializer,u,e.readTime);i=i.add(o.path.F());var c=mi(a);r+=c-s,n.push(e.ha.Ir(t,o,a))}else if(r-=s,e.oa){var h=ti(e.ha.serializer,new yn(o,G.min()),e.readTime);n.push(e.ha.Ir(t,o,h))}else n.push(e.ha.Ar(t,o))})),i.forEach((function(r){n.push(e.ha.Dr.Mo(t,r))})),n.push(this.ha.updateMetadata(t,r)),Zn.kn(n)},n.prototype.Pr=function(t,e){var n=this;return this.ha.Zo(t,e).next((function(t){return null===t?(n.ca.set(e,0),null):(n.ca.set(e,t.size),t.ta)}))},n.prototype.gr=function(t,e){var n=this;return this.ha.na(t,e).next((function(t){var e=t.sa;return t.ia.forEach((function(t,e){n.ca.set(t,e)})),e}))},n}(Rr);function yi(t){return Xi.Kn(t,xi.store)}function gi(t){return Xi.Kn(t,ji.store)}function bi(t){return t.path.L()}function mi(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw E();e=t.noDocument}return JSON.stringify(e).length}var wi=function(){function t(){this.ua=new Ii}return t.prototype.Mo=function(t,e){return this.ua.add(e),Zn.resolve()},t.prototype.Kr=function(t,e){return Zn.resolve(this.ua.getEntries(e))},t}(),Ii=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.O(),n=t.F(),r=this.index[e]||new ht(z.D),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.O(),n=t.F(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new ht(z.D)).L()},t}(),Ei=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;_(n<r&&n>=0&&r<=10);var o=new ir("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Ti.store)}(t),function(t){t.createObjectStore(Oi.store,{keyPath:Oi.keyPath}),t.createObjectStore(Ai.store,{keyPath:Ai.keyPath,autoIncrement:!0}).createIndex(Ai.userMutationsIndex,Ai.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Ni.store)}(t),Vi(t),function(t){t.createObjectStore(ji.store)}(t));var u=Zn.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Pi.store),t.deleteObjectStore(ki.store),t.deleteObjectStore(Li.store)}(t),Vi(t)),u=u.next((function(){return function(t){var e=t.store(Li.store),n=new Li(0,0,G.min().v(),0);return e.put(Li.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(u=u.next((function(){return function(t,e){return e.store(Ai.store).ts().next((function(n){t.deleteObjectStore(Ai.store),t.createObjectStore(Ai.store,{keyPath:Ai.keyPath,autoIncrement:!0}).createIndex(Ai.userMutationsIndex,Ai.userMutationsKeyPath,{unique:!0});var r=e.store(Ai.store),i=n.map((function(t){return r.put(t)}));return Zn.kn(i)}))}(t,o)}))),u=u.next((function(){!function(t){t.createObjectStore(Ri.store,{keyPath:Ri.keyPath})}(t)}))),n<5&&r>=5&&(u=u.next((function(){return i.removeAcknowledgedMutations(o)}))),n<6&&r>=6&&(u=u.next((function(){return function(t){t.createObjectStore(xi.store)}(t),i.addDocumentGlobal(o)}))),n<7&&r>=7&&(u=u.next((function(){return i.ensureSequenceNumbers(o)}))),n<8&&r>=8&&(u=u.next((function(){return i.createCollectionParentIndex(t,o)}))),n<9&&r>=9&&(u=u.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(ji.store);e.createIndex(ji.readTimeIndex,ji.readTimeIndexPath,{unique:!1}),e.createIndex(ji.collectionReadTimeIndex,ji.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(u=u.next((function(){return i.rewriteCanonicalIds(o)}))),u},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(ji.store).rs((function(t,n){e+=mi(n)})).next((function(){var n=new xi(e);return t.store(xi.store).put(xi.key,n)}))},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(Oi.store),r=t.store(Ai.store);return n.ts().next((function(n){return Zn.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.ts(Ai.userMutationsIndex,i).next((function(r){return Zn.forEach(r,(function(r){_(r.userId===n.userId);var i=ii(e.serializer,r);return ci(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Pi.store),n=t.store(ji.store);return t.store(Li.store).get(Li.key).next((function(t){var r=[];return n.rs((function(n,i){var o=new z(n),u=function(t){return[0,Xr(t)]}(o);r.push(e.get(u).next((function(n){return n?Zn.resolve():function(n){return e.put(new Pi(0,Xr(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return Zn.kn(r)}))}))},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(Ci.store,{keyPath:Ci.keyPath});var n=e.store(Ci.store),r=new Ii,i=function(t){if(r.add(t)){var e=t.O(),i=t.F();return n.put({collectionId:e,parent:Xr(i)})}};return e.store(ji.store).rs({ss:!0},(function(t,e){var n=new z(t);return i(n.F())})).next((function(){return e.store(Ni.store).rs({ss:!0},(function(t,e){t[0];var n=t[1],r=(t[2],Jr(n));return i(r.F())}))}))},t.prototype.rewriteCanonicalIds=function(t){var e=this,n=t.store(ki.store);return n.rs((function(t,r){var i=oi(r),o=si(e.serializer,i);return n.put(o)}))},t}(),_i=function(t,e){this.seconds=t,this.nanoseconds=e},Ti=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Ti.store="owner",Ti.key="owner";var Oi=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Oi.store="mutationQueues",Oi.keyPath="userId";var Ai=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Ai.store="mutations",Ai.keyPath="batchId",Ai.userMutationsIndex="userMutationsIndex",Ai.userMutationsKeyPath=["userId","batchId"];var Ni=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Xr(e)]},t.key=function(t,e,n){return[t,Xr(e),n]},t}();Ni.store="documentMutations",Ni.PLACEHOLDER=new Ni;var Si=function(t,e){this.path=t,this.readTime=e},Di=function(t,e){this.path=t,this.version=e},ji=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};ji.store="remoteDocuments",ji.readTimeIndex="readTimeIndex",ji.readTimeIndexPath="readTime",ji.collectionReadTimeIndex="collectionReadTimeIndex",ji.collectionReadTimeIndexPath=["parentPath","readTime"];var xi=function(t){this.byteSize=t};xi.store="remoteDocumentGlobal",xi.key="remoteDocumentGlobalKey";var ki=function(t,e,n,r,i,o,u){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=u};ki.store="targets",ki.keyPath="targetId",ki.queryTargetsIndexName="queryTargetsIndex",ki.queryTargetsKeyPath=["canonicalId","targetId"];var Pi=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Pi.store="targetDocuments",Pi.keyPath=["targetId","path"],Pi.documentTargetsIndex="documentTargetsIndex",Pi.documentTargetsKeyPath=["path","targetId"];var Li=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Li.key="targetGlobalKey",Li.store="targetGlobal";var Ci=function(t,e){this.collectionId=t,this.parent=e};function Vi(t){t.createObjectStore(Pi.store,{keyPath:Pi.keyPath}).createIndex(Pi.documentTargetsIndex,Pi.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(ki.store,{keyPath:ki.keyPath}).createIndex(ki.queryTargetsIndexName,ki.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Li.store)}Ci.store="collectionParents",Ci.keyPath=["collectionId","parent"];var Ri=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Ri.store="clientMetadata",Ri.keyPath="clientId";var Mi=Object(e.g)(Object(e.g)(Object(e.g)([Oi.store,Ai.store,Ni.store,ji.store,ki.store,Ti.store,Li.store,Pi.store],[Ri.store]),[xi.store]),[Ci.store]),Ui=function(){function t(){this.la=new Ii}return t.prototype.Mo=function(t,e){var n=this;if(!this.la.has(e)){var r=e.O(),i=e.F();t.pr((function(){n.la.add(e)}));var o={collectionId:r,parent:Xr(i)};return qi(t).put(o)}return Zn.resolve()},t.prototype.Kr=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[D(e),""],!1,!0);return qi(t).ts(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Jr(o.parent))}return n}))},t}();function qi(t){return Xi.Kn(t,Ci.store)}var Fi=function(){function t(t){this._a=t}return t.prototype.next=function(){return this._a+=2,this._a},t.fa=function(){return new t(0)},t.da=function(){return new t(-1)},t}(),Gi=function(){function t(t,e){this.No=t,this.serializer=e}return t.prototype.wa=function(t){var e=this;return this.Ea(t).next((function(n){var r=new Fi(n.highestTargetId);return n.highestTargetId=r.next(),e.Ta(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.Ia=function(t){return this.Ea(t).next((function(t){return G.V(new F(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.ma=function(t){return this.Ea(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.Aa=function(t,e,n){var r=this;return this.Ea(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.v()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Ta(t,i)}))},t.prototype.Ra=function(t,e){var n=this;return this.Pa(t,e).next((function(){return n.Ea(t).next((function(r){return r.targetCount+=1,n.ga(e,r),n.Ta(t,r)}))}))},t.prototype.Va=function(t,e){return this.Pa(t,e)},t.prototype.ya=function(t,e){var n=this;return this.pa(t,e.targetId).next((function(){return Bi(t).delete(e.targetId)})).next((function(){return n.Ea(t)})).next((function(e){return _(e.targetCount>0),e.targetCount-=1,n.Ta(t,e)}))},t.prototype.po=function(t,e,n){var r=this,i=0,o=[];return Bi(t).rs((function(u,s){var a=oi(s);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.ya(t,a)))})).next((function(){return Zn.kn(o)})).next((function(){return i}))},t.prototype.Ce=function(t,e){return Bi(t).rs((function(t,n){var r=oi(n);e(r)}))},t.prototype.Ea=function(t){return zi(t).get(Li.key).next((function(t){return _(null!==t),t}))},t.prototype.Ta=function(t,e){return zi(t).put(Li.key,e)},t.prototype.Pa=function(t,e){return Bi(t).put(si(this.serializer,e))},t.prototype.ga=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.ba=function(t){return this.Ea(t).next((function(t){return t.targetCount}))},t.prototype.va=function(t,e){var n=$(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Bi(t).rs({range:r,index:ki.queryTargetsIndexName},(function(t,n,r){var o=oi(n);Z(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.Sa=function(t,e,n){var r=this,i=[],o=Ki(t);return e.forEach((function(e){var u=Xr(e.path);i.push(o.put(new Pi(n,u))),i.push(r.No.Da(t,n,e))})),Zn.kn(i)},t.prototype.Ca=function(t,e,n){var r=this,i=Ki(t);return Zn.forEach(e,(function(e){var o=Xr(e.path);return Zn.kn([i.delete([n,o]),r.No.Na(t,n,e)])}))},t.prototype.pa=function(t,e){var n=Ki(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.xa=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Ki(t),i=wt();return r.rs({range:n,ss:!0},(function(t,e,n){var r=Jr(t[1]),o=new W(r);i=i.add(o)})).next((function(){return i}))},t.prototype.Ho=function(t,e){var n=Xr(e.path),r=IDBKeyRange.bound([n],[D(n)],!1,!0),i=0;return Ki(t).rs({index:Pi.documentTargetsIndex,ss:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.Ue=function(t,e){return Bi(t).get(e).next((function(t){return t?oi(t):null}))},t}();function Bi(t){return Xi.Kn(t,ki.store)}function zi(t){return Xi.Kn(t,Li.store)}function Ki(t){return Xi.Kn(t,Pi.store)}var Hi="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Wi=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).Wo=e,r.Fa=n,r}return Object(e.c)(n,t),n}(Ur),Xi=function(){function t(e,n,r,i,o,u,s,a,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.fn=o,this.window=u,this.document=s,this.ka=c,this.Oa=h,this.Ma=null,this.$a=!1,this.isPrimary=!1,this.networkEnabled=!0,this.La=null,this.inForeground=!1,this.Ba=null,this.qa=null,this.Ua=Number.NEGATIVE_INFINITY,this.Ka=function(t){return Promise.resolve()},!t.Ln())throw new l(b.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.No=new Ji(this,i),this.Qa=n+"main",this.serializer=new $r(a),this.Wa=new hr(this.Qa,10,new Ei(this.serializer)),this.ja=new Gi(this.No,this.serializer),this.Dr=new Ui,this.vr=function(t,e){return new di(t,e)}(this.serializer,this.Dr),this.window&&this.window.localStorage?this.Ga=this.window.localStorage:(this.Ga=null,!1===h&&m("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.Kn=function(t,e){if(t instanceof Wi)return hr.Kn(t.Wo,e);throw E()},t.prototype.start=function(){var t=this;return this.za().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new l(b.FAILED_PRECONDITION,Hi);return t.Ha(),t.Ja(),t.Ya(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.ja.ma(e)}))})).then((function(e){t.Ma=new Tr(e,t.ka)})).then((function(){t.$a=!0})).catch((function(e){return t.Wa&&t.Wa.close(),Promise.reject(e)}))},t.prototype.Xa=function(t){var n=this;return this.Ka=function(i){return Object(e.b)(n,void 0,void 0,(function(){return Object(e.d)(this,(function(e){return this.Ii?[2,t(i)]:[2]}))}))},t(this.isPrimary)},t.prototype.Za=function(t){var n=this;this.Wa.jn((function(i){return Object(e.b)(n,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return null===i.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.th=function(t){var n=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.fn.ws((function(){return Object(e.b)(n,void 0,void 0,(function(){return Object(e.d)(this,(function(t){switch(t.label){case 0:return this.Ii?[4,this.za()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.za=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return Qi(e).put(new Ri(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.eh(e).next((function(e){e||(t.isPrimary=!1,t.fn.Cs((function(){return t.Ka(!1)})))}))})).next((function(){return t.nh(e)})).next((function(n){return t.isPrimary&&!n?t.sh(e).next((function(){return!1})):!!n&&t.ih(e).next((function(){return!0}))}))})).catch((function(e){if(rr(e))return y("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return y("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.fn.Cs((function(){return t.Ka(e)})),t.isPrimary=e}))},t.prototype.eh=function(t){var e=this;return Yi(t).get(Ti.key).next((function(t){return Zn.resolve(e.rh(t))}))},t.prototype.oh=function(t){return Qi(t).delete(this.clientId)},t.prototype.ah=function(){return Object(e.b)(this,void 0,void 0,(function(){var n,r,i,o,u=this;return Object(e.d)(this,(function(e){switch(e.label){case 0:return!this.isPrimary||this.hh(this.Ua,18e5)?[3,2]:(this.Ua=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var n=t.Kn(e,Ri.store);return n.ts().next((function(t){var e=u.uh(t,18e5),r=t.filter((function(t){return-1===e.indexOf(t)}));return Zn.forEach(r,(function(t){return n.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(n=e.sent(),this.Ga)for(r=0,i=n;r<i.length;r++)o=i[r],this.Ga.removeItem(this.lh(o.clientId));e.label=2;case 2:return[2]}}))}))},t.prototype.Ya=function(){var t=this;this.qa=this.fn.Vn("client_metadata_refresh",4e3,(function(){return t.za().then((function(){return t.ah()})).then((function(){return t.Ya()}))}))},t.prototype.rh=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.nh=function(t){var e=this;return this.Oa?Zn.resolve(!0):Yi(t).get(Ti.key).next((function(n){if(null!==n&&e.hh(n.leaseTimestampMs,5e3)&&!e._h(n.ownerId)){if(e.rh(n)&&e.networkEnabled)return!0;if(!e.rh(n)){if(!n.allowTabSynchronization)throw new l(b.FAILED_PRECONDITION,Hi);return!1}}return!(!e.networkEnabled||!e.inForeground)||Qi(t).ts().next((function(t){return void 0===e.uh(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&y("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.Di=function(){return Object(e.b)(this,void 0,void 0,(function(){var t=this;return Object(e.d)(this,(function(e){switch(e.label){case 0:return this.$a=!1,this.fh(),this.qa&&(this.qa.cancel(),this.qa=null),this.dh(),this.wh(),[4,this.Wa.runTransaction("shutdown","readwrite",[Ti.store,Ri.store],(function(e){var n=new Wi(e,Tr.ai);return t.sh(n).next((function(){return t.oh(n)}))}))];case 1:return e.sent(),this.Wa.close(),this.Eh(),[2]}}))}))},t.prototype.uh=function(t,e){var n=this;return t.filter((function(t){return n.hh(t.updateTimeMs,e)&&!n._h(t.clientId)}))},t.prototype.pi=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return Qi(e).ts().next((function(e){return t.uh(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"Ii",{get:function(){return this.$a},enumerable:!1,configurable:!0}),t.prototype.Th=function(t){return ui.Fo(t,this.serializer,this.Dr,this.No)},t.prototype.Ih=function(){return this.ja},t.prototype.mh=function(){return this.vr},t.prototype.Ah=function(){return this.Dr},t.prototype.runTransaction=function(t,e,n){var r=this;y("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Wa.runTransaction(t,o,Mi,(function(o){return i=new Wi(o,r.Ma?r.Ma.next():Tr.ai),"readwrite-primary"===e?r.eh(i).next((function(t){return!!t||r.nh(i)})).next((function(e){if(!e)throw m("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.fn.Cs((function(){return r.Ka(!1)})),new l(b.FAILED_PRECONDITION,Mr);return n(i)})).next((function(t){return r.ih(i).next((function(){return t}))})):r.Rh(i).next((function(){return n(i)}))})).then((function(t){return i.br(),t}))},t.prototype.Rh=function(t){var e=this;return Yi(t).get(Ti.key).next((function(t){if(null!==t&&e.hh(t.leaseTimestampMs,5e3)&&!e._h(t.ownerId)&&!e.rh(t)&&!(e.Oa||e.allowTabSynchronization&&t.allowTabSynchronization))throw new l(b.FAILED_PRECONDITION,Hi)}))},t.prototype.ih=function(t){var e=new Ti(this.clientId,this.allowTabSynchronization,Date.now());return Yi(t).put(Ti.key,e)},t.Ln=function(){return hr.Ln()},t.prototype.sh=function(t){var e=this,n=Yi(t);return n.get(Ti.key).next((function(t){return e.rh(t)?(y("IndexedDbPersistence","Releasing primary lease."),n.delete(Ti.key)):Zn.resolve()}))},t.prototype.hh=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(m("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.Ha=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ba=function(){t.fn.ws((function(){return t.inForeground="visible"===t.document.visibilityState,t.za()}))},this.document.addEventListener("visibilitychange",this.Ba),this.inForeground="visible"===this.document.visibilityState)},t.prototype.dh=function(){this.Ba&&(this.document.removeEventListener("visibilitychange",this.Ba),this.Ba=null)},t.prototype.Ja=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.La=function(){e.fh(),e.fn.ws((function(){return e.Di()}))},this.window.addEventListener("unload",this.La))},t.prototype.wh=function(){this.La&&(this.window.removeEventListener("unload",this.La),this.La=null)},t.prototype._h=function(t){var e;try{var n=null!==(null===(e=this.Ga)||void 0===e?void 0:e.getItem(this.lh(t)));return y("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return m("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.fh=function(){if(this.Ga)try{this.Ga.setItem(this.lh(this.clientId),String(Date.now()))}catch(t){m("Failed to set zombie client id.",t)}},t.prototype.Eh=function(){if(this.Ga)try{this.Ga.removeItem(this.lh(this.clientId))}catch(t){}},t.prototype.lh=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Yi(t){return Xi.Kn(t,Ti.store)}function Qi(t){return Xi.Kn(t,Ri.store)}var Ji=function(){function t(t,e){this.db=t,this.wo=new Wr(this,e)}return t.prototype.Po=function(t){var e=this.Ph(t);return this.db.Ih().ba(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.Ph=function(t){var e=0;return this.yo(t,(function(t){e++})).next((function(){return e}))},t.prototype.Ce=function(t,e){return this.db.Ih().Ce(t,e)},t.prototype.yo=function(t,e){return this.gh(t,(function(t,n){return e(n)}))},t.prototype.Da=function(t,e,n){return $i(t,n)},t.prototype.Na=function(t,e,n){return $i(t,n)},t.prototype.po=function(t,e,n){return this.db.Ih().po(t,e,n)},t.prototype.Go=function(t,e){return $i(t,e)},t.prototype.Vh=function(t,e){return function(t,e){var n=!1;return pi(t).os((function(r){return ai(t,r,e).next((function(t){return t&&(n=!0),Zn.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.bo=function(t,e){var n=this,r=this.db.mh().ra(),i=[],o=0;return this.gh(t,(function(u,s){if(s<=e){var a=n.Vh(t,u).next((function(e){if(!e)return o++,r.Rr(t,u).next((function(){return r.Ar(u),Ki(t).delete([0,Xr(u.path)])}))}));i.push(a)}})).next((function(){return Zn.kn(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.st(t.Fa);return this.db.Ih().Va(t,n)},t.prototype.yh=function(t,e){return $i(t,e)},t.prototype.gh=function(t,e){var n,r=Ki(t),i=Tr.ai;return r.rs({index:Pi.documentTargetsIndex},(function(t,r){var o=t[0],u=(t[1],r.path),s=r.sequenceNumber;0===o?(i!==Tr.ai&&e(new W(Jr(n)),i),i=s,n=u):i=Tr.ai})).next((function(){i!==Tr.ai&&e(new W(Jr(n)),i)}))},t.prototype.So=function(t){return this.db.mh().aa(t)},t}();function $i(t,e){return Ki(t).put(function(t,e){return new Pi(0,Xr(t.path),e)}(e,t.Fa))}function Zi(t,e){var n=t.projectId;return t.I||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var to=function(){function t(t,e,n){this.persistence=t,this.ph=e,this.bh=new dt(N),this.Sh=new U((function(t){return $(t)}),Z),this.Dh=G.min(),this.Sr=t.Th(n),this.Ch=t.mh(),this.ja=t.Ih(),this.Nh=new qr(this.Ch,this.Sr,this.persistence.Ah()),this.ph.xh(this.Nh)}return t.prototype.mo=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.vo(n,e.bh)}))},t}();function eo(t,e){var n=T(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.Ch.ra({oa:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),u=Zn.resolve();return o.forEach((function(t){u=u.next((function(){return r.Rr(e,t)})).next((function(e){var o=e,u=n.dr.get(t);_(null!==u),(!o||o.version.h(u)<0)&&(o=i.hr(t,o,n))&&r.Ir(o,n._r)}))})),u.next((function(){return t.Sr.Qo(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n.Sr.zo(t)})).next((function(){return n.Nh.Or(t,r)}))}))}function no(t){var e=T(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.ja.Ia(t)}))}function ro(t,e){var n=T(t),r=e.nt,i=n.bh;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.Ch.ra({oa:!0});i=n.bh;var u=[];e.zt.forEach((function(e,o){var s=i.get(o);if(s){u.push(n.ja.Ca(t,e.se,o).next((function(){return n.ja.Sa(t,e.ee,o)})));var a=e.resumeToken;if(a.o()>0){var c=s.it(a,r).st(t.Fa);i=i.ot(o,c),function(t,e,n){return _(e.resumeToken.o()>0),0===t.resumeToken.o()||e.nt.p()-t.nt.p()>=3e8||n.ee.size+n.ne.size+n.se.size>0}(s,c,e)&&u.push(n.ja.Va(t,c))}}}));var s=pt(),a=wt();if(e.Jt.forEach((function(t,e){a=a.add(t)})),u.push(o.getEntries(t,a).next((function(i){e.Jt.forEach((function(a,c){var h=i.get(a);c instanceof yn&&c.version.isEqual(G.min())?(o.Ar(a,r),s=s.ot(a,c)):null==h||c.version.h(h.version)>0||0===c.version.h(h.version)&&h.hasPendingWrites?(o.Ir(c,r),s=s.ot(a,c)):y("LocalStore","Ignoring outdated watch update for ",a,". Current version:",h.version," Watch version:",c.version),e.Yt.has(a)&&u.push(n.persistence.No.yh(t,a))}))}))),!r.isEqual(G.min())){var c=n.ja.Ia(t).next((function(e){return n.ja.Aa(t,t.Fa,r)}));u.push(c)}return Zn.kn(u).next((function(){return o.apply(t)})).next((function(){return n.Nh.Mr(t,s)}))})).then((function(t){return n.bh=i,t}))}function io(t,e){var n=T(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n.Sr.Bo(t,e)}))}function oo(t,e){var n=T(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.ja.va(t,e).next((function(i){return i?(r=i,Zn.resolve(r)):n.ja.wa(t).next((function(i){return r=new it(e,i,0,t.Fa),n.ja.Ra(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.bh.get(t.targetId);return(null===r||t.nt.h(r.nt)>0)&&(n.bh=n.bh.ot(t.targetId,t),n.Sh.set(e,t.targetId)),t}))}function so(t,n,i){return Object(e.b)(this,void 0,void 0,(function(){var r,o,u,s;return Object(e.d)(this,(function(e){switch(e.label){case 0:r=T(t),o=r.bh.get(n),u=i?"readwrite":"readwrite-primary",e.label=1;case 1:return e.trys.push([1,4,,5]),i?[3,3]:[4,r.persistence.runTransaction("Release target",u,(function(t){return r.persistence.No.removeTarget(t,o)}))];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:if(!rr(s=e.sent()))throw s;return y("LocalStore","Failed to update sequence numbers for target "+n+": "+s),[3,5];case 5:return r.bh=r.bh.remove(n),r.Sh.delete(o.target),[2]}}))}))}function uo(t,e,n){var r=T(t),i=G.min(),o=wt();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=T(t),i=r.Sh.get(n);return void 0!==i?Zn.resolve(r.bh.get(i)):r.ja.va(e,n)}(r,t,Nn(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.ja.xa(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.ph.Lr(t,e,n?i:G.min(),n?o:wt())})).next((function(t){return{documents:t,Fh:o}}))}))}function ao(t,e){var n=T(t),r=T(n.ja),i=n.bh.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.Ue(t,e).next((function(t){return t?t.target:null}))}))}function co(t){var e=T(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=T(t),i=pt(),o=ei(n),u=gi(e),s=IDBKeyRange.lowerBound(o,!0);return u.rs({index:ji.readTimeIndex,range:s},(function(t,e){var n=Zr(r.serializer,e);i=i.ot(n.key,n),o=e.readTime})).next((function(){return{kh:i,readTime:ni(o)}}))}(e.Ch,t,e.Dh)})).then((function(t){var n=t.kh,r=t.readTime;return e.Dh=r,n}))}function ho(t){return Object(e.b)(this,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){return[2,(n=T(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=gi(t),n=G.min();return e.rs({index:ji.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=ni(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){n.Dh=t}))]}))}))}function fo(t){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){if(t.code!==b.FAILED_PRECONDITION||t.message!==Mr)throw t;return y("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}var lo=function(){function t(){this.Oh=new ht(po.Mh),this.$h=new ht(po.Lh)}return t.prototype.P=function(){return this.Oh.P()},t.prototype.Da=function(t,e){var n=new po(t,e);this.Oh=this.Oh.add(n),this.$h=this.$h.add(n)},t.prototype.Bh=function(t,e){var n=this;t.forEach((function(t){return n.Da(t,e)}))},t.prototype.Na=function(t,e){this.qh(new po(t,e))},t.prototype.Uh=function(t,e){var n=this;t.forEach((function(t){return n.Na(t,e)}))},t.prototype.Kh=function(t){var e=this,n=new W(new z([])),r=new po(n,t),i=new po(n,t+1),o=[];return this.$h.xt([r,i],(function(t){e.qh(t),o.push(t.key)})),o},t.prototype.Qh=function(){var t=this;this.Oh.forEach((function(e){return t.qh(e)}))},t.prototype.qh=function(t){this.Oh=this.Oh.delete(t),this.$h=this.$h.delete(t)},t.prototype.Wh=function(t){var e=new W(new z([])),n=new po(e,t),r=new po(e,t+1),i=wt();return this.$h.xt([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.Ho=function(t){var e=new po(t,0),n=this.Oh.kt(e);return null!==n&&t.isEqual(n.key)},t}(),po=function(){function t(t,e){this.key=t,this.jh=e}return t.Mh=function(t,e){return W.D(t.key,e.key)||N(t.jh,e.jh)},t.Lh=function(t,e){return N(t.jh,e.jh)||W.D(t.key,e.key)},t}(),vo=function(t,e){this.user=e,this.type="OAuth",this.Gh={},this.Gh.Authorization="Bearer "+t},yo=function(){function t(){this.zh=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.Hh=function(){},t.prototype.Jh=function(t){this.zh=t,t(_r.UNAUTHENTICATED)},t.prototype.Yh=function(){this.zh=null},t}(),go=function(){function t(t){var e=this;this.Xh=null,this.currentUser=_r.UNAUTHENTICATED,this.Zh=!1,this.tc=0,this.zh=null,this.forceRefresh=!1,this.Xh=function(){e.tc++,e.currentUser=e.ec(),e.Zh=!0,e.zh&&e.zh(e.currentUser)},this.tc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Xh):(this.Xh(null),t.get().then((function(t){e.auth=t,e.Xh&&e.auth.addAuthTokenListener(e.Xh)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.tc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.tc!==e?(y("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(_("string"==typeof n.accessToken),new vo(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.Hh=function(){this.forceRefresh=!0},t.prototype.Jh=function(t){this.zh=t,this.Zh&&t(this.currentUser)},t.prototype.Yh=function(){this.auth&&this.auth.removeAuthTokenListener(this.Xh),this.Xh=null,this.zh=null},t.prototype.ec=function(){var t=this.auth&&this.auth.getUid();return _(null===t||"string"==typeof t),new _r(t)},t}(),bo=function(){function t(t,e){this.nc=t,this.sc=e,this.type="FirstParty",this.user=_r.ni}return Object.defineProperty(t.prototype,"Gh",{get:function(){var t={"X-Goog-AuthUser":this.sc},e=this.nc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),mo=function(){function t(t,e){this.nc=t,this.sc=e}return t.prototype.getToken=function(){return Promise.resolve(new bo(this.nc,this.sc))},t.prototype.Jh=function(t){t(_r.ni)},t.prototype.Yh=function(){},t.prototype.Hh=function(){},t}(),wo=function(){function t(t,e,n,r,i,o){this.fn=t,this.ic=n,this.rc=r,this.oc=i,this.listener=o,this.state=0,this.ac=0,this.hc=null,this.stream=null,this.Vs=new $n(t,e)}return t.prototype.cc=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.uc=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.lc()},t.prototype.stop=function(){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(t){switch(t.label){case 0:return this.cc()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype._c=function(){this.state=0,this.Vs.reset()},t.prototype.fc=function(){var t=this;this.uc()&&null===this.hc&&(this.hc=this.fn.Vn(this.ic,6e4,(function(){return t.dc()})))},t.prototype.wc=function(t){this.Ec(),this.stream.send(t)},t.prototype.dc=function(){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(t){return this.uc()?[2,this.close(0)]:[2]}))}))},t.prototype.Ec=function(){this.hc&&(this.hc.cancel(),this.hc=null)},t.prototype.close=function(t,n){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return this.Ec(),this.Vs.cancel(),this.ac++,3!==t?this.Vs.reset():n&&n.code===b.RESOURCE_EXHAUSTED?(m(n.toString()),m("Using maximum backoff delay to prevent overloading the backend."),this.Vs.Rn()):n&&n.code===b.UNAUTHENTICATED&&this.oc.Hh(),null!==this.stream&&(this.Tc(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ic(n)];case 1:return e.sent(),[2]}}))}))},t.prototype.Tc=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.mc(this.ac),n=this.ac;this.oc.getToken().then((function(e){t.ac===n&&t.Ac(e)}),(function(n){e((function(){var e=new l(b.UNKNOWN,"Fetching auth token failed: "+n.message);return t.Rc(e)}))}))},t.prototype.Ac=function(t){var e=this,n=this.mc(this.ac);this.stream=this.Pc(t),this.stream.gc((function(){n((function(){return e.state=2,e.listener.gc()}))})),this.stream.Ic((function(t){n((function(){return e.Rc(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.lc=function(){var t=this;this.state=4,this.Vs.Pn((function(){return Object(e.b)(t,void 0,void 0,(function(){return Object(e.d)(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.Rc=function(t){return y("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.mc=function(t){var e=this;return function(n){e.fn.ws((function(){return e.ac===t?n():(y("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Io=function(t){function n(e,n,r,i,o){var u=this;return(u=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).serializer=i,u}return Object(e.c)(n,t),n.prototype.Pc=function(t){return this.rc.Vc("Listen",t)},n.prototype.onMessage=function(t){this.Vs.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:E()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.Ke?(_(void 0===e||"string"==typeof e),j.fromBase64String(e||"")):(_(void 0===e||e instanceof Uint8Array),j.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),u=e.targetChange.cause,s=u&&function(t){var e=void 0===t.code?b.UNKNOWN:ut(t.code);return new l(e,t.message||"")}(u);n=new jt(r,i,o,s||null)}else if("documentChange"in e){e.documentChange;var a=e.documentChange;a.document,a.document.name,a.document.updateTime;var c=le(t,a.document.name),h=ae(a.document.updateTime),f=new fn({mapValue:{fields:a.document.fields}}),d=new vn(c,h,f,{}),p=a.targetIds||[],v=a.removedTargetIds||[];n=new St(p,v,d.key,d)}else if("documentDelete"in e){e.documentDelete;var y=e.documentDelete;y.document;var m=le(t,y.document),w=y.readTime?ae(y.readTime):G.min(),g=new yn(m,w),I=y.removedTargetIds||[];n=new St([],I,g.key,g)}else if("documentRemove"in e){e.documentRemove;var T=e.documentRemove;T.document;var O=le(t,T.document),A=T.removedTargetIds||[];n=new St([],A,O,null)}else{if(!("filter"in e))return E();e.filter;var N=e.filter;N.targetId;var S=N.count||0,D=new ot(S),x=N.targetId;n=new Dt(x,D)}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return G.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?G.min():e.readTime?ae(e.readTime):G.min()}(t);return this.listener.yc(e,n)},n.prototype.bc=function(t){var e={};e.database=ve(this.serializer),e.addTarget=function(t,e){var n,r=e.target;return(n=tt(r)?{documents:we(t,r)}:{query:Ie(t,r)}).targetId=e.targetId,e.resumeToken.o()>0&&(n.resumeToken=se(t,e.resumeToken)),n}(this.serializer,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return E()}}(0,e.et);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.wc(e)},n.prototype.vc=function(t){var e={};e.database=ve(this.serializer),e.removeTarget=t,this.wc(e)},n}(wo),Eo=function(t){function n(e,n,r,i,o){var u=this;return(u=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).serializer=i,u.Sc=!1,u}return Object(e.c)(n,t),Object.defineProperty(n.prototype,"Dc",{get:function(){return this.Sc},enumerable:!1,configurable:!0}),n.prototype.start=function(){this.Sc=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},n.prototype.Tc=function(){this.Sc&&this.Cc([])},n.prototype.Pc=function(t){return this.rc.Vc("Write",t)},n.prototype.onMessage=function(t){if(_(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Sc){this.Vs.reset();var e=function(t,e){return t&&t.length>0?(_(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?ae(t.updateTime):ae(e);n.isEqual(G.min())&&(n=ae(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new We(n,r)}(t,e)}))):[]}(t.writeResults,t.commitTime),n=ae(t.commitTime);return this.listener.Nc(n,e)}return _(!t.writeResults||0===t.writeResults.length),this.Sc=!0,this.listener.xc()},n.prototype.Fc=function(){var t={};t.database=ve(this.serializer),this.wc(t)},n.prototype.Cc=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return be(e.serializer,t)}))};this.wc(n)},n}(wo),_o=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.rc=n,i.serializer=r,i.kc=!1,i}return Object(e.c)(n,t),n.prototype.Oc=function(){if(this.kc)throw new l(b.FAILED_PRECONDITION,"The client has already been terminated.")},n.prototype.Mc=function(t,e,n){var r=this;return this.Oc(),this.credentials.getToken().then((function(i){return r.rc.Mc(t,e,n,i)})).catch((function(t){throw t.code===b.UNAUTHENTICATED&&r.credentials.Hh(),t}))},n.prototype.$c=function(t,e,n){var r=this;return this.Oc(),this.credentials.getToken().then((function(i){return r.rc.$c(t,e,n,i)})).catch((function(t){throw t.code===b.UNAUTHENTICATED&&r.credentials.Hh(),t}))},n.prototype.terminate=function(){this.kc=!1},n}((function(){})),To=function(){function t(t,e){this.hs=t,this.di=e,this.state="Unknown",this.Lc=0,this.Bc=null,this.qc=!0}return t.prototype.Uc=function(){var t=this;0===this.Lc&&(this.Kc("Unknown"),this.Bc=this.hs.Vn("online_state_timeout",1e4,(function(){return t.Bc=null,t.Qc("Backend didn't respond within 10 seconds."),t.Kc("Offline"),Promise.resolve()})))},t.prototype.Wc=function(t){"Online"===this.state?this.Kc("Unknown"):(this.Lc++,this.Lc>=1&&(this.jc(),this.Qc("Connection failed 1 times. Most recent error: "+t.toString()),this.Kc("Offline")))},t.prototype.set=function(t){this.jc(),this.Lc=0,"Online"===t&&(this.qc=!1),this.Kc(t)},t.prototype.Kc=function(t){t!==this.state&&(this.state=t,this.di(t))},t.prototype.Qc=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.qc?(m(e),this.qc=!1):y("OnlineStateTracker",e)},t.prototype.jc=function(){null!==this.Bc&&(this.Bc.cancel(),this.Bc=null)},t}(),Oo=function(t,n,i,r,u){var s=this;this.Gc=t,this.zc=n,this.hs=i,this.Hc={},this.Jc=[],this.Yc=new Map,this.Xc=new Set,this.Zc=[],this.tu=u,this.tu.eu((function(t){i.ws((function(){return Object(e.b)(s,void 0,void 0,(function(){return Object(e.d)(this,(function(t){switch(t.label){case 0:return Co(this)?(y("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(e.b)(this,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){switch(e.label){case 0:return(n=T(t)).Xc.add(4),[4,No(n)];case 1:return e.sent(),n.nu.set("Unknown"),n.Xc.delete(4),[4,Ao(n)];case 2:return e.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.nu=new To(i,r)};function Ao(t){return Object(e.b)(this,void 0,void 0,(function(){var n,r;return Object(e.d)(this,(function(e){switch(e.label){case 0:if(!Co(t))return[3,4];n=0,r=t.Zc,e.label=1;case 1:return n<r.length?[4,(0,r[n])(!0)]:[3,4];case 2:e.sent(),e.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))}function No(t){return Object(e.b)(this,void 0,void 0,(function(){var n,r;return Object(e.d)(this,(function(e){switch(e.label){case 0:n=0,r=t.Zc,e.label=1;case 1:return n<r.length?[4,(0,r[n])(!1)]:[3,4];case 2:e.sent(),e.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))}function So(t){return Object(e.b)(this,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){switch(e.label){case 0:return n=T(t),y("RemoteStore","RemoteStore shutting down."),n.Xc.add(5),[4,No(n)];case 1:return e.sent(),n.tu.Di(),n.nu.set("Unknown"),[2]}}))}))}function Do(t,e){var n=T(t);n.Yc.has(e.targetId)||(n.Yc.set(e.targetId,e),Lo(n)?Po(n):Qo(n).uc()&&xo(n,e))}function jo(t,e){var n=T(t),r=Qo(n);n.Yc.delete(e),r.uc()&&ko(n,e),0===n.Yc.size&&(r.uc()?r.fc():Co(n)&&n.nu.set("Unknown"))}function xo(t,e){t.su.me(e.targetId),Qo(t).bc(e)}function ko(t,e){t.su.me(e),Qo(t).vc(e)}function Po(t){t.su=new kt({qe:function(e){return t.Hc.qe(e)},Ue:function(e){return t.Yc.get(e)||null}}),Qo(t).start(),t.nu.Uc()}function Lo(t){return Co(t)&&!Qo(t).cc()&&t.Yc.size>0}function Co(t){return 0===T(t).Xc.size}function Vo(t){t.su=void 0}function Ro(t){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){return t.Yc.forEach((function(e,n){xo(t,e)})),[2]}))}))}function Mo(t,n){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){return Vo(t),Lo(t)?(t.nu.Wc(n),Po(t)):t.nu.set("Unknown"),[2]}))}))}function Uo(t,n,i){return Object(e.b)(this,void 0,void 0,(function(){var r,u,s;return Object(e.d)(this,(function(a){switch(a.label){case 0:if(t.nu.set("Online"),!(n instanceof jt&&2===n.state&&n.cause))return[3,6];a.label=1;case 1:return a.trys.push([1,3,,5]),[4,function(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u;return Object(e.d)(this,(function(e){switch(e.label){case 0:r=n.cause,i=0,o=n.targetIds,e.label=1;case 1:return i<o.length?(u=o[i],t.Yc.has(u)?[4,t.Hc.iu(u,r)]:[3,3]):[3,5];case 2:e.sent(),t.Yc.delete(u),t.su.removeTarget(u),e.label=3;case 3:e.label=4;case 4:return i++,[3,1];case 5:return[2]}}))}))}(t,n)];case 2:return a.sent(),[3,5];case 3:return r=a.sent(),y("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),r),[4,qo(t,r)];case 4:return a.sent(),[3,5];case 5:return[3,13];case 6:if(n instanceof St?t.su.be(n):n instanceof Dt?t.su.ke(n):t.su.De(n),i.isEqual(G.min()))return[3,13];a.label=7;case 7:return a.trys.push([7,11,,13]),[4,no(t.Gc)];case 8:return u=a.sent(),i.h(u)>=0?[4,function(t,e){var n=t.su.$e(e);return n.zt.forEach((function(n,r){if(n.resumeToken.o()>0){var i=t.Yc.get(r);i&&t.Yc.set(r,i.it(n.resumeToken,e))}})),n.Ht.forEach((function(e){var n=t.Yc.get(e);if(n){t.Yc.set(e,n.it(j.u,n.nt)),ko(t,e);var r=new it(n.target,e,1,n.sequenceNumber);xo(t,r)}})),t.Hc.ru(n)}(t,i)]:[3,10];case 9:a.sent(),a.label=10;case 10:return[3,13];case 11:return y("RemoteStore","Failed to raise snapshot:",s=a.sent()),[4,qo(t,s)];case 12:return a.sent(),[3,13];case 13:return[2]}}))}))}function qo(t,n,i){return Object(e.b)(this,void 0,void 0,(function(){var r=this;return Object(e.d)(this,(function(u){switch(u.label){case 0:if(!rr(n))throw n;return t.Xc.add(1),[4,No(t)];case 1:return u.sent(),t.nu.set("Offline"),i||(i=function(){return no(t.Gc)}),t.hs.Cs((function(){return Object(e.b)(r,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return y("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return e.sent(),t.Xc.delete(1),[4,Ao(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Fo(t,e){return e().catch((function(n){return qo(t,n,e)}))}function Go(t){return Object(e.b)(this,void 0,void 0,(function(){var n,r,i,o,u;return Object(e.d)(this,(function(e){switch(e.label){case 0:n=T(t),r=Jo(n),i=n.Jc.length>0?n.Jc[n.Jc.length-1].batchId:-1,e.label=1;case 1:if(!function(t){return Co(t)&&t.Jc.length<10}(n))return[3,7];e.label=2;case 2:return e.trys.push([2,4,,6]),[4,io(n.Gc,i)];case 3:return null===(o=e.sent())?(0===n.Jc.length&&r.fc(),[3,7]):(i=o.batchId,function(t,e){t.Jc.push(e);var n=Jo(t);n.uc()&&n.Dc&&n.Cc(e.mutations)}(n,o),[3,6]);case 4:return u=e.sent(),[4,qo(n,u)];case 5:return e.sent(),[3,6];case 6:return[3,1];case 7:return Bo(n)&&zo(n),[2]}}))}))}function Bo(t){return Co(t)&&!Jo(t).cc()&&t.Jc.length>0}function zo(t){Jo(t).start()}function Ko(t){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){return Jo(t).Fc(),[2]}))}))}function Ho(t){return Object(e.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(e.d)(this,(function(e){for(n=Jo(t),r=0,i=t.Jc;r<i.length;r++)o=i[r],n.Cc(o.mutations);return[2]}))}))}function Wo(t,n,i){return Object(e.b)(this,void 0,void 0,(function(){var r,o;return Object(e.d)(this,(function(e){switch(e.label){case 0:return r=t.Jc.shift(),o=Vr.from(r,n,i),[4,Fo(t,(function(){return t.Hc.ou(o)}))];case 1:return e.sent(),[4,Go(t)];case 2:return e.sent(),[2]}}))}))}function Xo(t,n){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(i){switch(i.label){case 0:return n&&Jo(t).Dc?[4,function(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i;return Object(e.d)(this,(function(e){switch(e.label){case 0:return st(i=n.code)&&i!==b.ABORTED?(r=t.Jc.shift(),Jo(t)._c(),[4,Fo(t,(function(){return t.Hc.au(r.batchId,n)}))]):[3,3];case 1:return e.sent(),[4,Go(t)];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))}(t,n)]:[3,2];case 1:i.sent(),i.label=2;case 2:return Bo(t)&&zo(t),[2]}}))}))}function Yo(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r;return Object(e.d)(this,(function(e){switch(e.label){case 0:return r=T(t),n?(r.Xc.delete(2),[4,Ao(r)]):[3,2];case 1:return e.sent(),[3,5];case 2:return n?[3,4]:(r.Xc.add(2),[4,No(r)]);case 3:e.sent(),r.nu.set("Unknown"),e.label=4;case 4:e.label=5;case 5:return[2]}}))}))}function Qo(t){var n=this;return t.hu||(t.hu=function(t,e,n){var r=T(t);return r.Oc(),new Io(e,r.rc,r.credentials,r.serializer,n)}(t.zc,t.hs,{gc:Ro.bind(null,t),Ic:Mo.bind(null,t),yc:Uo.bind(null,t)}),t.Zc.push((function(i){return Object(e.b)(n,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return i?(t.hu._c(),Lo(t)?Po(t):t.nu.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.hu.stop()];case 2:e.sent(),Vo(t),e.label=3;case 3:return[2]}}))}))}))),t.hu}function Jo(t){var n=this;return t.cu||(t.cu=function(t,e,n){var r=T(t);return r.Oc(),new Eo(e,r.rc,r.credentials,r.serializer,n)}(t.zc,t.hs,{gc:Ko.bind(null,t),Ic:Xo.bind(null,t),xc:Ho.bind(null,t),Nc:Wo.bind(null,t)}),t.Zc.push((function(i){return Object(e.b)(n,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return i?(t.cu._c(),[4,Go(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.cu.stop()];case 3:e.sent(),t.Jc.length>0&&(y("RemoteStore","Stopping write stream with "+t.Jc.length+" pending writes"),t.Jc=[]),e.label=4;case 4:return[2]}}))}))}))),t.cu}var $o=function(t){this.key=t},Zo=function(t){this.key=t},ts=function(){function t(t,e){this.query=t,this.uu=e,this.lu=null,this.te=!1,this._u=wt(),this.Qt=wt(),this.fu=Cn(t),this.du=new _t(this.fu)}return Object.defineProperty(t.prototype,"wu",{get:function(){return this.uu},enumerable:!1,configurable:!0}),t.prototype.Eu=function(t,e){var n=this,r=e?e.Tu:new Tt,i=e?e.du:this.du,o=e?e.Qt:this.Qt,u=i,s=!1,a=In(this.query)&&i.size===this.query.limit?i.last():null,c=En(this.query)&&i.size===this.query.limit?i.first():null;if(t.ut((function(t,e){var h=i.get(t),f=e instanceof vn?e:null;f&&(f=Ln(n.query,f)?f:null);var l=!!h&&n.Qt.has(h.key),p=!!f&&(f.Ye||n.Qt.has(f.key)&&f.hasCommittedMutations),d=!1;h&&f?h.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.Iu(h,f)||(r.track({type:2,doc:f}),d=!0,(a&&n.fu(f,a)>0||c&&n.fu(f,c)<0)&&(s=!0)):!h&&f?(r.track({type:0,doc:f}),d=!0):h&&!f&&(r.track({type:1,doc:h}),d=!0,(a||c)&&(s=!0)),d&&(f?(u=u.add(f),o=p?o.add(t):o.delete(t)):(u=u.delete(t),o=o.delete(t)))})),In(this.query)||En(this.query))for(;u.size>this.query.limit;){var h=In(this.query)?u.last():u.first();u=u.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{du:u,Tu:r,mu:s,Qt:o}},t.prototype.Iu=function(t,e){return t.Ye&&e.hasCommittedMutations&&!e.Ye},t.prototype.Vr=function(t,e,n){var r=this,i=this.du;this.du=t.du,this.Qt=t.Qt;var o=t.Tu.Ut();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return E()}};return n(t)-n(e)}(t.type,e.type)||r.fu(t.doc,e.doc)})),this.Au(n);var u=e?this.Ru():[],s=0===this._u.size&&this.te?1:0,a=s!==this.lu;return this.lu=s,0!==o.length||a?{snapshot:new Ot(this.query,t.du,i,o,t.Qt,0===s,a,!1),Pu:u}:{Pu:u}},t.prototype.Ks=function(t){return this.te&&"Offline"===t?(this.te=!1,this.Vr({du:this.du,Tu:new Tt,Qt:this.Qt,mu:!1},!1)):{Pu:[]}},t.prototype.gu=function(t){return!this.uu.has(t)&&!!this.du.has(t)&&!this.du.get(t).Ye},t.prototype.Au=function(t){var e=this;t&&(t.ee.forEach((function(t){return e.uu=e.uu.add(t)})),t.ne.forEach((function(t){})),t.se.forEach((function(t){return e.uu=e.uu.delete(t)})),this.te=t.te)},t.prototype.Ru=function(){var t=this;if(!this.te)return[];var e=this._u;this._u=wt(),this.du.forEach((function(e){t.gu(e.key)&&(t._u=t._u.add(e.key))}));var n=[];return e.forEach((function(e){t._u.has(e)||n.push(new Zo(e))})),this._u.forEach((function(t){e.has(t)||n.push(new $o(t))})),n},t.prototype.Vu=function(t){this.uu=t.Fh,this._u=wt();var e=this.Eu(t.documents);return this.Vr(e,!0)},t.prototype.yu=function(){return Ot.Gt(this.query,this.du,this.Qt,0===this.lu)},t}(),es=function(t,e,n){this.query=t,this.targetId=e,this.view=n},ns=function(t){this.key=t,this.pu=!1},rs=function(){function t(t,e,n,r,i,o){this.Gc=t,this.bu=e,this.vu=n,this.Su=r,this.currentUser=i,this.Du=o,this.Cu={},this.Nu=new U((function(t){return kn(t)}),xn),this.xu=new Map,this.Fu=[],this.ku=new dt(W.D),this.Ou=new Map,this.Mu=new lo,this.$u={},this.Lu=new Map,this.Bu=Fi.da(),this.onlineState="Unknown",this.qu=void 0}return Object.defineProperty(t.prototype,"Uu",{get:function(){return!0===this.qu},enumerable:!1,configurable:!0}),t}();function is(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u,s,a;return Object(e.d)(this,(function(e){switch(e.label){case 0:return r=js(t),(u=r.Nu.get(n))?(i=u.targetId,r.Su.$i(i),o=u.view.yu(),[3,4]):[3,1];case 1:return[4,oo(r.Gc,Nn(n))];case 2:return s=e.sent(),a=r.Su.$i(s.targetId),i=s.targetId,[4,os(r,n,i,"current"===a)];case 3:o=e.sent(),r.Uu&&Do(r.bu,s),e.label=4;case 4:return[2,o]}}))}))}function os(t,n,i,r){return Object(e.b)(this,void 0,void 0,(function(){var u,s,a,o,c,h;return Object(e.d)(this,(function(f){switch(f.label){case 0:return t.Ku=function(n,i,r){return function(t,n,i,r){return Object(e.b)(this,void 0,void 0,(function(){var o,u,s;return Object(e.d)(this,(function(e){switch(e.label){case 0:return(o=n.view.Eu(i)).mu?[4,uo(t.Gc,n.query,!1).then((function(t){var e=t.documents;return n.view.Eu(e,o)}))]:[3,2];case 1:o=e.sent(),e.label=2;case 2:return u=r&&r.zt.get(n.targetId),s=n.view.Vr(o,t.Uu,u),[2,(ys(t,n.targetId,s.Pu),s.snapshot)]}}))}))}(t,n,i,r)},[4,uo(t.Gc,n,!0)];case 1:return u=f.sent(),s=new ts(n,u.Fh),a=s.Eu(u.documents),o=Nt.Zt(i,r&&"Offline"!==t.onlineState),c=s.Vr(a,t.Uu,o),ys(t,i,c.Pu),h=new es(n,i,s),[2,(t.Nu.set(n,h),t.xu.has(i)?t.xu.get(i).push(n):t.xu.set(i,[n]),c.snapshot)]}}))}))}function ss(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o;return Object(e.d)(this,(function(e){switch(e.label){case 0:return r=T(t),i=r.Nu.get(n),(o=r.xu.get(i.targetId)).length>1?[2,(r.xu.set(i.targetId,o.filter((function(t){return!xn(t,n)}))),void r.Nu.delete(n))]:r.Uu?(r.Su.Bi(i.targetId),r.Su.xi(i.targetId)?[3,2]:[4,so(r.Gc,i.targetId,!1).then((function(){r.Su.Ui(i.targetId),jo(r.bu,i.targetId),ds(r,i.targetId)})).catch(fo)]):[3,3];case 1:e.sent(),e.label=2;case 2:return[3,5];case 3:return ds(r,i.targetId),[4,so(r.Gc,i.targetId,!0)];case 4:e.sent(),e.label=5;case 5:return[2]}}))}))}function us(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i;return Object(e.d)(this,(function(e){switch(e.label){case 0:r=T(t),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,ro(r.Gc,n)];case 2:return i=e.sent(),n.zt.forEach((function(t,e){var n=r.Ou.get(e);n&&(_(t.ee.size+t.ne.size+t.se.size<=1),t.ee.size>0?n.pu=!0:t.ne.size>0?_(n.pu):t.se.size>0&&(_(n.pu),n.pu=!1))})),[4,ms(r,i,n)];case 3:return e.sent(),[3,6];case 4:return[4,fo(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}}))}))}function as(t,e,n){var r=T(t);if(r.Uu&&0===n||!r.Uu&&1===n){var i=[];r.Nu.forEach((function(t,n){var r=n.view.Ks(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=T(t);n.onlineState=e;var r=!1;n.Bs.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].Ks(e)&&(r=!0)})),r&&Ir(n)}(r.vu,e),i.length&&r.Cu.yc(i),r.onlineState=e,r.Uu&&r.Su.ji(e)}}function cs(t,n,i){return Object(e.b)(this,void 0,void 0,(function(){var r,o,u,s,a,c;return Object(e.d)(this,(function(e){switch(e.label){case 0:return(r=T(t)).Su.Ki(n,"rejected",i),o=r.Ou.get(n),(u=o&&o.key)?(s=(s=new dt(W.D)).ot(u,new yn(u,G.min())),a=wt().add(u),c=new At(G.min(),new Map,new ht(N),s,a),[4,us(r,c)]):[3,2];case 1:return e.sent(),r.ku=r.ku.remove(u),r.Ou.delete(n),bs(r),[3,4];case 2:return[4,so(r.Gc,n,!1).then((function(){return ds(r,n,i)})).catch(fo)];case 3:e.sent(),e.label=4;case 4:return[2]}}))}))}function hs(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o;return Object(e.d)(this,(function(e){switch(e.label){case 0:r=T(t),i=n.batch.batchId,e.label=1;case 1:return e.trys.push([1,4,,6]),[4,eo(r.Gc,n)];case 2:return o=e.sent(),ps(r,i,null),ls(r,i),r.Su.Oi(i,"acknowledged"),[4,ms(r,o)];case 3:return e.sent(),[3,6];case 4:return[4,fo(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}}))}))}function fs(t,n,i){return Object(e.b)(this,void 0,void 0,(function(){var r,o;return Object(e.d)(this,(function(e){switch(e.label){case 0:r=T(t),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,function(t,e){var n=T(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n.Sr.$o(t,e).next((function(e){return _(null!==e),r=e.keys(),n.Sr.Qo(t,e)})).next((function(){return n.Sr.zo(t)})).next((function(){return n.Nh.Or(t,r)}))}))}(r.Gc,n)];case 2:return o=e.sent(),ps(r,n,i),ls(r,n),r.Su.Oi(n,"rejected",i),[4,ms(r,o)];case 3:return e.sent(),[3,6];case 4:return[4,fo(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}}))}))}function ls(t,e){(t.Lu.get(e)||[]).forEach((function(t){t.resolve()})),t.Lu.delete(e)}function ps(t,e,n){var r=T(t),i=r.$u[r.currentUser.ti()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.$u[r.currentUser.ti()]=i}}function ds(t,e,n){void 0===n&&(n=null),t.Su.Bi(e);for(var r=0,i=t.xu.get(e);r<i.length;r++){var o=i[r];t.Nu.delete(o),n&&t.Cu.Qu(o,n)}t.xu.delete(e),t.Uu&&t.Mu.Kh(e).forEach((function(e){t.Mu.Ho(e)||vs(t,e)}))}function vs(t,e){var n=t.ku.get(e);null!==n&&(jo(t.bu,n),t.ku=t.ku.remove(e),t.Ou.delete(n),bs(t))}function ys(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof $o?(t.Mu.Da(o.key,e),gs(t,o)):o instanceof Zo?(y("SyncEngine","Document no longer in limbo: "+o.key),t.Mu.Na(o.key,e),t.Mu.Ho(o.key)||vs(t,o.key)):E()}}function gs(t,e){var n=e.key;t.ku.get(n)||(y("SyncEngine","New document in limbo: "+n),t.Fu.push(n),bs(t))}function bs(t){for(;t.Fu.length>0&&t.ku.size<t.Du;){var e=t.Fu.shift(),n=t.Bu.next();t.Ou.set(n,new ns(e)),t.ku=t.ku.ot(e,n),Do(t.bu,new it(Nn(wn(e.path)),n,2,Tr.ai))}}function ms(t,n,i){return Object(e.b)(this,void 0,void 0,(function(){var r,u,s,a;return Object(e.d)(this,(function(o){switch(o.label){case 0:return r=T(t),u=[],s=[],a=[],r.Nu.P()?[3,3]:(r.Nu.forEach((function(t,e){a.push(r.Ku(e,n,i).then((function(t){if(t){r.Uu&&r.Su.Ki(e.targetId,t.fromCache?"not-current":"current"),u.push(t);var n=Fr.zr(e.targetId,t);s.push(n)}})))})),[4,Promise.all(a)]);case 1:return o.sent(),r.Cu.yc(u),[4,function(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u,s,a,c,h,f;return Object(e.d)(this,(function(e){switch(e.label){case 0:r=T(t),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return Zn.forEach(n,(function(e){return Zn.forEach(e.jr,(function(n){return r.persistence.No.Da(t,e.targetId,n)})).next((function(){return Zn.forEach(e.Gr,(function(n){return r.persistence.No.Na(t,e.targetId,n)}))}))}))}))];case 2:return e.sent(),[3,4];case 3:if(!rr(i=e.sent()))throw i;return y("LocalStore","Failed to update sequence numbers: "+i),[3,4];case 4:for(o=0,u=n;o<u.length;o++)s=u[o],a=s.targetId,s.fromCache||(c=r.bh.get(a),h=c.nt,f=c.rt(h),r.bh=r.bh.ot(a,f));return[2]}}))}))}(r.Gc,s)];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))}function ws(t,n){return Object(e.b)(this,void 0,void 0,(function(){var i,r;return Object(e.d)(this,(function(u){switch(u.label){case 0:return(i=T(t)).currentUser.isEqual(n)?[3,3]:(y("SyncEngine","User change. New user:",n.ti()),[4,function(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u;return Object(e.d)(this,(function(e){switch(e.label){case 0:return r=T(t),i=r.Sr,o=r.Nh,[4,r.persistence.runTransaction("Handle user change","readonly",(function(t){var e;return r.Sr.Uo(t).next((function(u){return e=u,i=r.persistence.Th(n),o=new qr(r.Ch,i,r.persistence.Ah()),i.Uo(t)})).next((function(n){for(var r=[],i=[],u=wt(),s=0,a=e;s<a.length;s++){var c=a[s];r.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];u=u.add(l.key)}}for(var p=0,d=n;p<d.length;p++){var v=d[p];i.push(v.batchId);for(var y=0,m=v.mutations;y<m.length;y++){var g=m[y];u=u.add(g.key)}}return o.Or(t,u).next((function(t){return{Wu:t,ju:r,Gu:i}}))}))}))];case 1:return u=e.sent(),[2,(r.Sr=i,r.Nh=o,r.ph.xh(r.Nh),u)]}}))}))}(i.Gc,n)]);case 1:return r=u.sent(),i.currentUser=n,function(t,e){t.Lu.forEach((function(t){t.forEach((function(t){t.reject(new l(b.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Lu.clear()}(i),i.Su.Wi(n,r.ju,r.Gu),[4,ms(i,r.Wu)];case 2:u.sent(),u.label=3;case 3:return[2]}}))}))}function Is(t,e){var n=T(t),r=n.Ou.get(e);if(r&&r.pu)return wt().add(r.key);var i=wt(),o=n.xu.get(e);if(!o)return i;for(var u=0,s=o;u<s.length;u++){var a=s[u],c=n.Nu.get(a);i=i.Ot(c.view.wu)}return i}function Es(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o;return Object(e.d)(this,(function(e){switch(e.label){case 0:return[4,uo((r=T(t)).Gc,n.query,!0)];case 1:return i=e.sent(),o=n.view.Vu(i),[2,(r.Uu&&ys(r,n.targetId,o.Pu),o)]}}))}))}function _s(t,n,i,r){return Object(e.b)(this,void 0,void 0,(function(){var o,u;return Object(e.d)(this,(function(e){switch(e.label){case 0:return[4,function(t,e){var n=T(t),r=T(n.Sr);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.Lo(t,e).next((function(e){return e?n.Nh.Or(t,e):Zn.resolve(null)}))}))}((o=T(t)).Gc,n)];case 1:return null===(u=e.sent())?[3,6]:"pending"!==i?[3,3]:[4,Go(o.bu)];case 2:return e.sent(),[3,4];case 3:"acknowledged"===i||"rejected"===i?(ps(o,n,r||null),ls(o,n),function(t,e){T(T(t).Sr).jo(e)}(o.Gc,n)):E(),e.label=4;case 4:return[4,ms(o,u)];case 5:return e.sent(),[3,7];case 6:y("SyncEngine","Cannot apply mutation batch with id: "+n),e.label=7;case 7:return[2]}}))}))}function Ts(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u,s,a,c,h;return Object(e.d)(this,(function(e){switch(e.label){case 0:return js(r=T(t)),xs(r),!0!==n||!0===r.qu?[3,3]:(i=r.Su.Ci(),[4,Os(r,i.L())]);case 1:return o=e.sent(),r.qu=!0,[4,Yo(r.bu,!0)];case 2:for(e.sent(),u=0,s=o;u<s.length;u++)a=s[u],Do(r.bu,a);return[3,7];case 3:return!1!==n||!1===r.qu?[3,7]:(c=[],h=Promise.resolve(),r.xu.forEach((function(t,e){r.Su.qi(e)?c.push(e):h=h.then((function(){return ds(r,e),so(r.Gc,e,!0)})),jo(r.bu,e)})),[4,h]);case 4:return e.sent(),[4,Os(r,c)];case 5:return e.sent(),function(t){var e=T(t);e.Ou.forEach((function(t,n){jo(e.bu,n)})),e.Mu.Qh(),e.Ou=new Map,e.ku=new dt(W.D)}(r),r.qu=!1,[4,Yo(r.bu,!1)];case 6:e.sent(),e.label=7;case 7:return[2]}}))}))}function Os(t,n,i){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u,s,a,c,h,f,l,p,d,v,y;return Object(e.d)(this,(function(e){switch(e.label){case 0:r=T(t),i=[],o=[],u=0,s=n,e.label=1;case 1:return u<s.length?(a=s[u],c=void 0,(h=r.xu.get(a))&&0!==h.length?[4,oo(r.Gc,Nn(h[0]))]:[3,7]):[3,13];case 2:c=e.sent(),f=0,l=h,e.label=3;case 3:return f<l.length?(p=l[f],d=r.Nu.get(p),[4,Es(r,d)]):[3,6];case 4:(v=e.sent()).snapshot&&o.push(v.snapshot),e.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,ao(r.Gc,a)];case 8:return y=e.sent(),[4,oo(r.Gc,y)];case 9:return c=e.sent(),[4,os(r,As(y),a,!1)];case 10:e.sent(),e.label=11;case 11:i.push(c),e.label=12;case 12:return u++,[3,1];case 13:return[2,(r.Cu.yc(o),i)]}}))}))}function As(t){return mn(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Ns(t){var e=T(t);return T(T(e.Gc).persistence).pi()}function Ss(t,n,i,r){return Object(e.b)(this,void 0,void 0,(function(){var o,u,s;return Object(e.d)(this,(function(e){switch(e.label){case 0:return(o=T(t)).qu?(y("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!o.xu.has(n))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,co(o.Gc)];case 3:return u=e.sent(),s=At.Xt(n,"current"===i),[4,ms(o,u,s)];case 4:return e.sent(),[3,8];case 5:return[4,so(o.Gc,n,!0)];case 6:return e.sent(),ds(o,n,r),[3,8];case 7:E(),e.label=8;case 8:return[2]}}))}))}function Ds(t,n,i){return Object(e.b)(this,void 0,void 0,(function(){var r,o,u,s,a,c,h,f,l,p;return Object(e.d)(this,(function(d){switch(d.label){case 0:if(!(r=js(t)).qu)return[3,10];o=0,u=n,d.label=1;case 1:return o<u.length?(s=u[o],r.xu.has(s)?(y("SyncEngine","Adding an already active target "+s),[3,5]):[4,ao(r.Gc,s)]):[3,6];case 2:return a=d.sent(),[4,oo(r.Gc,a)];case 3:return c=d.sent(),[4,os(r,As(a),c.targetId,!1)];case 4:d.sent(),Do(r.bu,c),d.label=5;case 5:return o++,[3,1];case 6:h=function(t){return Object(e.d)(this,(function(e){switch(e.label){case 0:return r.xu.has(t)?[4,so(r.Gc,t,!1).then((function(){jo(r.bu,t),ds(r,t)})).catch(fo)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},f=0,l=i,d.label=7;case 7:return f<l.length?(p=l[f],[5,h(p)]):[3,10];case 8:d.sent(),d.label=9;case 9:return f++,[3,7];case 10:return[2]}}))}))}function js(t){var e=T(t);return e.bu.Hc.ru=us.bind(null,e),e.bu.Hc.qe=Is.bind(null,e),e.bu.Hc.iu=cs.bind(null,e),e.Cu.yc=mr.bind(null,e.vu),e.Cu.Qu=wr.bind(null,e.vu),e}function xs(t){var e=T(t);return e.bu.Hc.ou=hs.bind(null,e),e.bu.Hc.au=fs.bind(null,e),e}var ks=function(){function t(){}return t.prototype.xh=function(t){this.zu=t},t.prototype.Lr=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.on.length||1===t.on.length&&t.on[0].field.W())}(e)||n.isEqual(G.min())?this.Hu(t,e):this.zu.Or(t,r).next((function(c){var s=i.Ju(e,c);return(In(e)||En(e))&&i.mu(e.an,s,r,n)?i.Hu(t,e):(v()<=o.a.DEBUG&&y("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Pn(e)),i.zu.Lr(t,e,n).next((function(t){return s.forEach((function(e){t=t.ot(e.key,e)})),t})))}))},t.prototype.Ju=function(t,e){var n=new ht(Cn(t));return e.forEach((function(e,r){r instanceof vn&&Ln(t,r)&&(n=n.add(r))})),n},t.prototype.mu=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.h(r)>0)},t.prototype.Hu=function(t,e){return v()<=o.a.DEBUG&&y("IndexFreeQueryEngine","Using full collection scan to execute query:",Pn(e)),this.zu.Lr(t,e,G.min())},t}(),Ps=function(){function t(t,e){this.Dr=t,this.No=e,this.Sr=[],this.Yu=1,this.Xu=new ht(po.Mh)}return t.prototype.ko=function(t){return Zn.resolve(0===this.Sr.length)},t.prototype.Oo=function(t,e,n,r){var i=this.Yu;this.Yu++,this.Sr.length>0&&this.Sr[this.Sr.length-1];var o=new Cr(i,e,n,r);this.Sr.push(o);for(var u=0,s=r;u<s.length;u++){var a=s[u];this.Xu=this.Xu.add(new po(a.key,i)),this.Dr.Mo(t,a.key.path.F())}return Zn.resolve(o)},t.prototype.$o=function(t,e){return Zn.resolve(this.Zu(e))},t.prototype.Bo=function(t,e){var n=e+1,r=this.tl(n),i=r<0?0:r;return Zn.resolve(this.Sr.length>i?this.Sr[i]:null)},t.prototype.qo=function(){return Zn.resolve(0===this.Sr.length?-1:this.Yu-1)},t.prototype.Uo=function(t){return Zn.resolve(this.Sr.slice())},t.prototype.Nr=function(t,e){var n=this,r=new po(e,0),i=new po(e,Number.POSITIVE_INFINITY),o=[];return this.Xu.xt([r,i],(function(t){var e=n.Zu(t.jh);o.push(e)})),Zn.resolve(o)},t.prototype.$r=function(t,e){var n=this,r=new ht(N);return e.forEach((function(t){var e=new po(t,0),i=new po(t,Number.POSITIVE_INFINITY);n.Xu.xt([e,i],(function(t){r=r.add(t.jh)}))})),Zn.resolve(this.el(r))},t.prototype.Qr=function(t,e){var n=e.path,r=n.length+1,i=n;W.X(i)||(i=i.child(""));var o=new po(new W(i),0),u=new ht(N);return this.Xu.Ft((function(t){var e=t.key.path;return!!n.M(e)&&(e.length===r&&(u=u.add(t.jh)),!0)}),o),Zn.resolve(this.el(u))},t.prototype.el=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.Zu(t);null!==r&&n.push(r)})),n},t.prototype.Qo=function(t,e){var n=this;_(0===this.nl(e.batchId,"removed")),this.Sr.shift();var r=this.Xu;return Zn.forEach(e.mutations,(function(i){var o=new po(i.key,e.batchId);return r=r.delete(o),n.No.Go(t,i.key)})).next((function(){n.Xu=r}))},t.prototype.jo=function(t){},t.prototype.Ho=function(t,e){var n=new po(e,0),r=this.Xu.kt(n);return Zn.resolve(e.isEqual(r&&r.key))},t.prototype.zo=function(t){return this.Sr.length,Zn.resolve()},t.prototype.nl=function(t,e){return this.tl(t)},t.prototype.tl=function(t){return 0===this.Sr.length?0:t-this.Sr[0].batchId},t.prototype.Zu=function(t){var e=this.tl(t);return e<0||e>=this.Sr.length?null:this.Sr[e]},t}(),Ls=function(){function t(t,e){this.Dr=t,this.sl=e,this.docs=new dt(W.D),this.size=0}return t.prototype.Ir=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,u=this.sl(e);return this.docs=this.docs.ot(r,{ta:e,size:u,readTime:n}),this.size+=u-o,this.Dr.Mo(t,r.path.F())},t.prototype.Ar=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.Rr=function(t,e){var n=this.docs.get(e);return Zn.resolve(n?n.ta:null)},t.prototype.getEntries=function(t,e){var n=this,r=vt();return e.forEach((function(t){var e=n.docs.get(t);r=r.ot(t,e?e.ta:null)})),Zn.resolve(r)},t.prototype.Lr=function(t,e,n){for(var r=gt(),i=new W(e.path.child("")),o=this.docs.ft(i);o.At();){var u=o.It(),s=u.key,a=u.value,c=a.ta,h=a.readTime;if(!e.path.M(s.path))break;h.h(n)<=0||c instanceof vn&&Ln(e,c)&&(r=r.ot(c.key,c))}return Zn.resolve(r)},t.prototype.il=function(t,e){return Zn.forEach(this.docs,(function(t){return e(t)}))},t.prototype.ra=function(t){return new Cs(this)},t.prototype.aa=function(t){return Zn.resolve(this.size)},t}(),Cs=function(t){function n(e){var n=this;return(n=t.call(this)||this).ha=e,n}return Object(e.c)(n,t),n.prototype.Vr=function(t){var e=this,n=[];return this.wr.forEach((function(r,i){i?n.push(e.ha.Ir(t,i,e.readTime)):e.ha.Ar(r)})),Zn.kn(n)},n.prototype.Pr=function(t,e){return this.ha.Rr(t,e)},n.prototype.gr=function(t,e){return this.ha.getEntries(t,e)},n}(Rr),Vs=function(){function t(t){this.persistence=t,this.rl=new U((function(t){return $(t)}),Z),this.lastRemoteSnapshotVersion=G.min(),this.highestTargetId=0,this.ol=0,this.al=new lo,this.targetCount=0,this.hl=Fi.fa()}return t.prototype.Ce=function(t,e){return this.rl.forEach((function(t,n){return e(n)})),Zn.resolve()},t.prototype.Ia=function(t){return Zn.resolve(this.lastRemoteSnapshotVersion)},t.prototype.ma=function(t){return Zn.resolve(this.ol)},t.prototype.wa=function(t){return this.highestTargetId=this.hl.next(),Zn.resolve(this.highestTargetId)},t.prototype.Aa=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ol&&(this.ol=e),Zn.resolve()},t.prototype.Pa=function(t){this.rl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.hl=new Fi(e),this.highestTargetId=e),t.sequenceNumber>this.ol&&(this.ol=t.sequenceNumber)},t.prototype.Ra=function(t,e){return this.Pa(e),this.targetCount+=1,Zn.resolve()},t.prototype.Va=function(t,e){return this.Pa(e),Zn.resolve()},t.prototype.ya=function(t,e){return this.rl.delete(e.target),this.al.Kh(e.targetId),this.targetCount-=1,Zn.resolve()},t.prototype.po=function(t,e,n){var r=this,i=0,o=[];return this.rl.forEach((function(u,s){s.sequenceNumber<=e&&null===n.get(s.targetId)&&(r.rl.delete(u),o.push(r.pa(t,s.targetId)),i++)})),Zn.kn(o).next((function(){return i}))},t.prototype.ba=function(t){return Zn.resolve(this.targetCount)},t.prototype.va=function(t,e){var n=this.rl.get(e)||null;return Zn.resolve(n)},t.prototype.Sa=function(t,e,n){return this.al.Bh(e,n),Zn.resolve()},t.prototype.Ca=function(t,e,n){this.al.Uh(e,n);var r=this.persistence.No,i=[];return r&&e.forEach((function(e){i.push(r.Go(t,e))})),Zn.kn(i)},t.prototype.pa=function(t,e){return this.al.Kh(e),Zn.resolve()},t.prototype.xa=function(t,e){var n=this.al.Wh(e);return Zn.resolve(n)},t.prototype.Ho=function(t,e){return Zn.resolve(this.al.Ho(e))},t}(),Rs=function(){function t(t){var e=this;this.cl={},this.Ma=new Tr(0),this.$a=!1,this.$a=!0,this.No=t(this),this.ja=new Vs(this),this.Dr=new wi,this.vr=function(t,n){return new Ls(t,(function(t){return e.No.ul(t)}))}(this.Dr)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.Di=function(){return this.$a=!1,Promise.resolve()},Object.defineProperty(t.prototype,"Ii",{get:function(){return this.$a},enumerable:!1,configurable:!0}),t.prototype.Za=function(){},t.prototype.th=function(){},t.prototype.Ah=function(){return this.Dr},t.prototype.Th=function(t){var e=this.cl[t.ti()];return e||(e=new Ps(this.Dr,this.No),this.cl[t.ti()]=e),e},t.prototype.Ih=function(){return this.ja},t.prototype.mh=function(){return this.vr},t.prototype.runTransaction=function(t,e,n){var r=this;y("MemoryPersistence","Starting transaction:",t);var i=new Ms(this.Ma.next());return this.No.ll(),n(i).next((function(t){return r.No._l(i).next((function(){return t}))})).xn().then((function(t){return i.br(),t}))},t.prototype.fl=function(t,e){return Zn.On(Object.values(this.cl).map((function(n){return function(){return n.Ho(t,e)}})))},t}(),Ms=function(t){function n(e){var n=this;return(n=t.call(this)||this).Fa=e,n}return Object(e.c)(n,t),n}(Ur),Us=function(){function t(t){this.persistence=t,this.dl=new lo,this.wl=null}return t.El=function(e){return new t(e)},Object.defineProperty(t.prototype,"Tl",{get:function(){if(this.wl)return this.wl;throw E()},enumerable:!1,configurable:!0}),t.prototype.Da=function(t,e,n){return this.dl.Da(n,e),this.Tl.delete(n.toString()),Zn.resolve()},t.prototype.Na=function(t,e,n){return this.dl.Na(n,e),this.Tl.add(n.toString()),Zn.resolve()},t.prototype.Go=function(t,e){return this.Tl.add(e.toString()),Zn.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.dl.Kh(e.targetId).forEach((function(t){return n.Tl.add(t.toString())}));var r=this.persistence.Ih();return r.xa(t,e.targetId).next((function(t){t.forEach((function(t){return n.Tl.add(t.toString())}))})).next((function(){return r.ya(t,e)}))},t.prototype.ll=function(){this.wl=new Set},t.prototype._l=function(t){var e=this,n=this.persistence.mh().ra();return Zn.forEach(this.Tl,(function(r){var i=W.H(r);return e.Il(t,i).next((function(t){t||n.Ar(i)}))})).next((function(){return e.wl=null,n.apply(t)}))},t.prototype.yh=function(t,e){var n=this;return this.Il(t,e).next((function(t){t?n.Tl.delete(e.toString()):n.Tl.add(e.toString())}))},t.prototype.ul=function(t){return 0},t.prototype.Il=function(t,e){var n=this;return Zn.On([function(){return Zn.resolve(n.dl.Ho(e))},function(){return n.persistence.Ih().Ho(t,e)},function(){return n.persistence.fl(t,e)}])},t}(),qs=function(){function t(t){this.ml=t.ml,this.Al=t.Al}return t.prototype.gc=function(t){this.Rl=t},t.prototype.Ic=function(t){this.Pl=t},t.prototype.onMessage=function(t){this.gl=t},t.prototype.close=function(){this.Al()},t.prototype.send=function(t){this.ml(t)},t.prototype.Vl=function(){this.Rl()},t.prototype.yl=function(t){this.Pl(t)},t.prototype.pl=function(t){this.gl(t)},t}(),Fs={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Gs=function(t){function n(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.T=e.T,n}return Object(e.c)(n,t),n.prototype.Nl=function(t,e,n,r){return new Promise((function(i,o){var u=new h.d;u.listenOnce(h.b.COMPLETE,(function(){try{switch(u.getLastErrorCode()){case h.a.NO_ERROR:var e=u.getResponseJson();y("Connection","XHR received:",JSON.stringify(e)),i(e);break;case h.a.TIMEOUT:y("Connection",'RPC "'+t+'" timed out'),o(new l(b.DEADLINE_EXCEEDED,"Request time out"));break;case h.a.HTTP_ERROR:var n=u.getStatus();if(y("Connection",'RPC "'+t+'" failed with status:',n,"response text:",u.getResponseText()),n>0){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var s=function(t){var e=t.toLowerCase().replace("_","-");return Object.values(b).indexOf(e)>=0?e:b.UNKNOWN}(r.status);o(new l(s,r.message))}else o(new l(b.UNKNOWN,"Server responded with status "+u.getStatus()))}else o(new l(b.UNAVAILABLE,"Connection failed."));break;default:E()}}finally{y("Connection",'RPC "'+t+'" completed.')}}));var s=JSON.stringify(r);u.send(e,"POST",s,n,15)}))},n.prototype.Vc=function(t,e){var n=[this.vl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Object(h.e)(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this._.projectId+"/databases/"+this._.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.T};this.Cl(i.initMessageHeaders,e),Object(c.x)()||Object(c.A)()||Object(c.t)()||Object(c.v)()||Object(c.B)()||Object(c.s)()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");y("Connection","Creating WebChannel: "+o,i);var u=r.createWebChannel(o,i),s=!1,f=!1,d=new qs({ml:function(t){f?y("Connection","Not sending because WebChannel is closed:",t):(s||(y("Connection","Opening WebChannel transport."),u.open(),s=!0),y("Connection","WebChannel sending:",t),u.send(t))},Al:function(){return u.close()}}),v=function(t,e){u.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return v(h.c.EventType.OPEN,(function(){f||y("Connection","WebChannel transport opened.")})),v(h.c.EventType.CLOSE,(function(){f||(f=!0,y("Connection","WebChannel transport closed"),d.yl())})),v(h.c.EventType.ERROR,(function(t){f||(f=!0,w("Connection","WebChannel transport errored:",t),d.yl(new l(b.UNAVAILABLE,"The operation could not be completed")))})),v(h.c.EventType.MESSAGE,(function(t){var e;if(!f){var n=t.data[0];_(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){y("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=et[t];if(void 0!==e)return ut(e)}(o),a=i.message;void 0===s&&(s=b.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),f=!0,d.yl(new l(s,a)),u.close()}else y("Connection","WebChannel received:",n),d.pl(n)}})),setTimeout((function(){d.Vl()}),0),d},n}(function(){function t(t){this.bl=t,this._=t._;var e=t.ssl?"https":"http";this.vl=e+"://"+t.host,this.Sl="projects/"+this._.projectId+"/databases/"+this._.database+"/documents"}return t.prototype.Mc=function(t,e,n,r){var i=this.Dl(t,e);y("RestConnection","Sending: ",i,n);var o={};return this.Cl(o,r),this.Nl(t,i,o,n).then((function(t){return y("RestConnection","Received: ",t),t}),(function(e){throw w("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.$c=function(t,e,n,r){return this.Mc(t,e,n,r)},t.prototype.Cl=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.0.0",t["Content-Type"]="text/plain",e)for(var n in e.Gh)e.Gh.hasOwnProperty(n)&&(t[n]=e.Gh[n])},t.prototype.Dl=function(t,e){var n=Fs[t];return this.vl+"/v1/"+e+":"+n},t}()),Bs=function(){function t(){var t=this;this.xl=function(){return t.Fl()},this.kl=function(){return t.Ol()},this.Ml=[],this.$l()}return t.prototype.eu=function(t){this.Ml.push(t)},t.prototype.Di=function(){window.removeEventListener("online",this.xl),window.removeEventListener("offline",this.kl)},t.prototype.$l=function(){window.addEventListener("online",this.xl),window.addEventListener("offline",this.kl)},t.prototype.Fl=function(){y("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Ml;t<e.length;t++)(0,e[t])(0)},t.prototype.Ol=function(){y("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Ml;t<e.length;t++)(0,e[t])(1)},t.Ln=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),zs=function(){function t(){}return t.prototype.eu=function(t){},t.prototype.Di=function(){},t}();function Ks(t){return new ee(t,!0)}var Hs=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return this.Su=this.Ll(t),this.persistence=this.Bl(t),[4,this.persistence.start()];case 1:return e.sent(),this.ql=this.Ul(t),this.Gc=this.Kl(t),[2]}}))}))},t.prototype.Ul=function(t){return null},t.prototype.Kl=function(t){return e=this.persistence,n=new ks,r=t.Ql,new to(e,n,r);var e,n,r},t.prototype.Bl=function(t){return new Rs(Us.El)},t.prototype.Ll=function(t){return new Lr},t.prototype.terminate=function(){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(t){switch(t.label){case 0:return this.ql&&this.ql.stop(),[4,this.Su.Di()];case 1:return t.sent(),[4,this.persistence.Di()];case 2:return t.sent(),[2]}}))}))},t}(),Ws=function(t){function i(e,n,r){var i=this;return(i=t.call(this)||this).Wl=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(e.c)(i,t),i.prototype.initialize=function(n){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return[4,t.prototype.initialize.call(this,n)];case 1:return e.sent(),[4,ho(this.Gc)];case 2:return e.sent(),[4,this.Wl.initialize(this,n)];case 3:return e.sent(),[4,xs(this.Wl.fi)];case 4:return e.sent(),[4,Go(this.Wl.bu)];case 5:return e.sent(),[2]}}))}))},i.prototype.Ul=function(t){var e=this.persistence.No.wo;return new Hr(e,t.hs)},i.prototype.Bl=function(t){var e=Zi(t.bl._,t.bl.persistenceKey),n=void 0!==this.cacheSizeBytes?Kr.ao(this.cacheSizeBytes):Kr.fo,r=Ks(t.bl._);return new Xi(this.synchronizeTabs,e,t.clientId,n,t.hs,cr(),br(),r,this.Su,!!this.forceOwnership)},i.prototype.Ll=function(t){return new Lr},i}(Hs),Xs=function(t){function i(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Wl=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(e.c)(i,t),i.prototype.initialize=function(n){return Object(e.b)(this,void 0,void 0,(function(){var i,r=this;return Object(e.d)(this,(function(u){switch(u.label){case 0:return[4,t.prototype.initialize.call(this,n)];case 1:return u.sent(),i=this.Wl.fi,this.Su instanceof Pr?(this.Su.fi={er:_s.bind(null,i),nr:Ss.bind(null,i),sr:Ds.bind(null,i),pi:Ns.bind(null,i)},[4,this.Su.start()]):[3,3];case 2:u.sent(),u.label=3;case 3:return[4,this.persistence.Xa((function(t){return Object(e.b)(r,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return[4,Ts(this.Wl.fi,t)];case 1:return e.sent(),this.ql&&(t&&!this.ql.Ii?this.ql.start(this.Gc):t||this.ql.stop()),[2]}}))}))}))];case 4:return u.sent(),[2]}}))}))},i.prototype.Ll=function(t){var e=cr();if(!Pr.Ln(e))throw new l(b.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Zi(t.bl._,t.bl.persistenceKey);return new Pr(e,t.hs,n,t.clientId,t.Ql)},i}(Ws),Ys=function(){function t(){}return t.prototype.initialize=function(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r=this;return Object(e.d)(this,(function(e){switch(e.label){case 0:return this.Gc?[3,2]:(this.Gc=t.Gc,this.Su=t.Su,this.zc=this.jl(n),this.bu=this.Gl(n),this.vu=this.zl(n),this.fi=this.Hl(n,!t.synchronizeTabs),this.Su.di=function(t){return as(r.fi,t,1)},this.bu.Hc.Jl=ws.bind(null,this.fi),[4,Yo(this.bu,this.fi.Uu)]);case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.zl=function(t){return new vr},t.prototype.jl=function(t){var e,n=Ks(t.bl._),r=(e=t.bl,new Gs(e));return function(t,e,n){return new _o(t,e,n)}(t.credentials,r,n)},t.prototype.Gl=function(t){var e,n,r,i,o,u=this;return e=this.Gc,n=this.zc,r=t.hs,i=function(t){return as(u.fi,t,0)},o=Bs.Ln()?new Bs:new zs,new Oo(e,n,r,i,o)},t.prototype.Hl=function(t,e){return function(t,e,n,r,i,o,u){var s=new rs(t,e,n,r,i,o);return u&&(s.qu=!0),s}(this.Gc,this.bu,this.vu,this.Su,t.Ql,t.Du,e)},t.prototype.terminate=function(){return So(this.bu)},t}(),Qs=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.Yl(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.Yl(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Xl=function(){this.muted=!0},t.prototype.Yl=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}();function Js(t,e,n){if(!n)throw new l(b.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function $s(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new l(b.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Zs(t,e,n,r){if(!0===e&&!0===r)throw new l(b.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function tu(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":E()}function eu(t,e){if(e<=0)throw new l(b.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var nu=function(t){for(var e=0;e<t.length;++e)if(0===t[e].length)throw new l(b.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Zl=new H(t)},ru=function(t){function n(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,e)||this}return Object(e.c)(n,t),n.documentId=function(){return new n(H.j().B())},n.prototype.isEqual=function(t){return t instanceof n&&this.Zl.isEqual(t.Zl)},n}(nu),iu=new RegExp("[~\\*/\\[\\]]"),ou=function(t){this.t_=t},su=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n.prototype.e_=function(t){if(2!==t.n_)throw 1===t.n_?t.s_(this.t_+"() can only appear at the top level of your update data"):t.s_(this.t_+"() cannot be used with set() unless you pass {merge:true}");return t.Qe.push(t.path),null},n.prototype.isEqual=function(t){return t instanceof n},n}(ou);function uu(t,e,n){return new mu({n_:3,i_:e.settings.i_,methodName:t.t_,r_:n},e._,e.serializer,e.ignoreUndefinedProperties)}var au=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n.prototype.e_=function(t){return new He(t.path,new Re)},n.prototype.isEqual=function(t){return t instanceof n},n}(ou),cu=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).o_=n,r}return Object(e.c)(n,t),n.prototype.e_=function(t){var e=uu(this,t,!0),n=this.o_.map((function(t){return Ou(t,e)})),r=new Me(n);return new He(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(ou),hu=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).o_=n,r}return Object(e.c)(n,t),n.prototype.e_=function(t){var e=uu(this,t,!0),n=this.o_.map((function(t){return Ou(t,e)})),r=new qe(n);return new He(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(ou),fu=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).a_=n,r}return Object(e.c)(n,t),n.prototype.e_=function(t){var e=new Ge(t.serializer,ie(t.serializer,this.a_));return new He(t.path,e)},n.prototype.isEqual=function(t){return this===t},n}(ou),lu=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new l(b.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new l(b.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.h_=t,this.c_=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this.h_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this.c_},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.h_===t.h_&&this.c_===t.c_},t.prototype.toJSON=function(){return{latitude:this.h_,longitude:this.c_}},t.prototype.g=function(t){return N(this.h_,t.h_)||N(this.c_,t.c_)},t}(),pu=function(t){this.u_=t},du=/^__.*__$/,vu=function(t,e,n){this.l_=t,this.__=e,this.f_=n},yu=function(){function t(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}return t.prototype.d_=function(t,e){var n=[];return null!==this.Qe?n.push(new rn(t,this.data,this.Qe,e)):n.push(new nn(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new sn(t,this.fieldTransforms)),n},t}(),gu=function(){function t(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}return t.prototype.d_=function(t,e){var n=[new rn(t,this.data,this.Qe,e)];return this.fieldTransforms.length>0&&n.push(new sn(t,this.fieldTransforms)),n},t}();function bu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw E()}}var mu=function(){function t(t,e,n,r,i,o){this.settings=t,this._=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.w_(),this.fieldTransforms=i||[],this.Qe=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"n_",{get:function(){return this.settings.n_},enumerable:!1,configurable:!0}),t.prototype.E_=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this._,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Qe)},t.prototype.T_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.E_({path:n,r_:!1});return r.I_(t),r},t.prototype.m_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.E_({path:n,r_:!1});return r.w_(),r},t.prototype.A_=function(t){return this.E_({path:void 0,r_:!0})},t.prototype.s_=function(t){return xu(t,this.settings.methodName,this.settings.R_||!1,this.path,this.settings.i_)},t.prototype.contains=function(t){return void 0!==this.Qe.find((function(e){return t.M(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.M(e.field)}))},t.prototype.w_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.I_(this.path.get(t))},t.prototype.I_=function(t){if(0===t.length)throw this.s_("Document fields must not be empty");if(bu(this.n_)&&du.test(t))throw this.s_('Document fields cannot begin and end with "__"')},t}(),wu=function(){function t(t,e,n){this._=t,this.ignoreUndefinedProperties=e,this.serializer=n||Ks(t)}return t.prototype.P_=function(t,e,n,r){return void 0===r&&(r=!1),new mu({n_:t,methodName:e,i_:n,path:H.U(),r_:!1,R_:r},this._,this.serializer,this.ignoreUndefinedProperties)},t}();function Iu(t,e,n,r,i,o){void 0===o&&(o={});var u=t.P_(o.merge||o.mergeFields?2:0,e,n,i);Su("Data must be an object, but it was:",u,r);var s,a,c=Au(r,u);if(o.merge)s=new Ke(u.Qe),a=u.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,d=o.mergeFields;f<d.length;f++){var p=d[f],v=void 0;if(p instanceof nu)v=p.Zl;else{if("string"!=typeof p)throw E();v=ju(e,p,n)}if(!u.contains(v))throw new l(b.INVALID_ARGUMENT,"Field '"+v+"' is specified in your field mask but missing from your input data.");ku(h,v)||h.push(v)}s=new Ke(h),a=u.fieldTransforms.filter((function(t){return s.Je(t.field)}))}else s=null,a=u.fieldTransforms;return new yu(new fn(c),s,a)}function Eu(t,e,n,r){var i=t.P_(1,e,n);Su("Data must be an object, but it was:",i,r);var o=[],u=new ln;R(r,(function(t,r){var s=ju(e,t,n),a=i.m_(s);if(r instanceof su||r instanceof pu&&r.u_ instanceof su)o.push(s);else{var c=Ou(r,a);null!=c&&(o.push(s),u.set(s,c))}}));var s=new Ke(o);return new gu(u.Xe(),s,i.fieldTransforms)}function _u(t,e,n,r,i,o){var u=t.P_(1,e,n),s=[Du(e,r,n)],a=[i];if(o.length%2!=0)throw new l(b.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)s.push(Du(e,o[c])),a.push(o[c+1]);for(var h=[],f=new ln,d=s.length-1;d>=0;--d)if(!ku(h,s[d])){var p=s[d],v=a[d],y=u.m_(p);if(v instanceof su||v instanceof pu&&v.u_ instanceof su)h.push(p);else{var m=Ou(v,y);null!=m&&(h.push(p),f.set(p,m))}}var w=new Ke(h);return new gu(f.Xe(),w,u.fieldTransforms)}function Tu(t,e,n,r){return void 0===r&&(r=!1),Ou(n,t.P_(r?4:3,e))}function Ou(t,e){if(t instanceof pu&&(t=t.u_),Nu(t))return Su("Unsupported field value:",e,t),Au(t,e);if(t instanceof ou)return function(t,e){if(!bu(e.n_))throw e.s_(t.t_+"() can only be used with update() and set()");if(!e.path)throw e.s_(t.t_+"() is not currently supported inside arrays");var n=t.e_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.Qe.push(e.path),t instanceof Array){if(e.settings.r_&&4!==e.n_)throw e.s_("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var u=Ou(o[i],e.A_(r));null==u&&(u={nullValue:"NULL_VALUE"}),n.push(u),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ie(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=F.fromDate(t);return{timestampValue:oe(e.serializer,n)}}if(t instanceof F){var r=new F(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:oe(e.serializer,r)}}if(t instanceof lu)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof x)return{bytesValue:se(e.serializer,t.l)};if(t instanceof vu){var i=e._,o=t.l_;if(!o.isEqual(i))throw e.s_("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:ce(t.l_||e._,t.__.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.s_("Unsupported field value: "+tu(t))}(t,e)}function Au(t,e){var n={};return M(t)?e.path&&e.path.length>0&&e.Qe.push(e.path):R(t,(function(t,r){var i=Ou(r,e.T_(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Nu(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof F||t instanceof lu||t instanceof x||t instanceof vu||t instanceof ou)}function Su(t,e,n){if(!Nu(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=tu(n);throw"an object"===r?e.s_(t+" a custom object"):e.s_(t+" "+r)}}function Du(t,e,n){if(e instanceof nu)return e.Zl;if("string"==typeof e)return ju(t,e);throw xu("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function ju(t,n,r){try{return function(t){if(t.search(iu)>=0)throw new l(b.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(ru.bind.apply(ru,Object(e.g)([void 0],t.split("."))))}catch(e){throw new l(b.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(n).Zl}catch(n){throw xu((i=n)instanceof Error?i.message:i.toString(),t,!1,void 0,r)}var i}function xu(t,e,n,r,i){var o=r&&!r.P(),u=void 0!==i,s="Function "+e+"() called with invalid data";n&&(s+=" (via `toFirestore()`)");var a="";return(o||u)&&(a+=" (found",o&&(a+=" in field "+r),u&&(a+=" in document "+i),a+=")"),new l(b.INVALID_ARGUMENT,(s+=". ")+t+a)}function ku(t,e){return t.some((function(t){return t.isEqual(e)}))}var Pu=function(){function t(t){this.zc=t,this.g_=new Map,this.mutations=[],this.V_=!1,this.y_=null,this.p_=new Set}return t.prototype.b_=function(t){return Object(e.b)(this,void 0,void 0,(function(){var n,i=this;return Object(e.d)(this,(function(r){switch(r.label){case 0:if(this.v_(),this.mutations.length>0)throw new l(b.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u,s,a;return Object(e.d)(this,(function(e){switch(e.label){case 0:return r=T(t),i=ve(r.serializer)+"/documents",o={documents:n.map((function(t){return fe(r.serializer,t)}))},[4,r.$c("BatchGetDocuments",i,o)];case 1:return u=e.sent(),s=new Map,u.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){_(!!e.found),e.found.name,e.found.updateTime;var n=le(t,e.found.name),r=ae(e.found.updateTime),i=new fn({mapValue:{fields:e.found.fields}});return new vn(n,r,i,{})}(t,e):"missing"in e?function(t,e){_(!!e.missing),_(!!e.readTime);var n=le(t,e.missing),r=ae(e.readTime);return new yn(n,r)}(t,e):E()}(r.serializer,t);s.set(e.key.toString(),e)})),a=[],[2,(n.forEach((function(t){var e=s.get(t.toString());_(!!e),a.push(e)})),a)]}}))}))}(this.zc,t)];case 1:return[2,((n=r.sent()).forEach((function(t){t instanceof yn||t instanceof vn?i.S_(t):E()})),n)]}}))}))},t.prototype.set=function(t,e){this.write(e.d_(t,this.Ge(t))),this.p_.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.d_(t,this.D_(t)))}catch(t){this.y_=t}this.p_.add(t.toString())},t.prototype.delete=function(t){this.write([new cn(t,this.Ge(t))]),this.p_.add(t.toString())},t.prototype.commit=function(){return Object(e.b)(this,void 0,void 0,(function(){var t,n=this;return Object(e.d)(this,(function(i){switch(i.label){case 0:if(this.v_(),this.y_)throw this.y_;return t=this.g_,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,e){var r=W.H(e);n.mutations.push(new hn(r,n.Ge(r)))})),[4,function(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o;return Object(e.d)(this,(function(e){switch(e.label){case 0:return r=T(t),i=ve(r.serializer)+"/documents",o={writes:n.map((function(t){return be(r.serializer,t)}))},[4,r.Mc("Commit",i,o)];case 1:return e.sent(),[2]}}))}))}(this.zc,this.mutations)];case 1:return i.sent(),this.V_=!0,[2]}}))}))},t.prototype.S_=function(t){var e;if(t instanceof vn)e=t.version;else{if(!(t instanceof yn))throw E();e=G.min()}var n=this.g_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new l(b.ABORTED,"Document version changed between two reads.")}else this.g_.set(t.key.toString(),e)},t.prototype.Ge=function(t){var e=this.g_.get(t.toString());return!this.p_.has(t.toString())&&e?Xe.updateTime(e):Xe.ze()},t.prototype.D_=function(t){var e=this.g_.get(t.toString());if(!this.p_.has(t.toString())&&e){if(e.isEqual(G.min()))throw new l(b.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Xe.updateTime(e)}return Xe.exists(!0)},t.prototype.write=function(t){this.v_(),this.mutations=this.mutations.concat(t)},t.prototype.v_=function(){},t}(),Lu=function(){function t(t,e,n,r){this.hs=t,this.zc=e,this.updateFunction=n,this.ls=r,this.C_=5,this.Vs=new $n(this.hs,"transaction_retry")}return t.prototype.run=function(){this.N_()},t.prototype.N_=function(){var t=this;this.Vs.Pn((function(){return Object(e.b)(t,void 0,void 0,(function(){var t,n,r=this;return Object(e.d)(this,(function(e){return t=new Pu(this.zc),(n=this.x_(t))&&n.then((function(e){r.hs.ws((function(){return t.commit().then((function(){r.ls.resolve(e)})).catch((function(t){r.F_(t)}))}))})).catch((function(t){r.F_(t)})),[2]}))}))}))},t.prototype.x_=function(t){try{var e=this.updateFunction(t);return!X(e)&&e.catch&&e.then?e:(this.ls.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.ls.reject(t),null}},t.prototype.F_=function(t){var e=this;this.C_>0&&this.k_(t)?(this.C_-=1,this.hs.ws((function(){return e.N_(),Promise.resolve()}))):this.ls.reject(t)},t.prototype.k_=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!st(e)}return!1},t}(),Cu=function(){function t(t,e){this.credentials=t,this.hs=e,this.clientId=A.t(),this.O_=new Jn}return t.prototype.start=function(t,n,i){var r=this;this.M_(),this.bl=t;var u=new Jn,s=!1;return this.credentials.Jh((function(t){if(!s)return s=!0,y("FirestoreClient","Initializing. user=",t.uid),r.L_(n,i,t,u).then(r.O_.resolve,r.O_.reject);r.hs.Cs((function(){return function(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i;return Object(e.d)(this,(function(e){switch(e.label){case 0:return(r=T(t)).hs.Fs(),y("RemoteStore","RemoteStore received new credentials"),i=Co(r),r.Xc.add(3),[4,No(r)];case 1:return e.sent(),i&&r.nu.set("Unknown"),[4,r.Hc.Jl(n)];case 2:return e.sent(),r.Xc.delete(3),[4,Ao(r)];case 3:return e.sent(),[2]}}))}))}(r.bu,t)}))})),this.hs.ws((function(){return r.O_.promise})),u.promise},t.prototype.enableNetwork=function(){var t=this;return this.M_(),this.hs.enqueue((function(){return t.persistence.th(!0),function(t){var e=T(t);return e.Xc.delete(0),Ao(e)}(t.bu)}))},t.prototype.L_=function(t,n,i,r){return Object(e.b)(this,void 0,void 0,(function(){var u,s,a=this;return Object(e.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),u={hs:this.hs,bl:this.bl,clientId:this.clientId,credentials:this.credentials,Ql:i,Du:100},[4,t.initialize(u)];case 1:return o.sent(),[4,n.initialize(t,u)];case 2:return o.sent(),this.persistence=t.persistence,this.Su=t.Su,this.Gc=t.Gc,this.ql=t.ql,this.zc=n.zc,this.bu=n.bu,this.fi=n.fi,this.B_=n.vu,this.B_.Us=is.bind(null,this.fi),this.B_.Ws=ss.bind(null,this.fi),this.persistence.Za((function(){return Object(e.b)(a,void 0,void 0,(function(){return Object(e.d)(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))})),r.resolve(),[3,4];case 3:if(s=o.sent(),r.reject(s),!function(t){return"FirebaseError"===t.name?t.code===b.FAILED_PRECONDITION||t.code===b.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(s))throw s;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+s),this.L_(new Hs,new Ys,i,r))];case 4:return[2]}}))}))},t.prototype.M_=function(){if(this.hs.ps)throw new l(b.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.disableNetwork=function(){var t=this;return this.M_(),this.hs.enqueue((function(){return t.persistence.th(!1),function(t){return Object(e.b)(this,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){switch(e.label){case 0:return(n=T(t)).Xc.add(0),[4,No(n)];case 1:return e.sent(),n.nu.set("Offline"),[2]}}))}))}(t.bu)}))},t.prototype.terminate=function(){var t=this;this.hs.Ds();var n=new Jn;return this.hs.bs((function(){return Object(e.b)(t,void 0,void 0,(function(){var t,r;return Object(e.d)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),this.ql&&this.ql.stop(),[4,So(this.bu)];case 1:return e.sent(),[4,this.Su.Di()];case 2:return e.sent(),[4,this.persistence.Di()];case 3:return e.sent(),this.credentials.Yh(),n.resolve(),[3,5];case 4:return t=e.sent(),r=pr(t,"Failed to shutdown persistence"),n.reject(r),[3,5];case 5:return[2]}}))}))})),n.promise},t.prototype.waitForPendingWrites=function(){var t=this;this.M_();var n=new Jn;return this.hs.ws((function(){return function(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u,s;return Object(e.d)(this,(function(e){switch(e.label){case 0:Co((r=T(t)).bu)||y("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,function(t){var e=T(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e.Sr.qo(t)}))}(r.Gc)];case 2:return-1===(i=e.sent())?[2,void n.resolve()]:((o=r.Lu.get(i)||[]).push(n),r.Lu.set(i,o),[3,4]);case 3:return u=e.sent(),s=pr(u,"Initialization of waitForPendingWrites() operation failed"),n.reject(s),[3,4];case 4:return[2]}}))}))}(t.fi,n)})),n.promise},t.prototype.listen=function(t,e,n){var r=this;this.M_();var i=new Qs(n),o=new Er(t,i,e);return this.hs.ws((function(){return yr(r.B_,o)})),function(){i.Xl(),r.hs.ws((function(){return gr(r.B_,o)}))}},t.prototype.q_=function(t){return Object(e.b)(this,void 0,void 0,(function(){var n,i=this;return Object(e.d)(this,(function(r){switch(r.label){case 0:return this.M_(),[4,this.O_.promise];case 1:return r.sent(),n=new Jn,[2,(this.hs.ws((function(){return function(t,n,i){return Object(e.b)(this,void 0,void 0,(function(){var r,o,u;return Object(e.d)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,function(t,e){var n=T(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Nh.Cr(t,e)}))}(t,n)];case 1:return(r=e.sent())instanceof vn?i.resolve(r):r instanceof yn?i.resolve(null):i.reject(new l(b.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return o=e.sent(),u=pr(o,"Failed to get document '"+n+" from cache"),i.reject(u),[3,3];case 3:return[2]}}))}))}(i.Gc,t,n)})),n.promise)]}}))}))},t.prototype.U_=function(t,n){return void 0===n&&(n={}),Object(e.b)(this,void 0,void 0,(function(){var r,i=this;return Object(e.d)(this,(function(e){switch(e.label){case 0:return this.M_(),[4,this.O_.promise];case 1:return e.sent(),r=new Jn,[2,(this.hs.ws((function(){return function(t,e,n,r,i){var o=new Qs({next:function(o){e.ws((function(){return gr(t,u)}));var s=o.docs.has(n);!s&&o.fromCache?i.reject(new l(b.UNAVAILABLE,"Failed to get document because the client is offline.")):s&&o.fromCache&&r&&"server"===r.source?i.reject(new l(b.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),u=new Er(wn(n.path),o,{includeMetadataChanges:!0,Xs:!0});return yr(t,u)}(i.B_,i.hs,t,n,r)})),r.promise)]}}))}))},t.prototype.K_=function(t){return Object(e.b)(this,void 0,void 0,(function(){var n,i=this;return Object(e.d)(this,(function(r){switch(r.label){case 0:return this.M_(),[4,this.O_.promise];case 1:return r.sent(),n=new Jn,[2,(this.hs.ws((function(){return function(t,n,i){return Object(e.b)(this,void 0,void 0,(function(){var r,o,u,s,a,c;return Object(e.d)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,uo(t,n,!0)];case 1:return r=e.sent(),o=new ts(n,r.Fh),u=o.Eu(r.documents),s=o.Vr(u,!1),i.resolve(s.snapshot),[3,3];case 2:return a=e.sent(),c=pr(a,"Failed to execute query '"+n+" against cache"),i.reject(c),[3,3];case 3:return[2]}}))}))}(i.Gc,t,n)})),n.promise)]}}))}))},t.prototype.Q_=function(t,n){return void 0===n&&(n={}),Object(e.b)(this,void 0,void 0,(function(){var r,i=this;return Object(e.d)(this,(function(e){switch(e.label){case 0:return this.M_(),[4,this.O_.promise];case 1:return e.sent(),r=new Jn,[2,(this.hs.ws((function(){return function(t,e,n,r,i){var o=new Qs({next:function(n){e.ws((function(){return gr(t,u)})),n.fromCache&&"server"===r.source?i.reject(new l(b.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),u=new Er(n,o,{includeMetadataChanges:!0,Xs:!0});return yr(t,u)}(i.B_,i.hs,t,n,r)})),r.promise)]}}))}))},t.prototype.write=function(t){var n=this;this.M_();var i=new Jn;return this.hs.ws((function(){return function(t,n,i){return Object(e.b)(this,void 0,void 0,(function(){var r,o,u,s;return Object(e.d)(this,(function(e){switch(e.label){case 0:r=xs(t),e.label=1;case 1:return e.trys.push([1,5,,6]),[4,function(t,e){var n,r=T(t),i=F.now(),o=e.reduce((function(t,e){return t.add(e.key)}),wt());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Nh.Or(t,o).next((function(o){n=o;for(var u=[],s=0,a=e;s<a.length;s++){var c=a[s],h=Ze(c,n.get(c.key));null!=h&&u.push(new rn(c.key,h,pn(h.proto.mapValue),Xe.exists(!0)))}return r.Sr.Oo(t,i,u,e)}))})).then((function(t){var e=t.lr(n);return{batchId:t.batchId,wr:e}}))}(r.Gc,n)];case 2:return o=e.sent(),r.Su.Fi(o.batchId),function(t,e,n){var r=t.$u[t.currentUser.ti()];r||(r=new dt(N)),r=r.ot(e,n),t.$u[t.currentUser.ti()]=r}(r,o.batchId,i),[4,ms(r,o.wr)];case 3:return e.sent(),[4,Go(r.bu)];case 4:return e.sent(),[3,6];case 5:return u=e.sent(),s=pr(u,"Failed to persist write"),i.reject(s),[3,6];case 6:return[2]}}))}))}(n.fi,t,i)})),i.promise},t.prototype._=function(){return this.bl._},t.prototype.W_=function(t){var n=this;this.M_();var i=new Qs(t);return this.hs.ws((function(){return Object(e.b)(n,void 0,void 0,(function(){return Object(e.d)(this,(function(t){return[2,function(t,e){T(t).qs.add(e),e.next()}(this.B_,i)]}))}))})),function(){i.Xl(),n.hs.ws((function(){return Object(e.b)(n,void 0,void 0,(function(){return Object(e.d)(this,(function(t){return[2,function(t,e){T(t).qs.delete(e)}(this.B_,i)]}))}))}))}},Object.defineProperty(t.prototype,"j_",{get:function(){return this.hs.ps},enumerable:!1,configurable:!0}),t.prototype.transaction=function(t){var e=this;this.M_();var n=new Jn;return this.hs.ws((function(){return new Lu(e.hs,e.zc,t,n).run(),Promise.resolve()})),n.promise},t}();function Vu(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var Ru=function(){function t(t,e,n,r){this._=t,this.G_=e,this.z_=n,this.H_=r}return t.prototype.J_=function(t){switch(Mt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Kt(t.integerValue||t.doubleValue);case 3:return this.Y_(t.timestampValue);case 4:return this.X_(t);case 5:return t.stringValue;case 6:return this.H_(Ht(t.bytesValue));case 7:return this.Z_(t.referenceValue);case 8:return this.tf(t.geoPointValue);case 9:return this.ef(t.arrayValue);case 10:return this.nf(t.mapValue);default:throw E()}},t.prototype.nf=function(t){var e=this,n={};return R(t.fields||{},(function(t,r){n[t]=e.J_(r)})),n},t.prototype.tf=function(t){return new lu(Kt(t.latitude),Kt(t.longitude))},t.prototype.ef=function(t){var e=this;return(t.values||[]).map((function(t){return e.J_(t)}))},t.prototype.X_=function(t){switch(this.G_){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return Ct(n)?t(n):n}(t);return null==e?null:this.J_(e);case"estimate":return this.Y_(Vt(t));default:return null}},t.prototype.Y_=function(t){var e=zt(t);return new F(e.seconds,e.nanos)},t.prototype.Z_=function(t){var e=z.q(t);_(ke(e));var n=new C(e.get(1),e.get(3)),r=new W(e.N(5));return n.isEqual(this._)||m("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this._.projectId+"/"+this._.database+") instead."),this.z_(r)},t}(),Mu=Kr.uo,Uu=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new l(b.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=Kr._o;else{if(t.cacheSizeBytes!==Mu&&t.cacheSizeBytes<Kr.lo)throw new l(b.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Kr.lo);this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,Zs("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),qu="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Fu=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){throw new l(b.FAILED_PRECONDITION,qu)},t.prototype.enableMultiTabIndexedDbPersistence=function(t){throw new l(b.FAILED_PRECONDITION,qu)},t.prototype.clearIndexedDbPersistence=function(t){throw new l(b.FAILED_PRECONDITION,qu)},t}(),Gu=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){var n=new Ys,r=new Ws(n,t.sf().cacheSizeBytes,e);return t.if(r,n)},t.prototype.enableMultiTabIndexedDbPersistence=function(t){var e=new Ys,n=new Xs(e,t.sf().cacheSizeBytes);return t.if(n,e)},t.prototype.clearIndexedDbPersistence=function(t){var n=this,i=new Jn;return t.rf.bs((function(){return Object(e.b)(n,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(e.b)(this,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){switch(e.label){case 0:return hr.Ln()?(n=t+"main",[4,hr.delete(n)]):[2,Promise.resolve()];case 1:return e.sent(),[2]}}))}))}(Zi(t.l_,t.af))];case 1:return r.sent(),i.resolve(),[3,3];case 2:return n=r.sent(),i.reject(n),[3,3];case 3:return[2]}}))}))})),i.promise},t}(),Bu=function(){function t(n,i,r){var u=this;if(void 0===r&&(r=new Fu),this.hf=r,this.cf=null,this.rf=new lr,this.INTERNAL={delete:function(){return Object(e.b)(u,void 0,void 0,(function(){return Object(e.d)(this,(function(t){switch(t.label){case 0:return this.uf(),[4,this.lf.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof n.options){var s=n;this.cf=s,this.l_=t._f(s),this.af=s.name,this.ff=new go(i)}else{var a=n;if(!a.projectId)throw new l(b.INVALID_ARGUMENT,"Must provide projectId");this.l_=new C(a.projectId,a.database),this.af="[DEFAULT]",this.ff=new yo}this.df=new Uu({})}return Object.defineProperty(t.prototype,"wf",{get:function(){return this.Ef||(this.Ef=new wu(this.l_,this.df.ignoreUndefinedProperties)),this.Ef},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this.df),t)).merge;var e=new Uu(t);if(this.lf&&!this.df.isEqual(e))throw new l(b.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.df=e,void 0!==e.credentials&&(this.ff=function(t){if(!t)return new yo;switch(t.type){case"gapi":var e=t.client;return _(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new mo(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new l(b.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},t.prototype.useEmulator=function(t,e){"firestore.googleapis.com"!==this.df.host&&w("Host has been set in both settings() and useEmulator(), emulator host will be used"),this.settings({host:t+":"+e,ssl:!1,merge:!0})},t.prototype.enableNetwork=function(){return this.uf(),this.lf.enableNetwork()},t.prototype.disableNetwork=function(){return this.uf(),this.lf.disableNetwork()},t.prototype.enablePersistence=function(t){if(this.lf)throw new l(b.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1,n=!1;return t&&Zs("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.hf.enableMultiTabIndexedDbPersistence(this):this.hf.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(t){if(void 0!==this.lf&&!this.lf.j_)throw new l(b.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return[2,this.hf.clearIndexedDbPersistence(this)]}))}))},t.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(t.prototype,"Tf",{get:function(){return this.uf(),this.lf.j_},enumerable:!1,configurable:!0}),t.prototype.waitForPendingWrites=function(){return this.uf(),this.lf.waitForPendingWrites()},t.prototype.onSnapshotsInSync=function(t){if(this.uf(),Vu(t))return this.lf.W_(t);var e={next:t};return this.lf.W_(e)},t.prototype.uf=function(){return this.lf||this.if(new Hs,new Ys),this.lf},t.prototype.If=function(){return new L(this.l_,this.af,this.df.host,this.df.ssl,this.df.experimentalForceLongPolling,this.df.experimentalAutoDetectLongPolling)},t.prototype.if=function(t,e){var n=this.If();return this.lf=new Cu(this.ff,this.rf),this.lf.start(n,t,e)},t._f=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new l(b.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new l(b.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new C(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.cf)throw new l(b.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.cf},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){return Js("Firestore.collection","path",t),this.uf(),new na(z.q(t),this,null)},t.prototype.doc=function(t){return Js("Firestore.doc","path",t),this.uf(),Hu.mf(z.q(t),this,null)},t.prototype.collectionGroup=function(t){if(Js("Firestore.collectionGroup","collectionId",t),t.indexOf("/")>=0)throw new l(b.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.uf(),new ta(function(t){return new bn(z.U(),t)}(t),this,null)},t.prototype.runTransaction=function(t){var e=this;return this.uf().transaction((function(n){return t(new zu(e,n))}))},t.prototype.batch=function(){return this.uf(),new Ku(this)},t.prototype.sf=function(){return this.df},t}(),zu=function(){function t(t,e){this.Af=t,this.Rf=e}return t.prototype.get=function(t){var e=this,n=ra("Transaction.get",t,this.Af);return this.Rf.b_([n.__]).then((function(t){if(!t||1!==t.length)return E();var r=t[0];if(r instanceof yn)return new Xu(e.Af,n.__,null,!1,!1,n.f_);if(r instanceof vn)return new Xu(e.Af,n.__,r,!1,!1,n.f_);throw E()}))},t.prototype.set=function(t,e,n){var r=ra("Transaction.set",t,this.Af);n=$s("Transaction.set",n);var i=oa(r.f_,e,n),o=Iu(this.Af.wf,"Transaction.set",r.__,i,null!==r.f_,n);return this.Rf.set(r.__,o),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],u=3;u<arguments.length;u++)o[u-3]=arguments[u];return"string"==typeof e||e instanceof ru?(r=ra("Transaction.update",t,this.Af),i=_u(this.Af.wf,"Transaction.update",r.__,e,n,o)):(r=ra("Transaction.update",t,this.Af),i=Eu(this.Af.wf,"Transaction.update",r.__,e)),this.Rf.update(r.__,i),this},t.prototype.delete=function(t){var e=ra("Transaction.delete",t,this.Af);return this.Rf.delete(e.__),this},t}(),Ku=function(){function t(t){this.Af=t,this.Pf=[],this.gf=!1}return t.prototype.set=function(t,e,n){this.Vf();var r=ra("WriteBatch.set",t,this.Af);n=$s("WriteBatch.set",n);var i=oa(r.f_,e,n),o=Iu(this.Af.wf,"WriteBatch.set",r.__,i,null!==r.f_,n);return this.Pf=this.Pf.concat(o.d_(r.__,Xe.ze())),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],u=3;u<arguments.length;u++)o[u-3]=arguments[u];return this.Vf(),"string"==typeof e||e instanceof ru?(r=ra("WriteBatch.update",t,this.Af),i=_u(this.Af.wf,"WriteBatch.update",r.__,e,n,o)):(r=ra("WriteBatch.update",t,this.Af),i=Eu(this.Af.wf,"WriteBatch.update",r.__,e)),this.Pf=this.Pf.concat(i.d_(r.__,Xe.exists(!0))),this},t.prototype.delete=function(t){this.Vf();var e=ra("WriteBatch.delete",t,this.Af);return this.Pf=this.Pf.concat(new cn(e.__,Xe.ze())),this},t.prototype.commit=function(){return this.Vf(),this.gf=!0,this.Pf.length>0?this.Af.uf().write(this.Pf):Promise.resolve()},t.prototype.Vf=function(){if(this.gf)throw new l(b.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),Hu=function(t){function n(e,n,r){var i=this;return(i=t.call(this,n.l_,e,r)||this).__=e,i.firestore=n,i.f_=r,i.lf=i.firestore.uf(),i}return Object(e.c)(n,t),n.mf=function(t,e,r){if(t.length%2!=0)throw new l(b.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.B()+" has "+t.length);return new n(new W(t),e,r)},Object.defineProperty(n.prototype,"id",{get:function(){return this.__.path.O()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return new na(this.__.path.F(),this.firestore,this.f_)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this.__.path.B()},enumerable:!1,configurable:!0}),n.prototype.collection=function(t){if(Js("DocumentReference.collection","path",t),!t)throw new l(b.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=z.q(t);return new na(this.__.path.child(e),this.firestore,null)},n.prototype.isEqual=function(t){return t instanceof n&&this.firestore===t.firestore&&this.__.isEqual(t.__)&&this.f_===t.f_},n.prototype.set=function(t,e){e=$s("DocumentReference.set",e);var n=oa(this.f_,t,e),r=Iu(this.firestore.wf,"DocumentReference.set",this.__,n,null!==this.f_,e);return this.lf.write(r.d_(this.__,Xe.ze()))},n.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof ru?_u(this.firestore.wf,"DocumentReference.update",this.__,t,e,r):Eu(this.firestore.wf,"DocumentReference.update",this.__,t),this.lf.write(n.d_(this.__,Xe.exists(!0)))},n.prototype.delete=function(){return this.lf.write([new cn(this.__,Xe.ze())])},n.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var u={includeMetadataChanges:!1},s=0;"object"!=typeof i[s]||Vu(i[s])||(u=i[s],s++);var a={includeMetadataChanges:u.includeMetadataChanges};if(Vu(i[s])){var c=i[s];i[s]=null===(t=c.next)||void 0===t?void 0:t.bind(c),i[s+1]=null===(e=c.error)||void 0===e?void 0:e.bind(c),i[s+2]=null===(n=c.complete)||void 0===n?void 0:n.bind(c)}var h={next:function(t){i[s]&&i[s](r.yf(t))},error:i[s+1],complete:i[s+2]};return this.lf.listen(wn(this.__.path),a,h)},n.prototype.get=function(t){var e=this,n=this.firestore.uf();return t&&"cache"===t.source?n.q_(this.__).then((function(t){return new Xu(e.firestore,e.__,t,!0,t instanceof vn&&t.Ye,e.f_)})):n.U_(this.__,t).then((function(t){return e.yf(t)}))},n.prototype.withConverter=function(t){return new n(this.__,this.firestore,t)},n.prototype.yf=function(t){var e=t.docs.get(this.__);return new Xu(this.firestore,this.__,e,t.fromCache,t.hasPendingWrites,this.f_)},n}(vu),Wu=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Xu=function(){function t(t,e,n,r,i,o){this.Af=t,this.__=e,this.pf=n,this.bf=r,this.vf=i,this.f_=o}return t.prototype.data=function(t){var e=this;if(void 0===t&&(t={}),this.pf){if(this.f_){var n=new Yu(this.Af,this.__,this.pf,this.bf,this.vf,null);return this.f_.fromFirestore(n,t)}return new Ru(this.Af.l_,t.serverTimestamps||"none",(function(t){return new Hu(t,e.Af,null)}),(function(t){return new P(t)})).J_(this.pf.rn())}},t.prototype.get=function(t,e){var n=this;if(void 0===e&&(e={}),this.pf){var r=this.pf.data().field(Du("DocumentSnapshot.get",t,this.__));if(null!==r)return new Ru(this.Af.l_,e.serverTimestamps||"none",(function(t){return new Hu(t,n.Af,n.f_)}),(function(t){return new P(t)})).J_(r)}},Object.defineProperty(t.prototype,"id",{get:function(){return this.__.path.O()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Hu(this.__,this.Af,this.f_)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this.pf},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new Wu(this.vf,this.bf)},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&this.Af===e.Af&&this.bf===e.bf&&this.__.isEqual(e.__)&&(null===this.pf?null===e.pf:this.pf.isEqual(e.pf))&&this.f_===e.f_},t}(),Yu=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n.prototype.data=function(e){return t.prototype.data.call(this,e)},n}(Xu);function Qu(t,e,n){if("string"==typeof n){if(""===n)throw new l(b.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!On(e)&&-1!==n.indexOf("/"))throw new l(b.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(z.q(n));if(!W.X(r))throw new l(b.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Wt(t,new W(r))}if(n instanceof vu)return Wt(t,n.__);throw new l(b.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+tu(n)+".")}function Ju(t,e){if(!Array.isArray(t)||0===t.length)throw new l(b.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new l(b.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function $u(t,e,n){if(!n.isEqual(e))throw new l(b.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function Zu(t){if(En(t)&&0===t.on.length)throw new l(b.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ta=function(){function t(t,e,n){this.Sf=t,this.firestore=e,this.f_=n}return t.prototype.where=function(e,n,r){var i=Du("Query.where",e),o=function(t,e,n,r,i,o,u){var s;if(i.W()){if("array-contains"===o||"array-contains-any"===o)throw new l(b.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Ju(u,o);for(var a=[],c=0,h=u;c<h.length;c++){var f=h[c];a.push(Qu(r,t,f))}s={arrayValue:{values:a}}}else s=Qu(r,t,u)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Ju(u,o),s=Tu(n,"Query.where",u,"in"===o||"not-in"===o);var d=Vn.create(i,o,s);return function(t,e){if(e.un()){var n=Tn(t);if(null!==n&&!n.isEqual(e.field))throw new l(b.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=_n(t);null!==r&&$u(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new l(b.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new l(b.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,d),d}(this.Sf,0,this.firestore.wf,this.firestore.l_,i,n,r);return new t(function(t,e){var n=t.filters.concat([e]);return new bn(t.path,t.collectionGroup,t.on.slice(),n,t.limit,t.an,t.startAt,t.endAt)}(this.Sf,o),this.firestore,this.f_)},t.prototype.orderBy=function(e,n){var r;if(void 0===n||"asc"===n)r="asc";else{if("desc"!==n)throw new l(b.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r="desc"}var i=Du("Query.orderBy",e),o=function(t,e,n){if(null!==t.startAt)throw new l(b.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new l(b.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Xn(e,n);return function(t,e){if(null===_n(t)){var n=Tn(t);null!==n&&$u(0,n,e.field)}}(t,r),r}(this.Sf,i,r);return new t(function(t,e){var n=t.on.concat([e]);return new bn(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.an,t.startAt,t.endAt)}(this.Sf,o),this.firestore,this.f_)},t.prototype.limit=function(e){return eu("Query.limit",e),new t(Sn(this.Sf,e,"F"),this.firestore,this.f_)},t.prototype.limitToLast=function(e){return eu("Query.limitToLast",e),new t(Sn(this.Sf,e,"L"),this.firestore,this.f_)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.Df("Query.startAt",e,n,!0);return new t(Dn(this.Sf,i),this.firestore,this.f_)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.Df("Query.startAfter",e,n,!1);return new t(Dn(this.Sf,i),this.firestore,this.f_)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.Df("Query.endBefore",e,n,!0);return new t(jn(this.Sf,i),this.firestore,this.f_)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.Df("Query.endAt",e,n,!1);return new t(jn(this.Sf,i),this.firestore,this.f_)},t.prototype.isEqual=function(e){return e instanceof t&&this.firestore===e.firestore&&xn(this.Sf,e.Sf)&&this.f_===e.f_},t.prototype.withConverter=function(e){return new t(this.Sf,this.firestore,e)},t.prototype.Df=function(t,e,n,r){if(e instanceof Xu)return function(t,e,n,r,i){if(!r)throw new l(b.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],u=0,s=An(t);u<s.length;u++){var a=s[u];if(a.field.W())o.push(Wt(e,r.key));else{var c=r.field(a.field);if(Ct(c))throw new l(b.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=a.field.B();throw new l(b.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new tr(o,i)}(this.Sf,this.firestore.l_,t,e.pf,r);var i=[e].concat(n);return function(t,e,n,r,i,o){var u=t.on;if(i.length>u.length)throw new l(b.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var s=[],a=0;a<i.length;a++){var c=i[a];if(u[a].field.W()){if("string"!=typeof c)throw new l(b.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!On(t)&&-1!==c.indexOf("/"))throw new l(b.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(z.q(c));if(!W.X(h))throw new l(b.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var f=new W(h);s.push(Wt(e,f))}else{var d=Tu(n,r,c);s.push(d)}}return new tr(s,o)}(this.Sf,this.firestore.l_,this.firestore.wf,t,i,r)},t.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var u={},s=0;if("object"!=typeof i[s]||Vu(i[s])||(u=i[s],s++),Vu(i[s])){var a=i[s];i[s]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[s+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[s+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)}var c={next:function(t){i[s]&&i[s](new ea(r.firestore,r.Sf,t,r.f_))},error:i[s+1],complete:i[s+2]};return Zu(this.Sf),this.firestore.uf().listen(this.Sf,u,c)},t.prototype.get=function(t){var e=this;Zu(this.Sf);var n=this.firestore.uf();return(t&&"cache"===t.source?n.K_(this.Sf):n.Q_(this.Sf,t)).then((function(t){return new ea(e.firestore,e.Sf,t,e.f_)}))},t}(),ea=function(){function t(t,e,n,r){this.Af=t,this.Cf=e,this.Nf=n,this.f_=r,this.xf=null,this.Ff=null,this.metadata=new Wu(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this.Nf.docs.P()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.Nf.docs.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this.Nf.docs.forEach((function(r){t.call(e,n.kf(r,n.metadata.fromCache,n.Nf.Qt.has(r.key)))}))},Object.defineProperty(t.prototype,"query",{get:function(){return new ta(this.Cf,this.Af,this.f_)},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=!(!t||!t.includeMetadataChanges);if(e&&this.Nf.jt)throw new l(b.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.xf&&this.Ff===e||(this.xf=function(t,e,n){if(t.Kt.P()){var r=0;return t.docChanges.map((function(e){var i=n(e.doc,t.fromCache,t.Qt.has(e.doc.key));return e.doc,{type:"added",doc:i,oldIndex:-1,newIndex:r++}}))}var i=t.Kt;return t.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var r=n(e.doc,t.fromCache,t.Qt.has(e.doc.key)),o=-1,u=-1;return 0!==e.type&&(o=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(u=(i=i.add(e.doc)).indexOf(e.doc.key)),{type:ia(e.type),doc:r,oldIndex:o,newIndex:u}}))}(this.Nf,e,this.kf.bind(this)),this.Ff=e),this.xf},t.prototype.isEqual=function(e){return e instanceof t&&this.Af===e.Af&&xn(this.Cf,e.Cf)&&this.Nf.isEqual(e.Nf)&&this.f_===e.f_},t.prototype.kf=function(t,e,n){return new Yu(this.Af,t.key,t,e,n,this.f_)},t}(),na=function(t){function n(e,n,r){var i=this;if((i=t.call(this,wn(e),n,r)||this).Of=e,e.length%2!=1)throw new l(b.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.B()+" has "+e.length);return i}return Object(e.c)(n,t),Object.defineProperty(n.prototype,"id",{get:function(){return this.Sf.path.O()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var t=this.Sf.path.F();return t.P()?null:new Hu(new W(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this.Sf.path.B()},enumerable:!1,configurable:!0}),n.prototype.doc=function(t){0===arguments.length&&(t=A.t()),Js("CollectionReference.doc","path",t);var e=z.q(t);return Hu.mf(this.Sf.path.child(e),this.firestore,this.f_)},n.prototype.add=function(t){var e=this.f_?this.f_.toFirestore(t):t,n=this.doc();return new Hu(n.__,this.firestore,null).set(e).then((function(){return n}))},n.prototype.withConverter=function(t){return new n(this.Of,this.firestore,t)},n}(ta);function ra(t,e,n){var r=function(t,e){if(!(t instanceof e)){if(e.name===t.constructor.name)throw new l(b.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=tu(t);throw new l(b.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}(e,Hu);if(r.firestore!==n)throw new l(b.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}function ia(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return E()}}function oa(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var sa,ua=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n.serverTimestamp=function(){var t=new au("serverTimestamp");return t.t_="FieldValue.serverTimestamp",new n(t)},n.delete=function(){var t=new su("deleteField");return t.t_="FieldValue.delete",new n(t)},n.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new cu("arrayUnion",t)}.apply(void 0,t);return r.t_="FieldValue.arrayUnion",new n(r)},n.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new hu("arrayRemove",t)}.apply(void 0,t);return r.t_="FieldValue.arrayRemove",new n(r)},n.increment=function(t){var e=function(t){return new fu("increment",t)}(t);return e.t_="FieldValue.increment",new n(e)},n.prototype.isEqual=function(t){return this.u_.isEqual(t.u_)},n}(pu),aa={Firestore:Bu,GeoPoint:lu,Timestamp:F,Blob:P,Transaction:zu,WriteBatch:Ku,DocumentReference:Hu,DocumentSnapshot:Xu,Query:ta,QueryDocumentSnapshot:Yu,QuerySnapshot:ea,CollectionReference:na,FieldPath:ru,FieldValue:ua,setLogLevel:function(t){var e;e=t,d.setLogLevel(e)},CACHE_SIZE_UNLIMITED:Mu};(function(t,e){t.INTERNAL.registerComponent(new f.a("firestore",(function(t){return function(t,e){return new Bu(t,e,new Gu)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},aa)))})(sa=r.a),sa.registerVersion("@firebase/firestore","2.0.0")}).call(this,n(223))},356:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return or})),n.d(e,"b",(function(){return sr})),n.d(e,"c",(function(){return ur})),n.d(e,"d",(function(){return ar})),n.d(e,"e",(function(){return ir}));var r=function(t,b){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,b){t.__proto__=b}||function(t,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(t[p]=b[p])})(t,b)};function o(t){var s="function"==typeof Symbol&&Symbol.iterator,e=s&&t[s],i=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}var g,c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},h=h||{},f=c||self;function l(){}function d(a){var b=typeof a;return"object"!=b?b:a?Array.isArray(a)?"array":b:"null"}function v(a){var b=d(a);return"array"==b||"object"==b&&"number"==typeof a.length}function y(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var m="closure_uid_"+(1e9*Math.random()>>>0),w=0;function I(a,b,t){return a.call.apply(a.bind,arguments)}function E(a,b,t){if(!a)throw Error();if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,e),a.apply(b,t)}}return function(){return a.apply(b,arguments)}}function p(a,b,t){return(p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?I:E).apply(null,arguments)}function _(a,b){var t=Array.prototype.slice.call(arguments,1);return function(){var e=t.slice();return e.push.apply(e,arguments),a.apply(this,e)}}var q=Date.now;function T(a,b){function t(){}t.prototype=b.prototype,a.S=b.prototype,a.prototype=new t,a.prototype.constructor=a}function u(){this.j=this.j,this.i=this.i}u.prototype.j=!1,u.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(a){Object.prototype.hasOwnProperty.call(a,m)&&a[m]||(a[m]=++w)})(this)},u.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var O=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"==typeof a)return"string"!=typeof b||1!=b.length?-1:a.indexOf(b,0);for(var t=0;t<a.length;t++)if(t in a&&a[t]===b)return t;return-1},A=Array.prototype.forEach?function(a,b,t){Array.prototype.forEach.call(a,b,t)}:function(a,b,t){for(var e=a.length,n="string"==typeof a?a.split(""):a,r=0;r<e;r++)r in n&&b.call(t,n[r],r,a)};function N(a){return Array.prototype.concat.apply([],arguments)}function S(a){var b=a.length;if(0<b){for(var t=Array(b),e=0;e<b;e++)t[e]=a[e];return t}return[]}function D(a){return/^[\s\xa0]*$/.test(a)}var j,x=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function k(a,b){return-1!=a.indexOf(b)}function P(a,b){return a<b?-1:a>b?1:0}t:{var L=f.navigator;if(L){var C=L.userAgent;if(C){j=C;break t}}j=""}function V(a,b,t){for(var e in a)b.call(t,a[e],e,a)}function R(a){var b={};for(var t in a)b[t]=a[t];return b}var M="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function U(a,b){for(var t,e,n=1;n<arguments.length;n++){for(t in e=arguments[n])a[t]=e[t];for(var r=0;r<M.length;r++)t=M[r],Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t])}}function F(a){return F[" "](a),a}F[" "]=l;var G,a,B=k(j,"Opera"),z=k(j,"Trident")||k(j,"MSIE"),K=k(j,"Edge"),H=K||z,W=k(j,"Gecko")&&!(k(j.toLowerCase(),"webkit")&&!k(j,"Edge"))&&!(k(j,"Trident")||k(j,"MSIE"))&&!k(j,"Edge"),X=k(j.toLowerCase(),"webkit")&&!k(j,"Edge");function Y(){var a=f.document;return a?a.documentMode:void 0}t:{var Q="",J=(a=j,W?/rv:([^\);]+)(\)|;)/.exec(a):K?/Edge\/([\d\.]+)/.exec(a):z?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):X?/WebKit\/(\S+)/.exec(a):B?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if(J&&(Q=J?J[1]:""),z){var $=Y();if(null!=$&&$>parseFloat(Q)){G=String($);break t}}G=Q}var Z,tt={};function et(a){return function(a,b){var t=tt;return Object.prototype.hasOwnProperty.call(t,a)?t[a]:t[a]=b(a)}(a,(function(){for(var b=0,t=x(String(G)).split("."),e=x(String(a)).split("."),n=Math.max(t.length,e.length),r=0;0==b&&r<n;r++){var o=t[r]||"",c=e[r]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],c=/(\d*)(\D*)(.*)/.exec(c)||["","","",""],0==o[0].length&&0==c[0].length)break;b=P(0==o[1].length?0:parseInt(o[1],10),0==c[1].length?0:parseInt(c[1],10))||P(0==o[2].length,0==c[2].length)||P(o[2],c[2]),o=o[3],c=c[3]}while(0==b)}return 0<=b}))}if(f.document&&z){var nt=Y();Z=nt||(parseInt(G,10)||void 0)}else Z=void 0;var it=Z,ot=!z||9<=Number(it),st=z&&!et("9"),ut=function(){if(!f.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{f.addEventListener("test",l,b),f.removeEventListener("test",l,b)}catch(t){}return a}();function at(a,b){this.type=a,this.a=this.target=b,this.defaultPrevented=!1}function ct(a,b){if(at.call(this,a?a.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,a){var t=this.type=a.type,e=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.a=b,b=a.relatedTarget){if(W){t:{try{F(b.nodeName);var n=!0;break t}catch(t){}n=!1}n||(b=null)}}else"mouseover"==t?b=a.fromElement:"mouseout"==t&&(b=a.toElement);this.relatedTarget=b,e?(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:ht[a.pointerType]||"",this.c=a,a.defaultPrevented&&this.b()}}at.prototype.b=function(){this.defaultPrevented=!0},T(ct,at);var ht={2:"touch",3:"pen",4:"mouse"};ct.prototype.b=function(){ct.S.b.call(this);var a=this.c;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,st)try{(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)&&(a.keyCode=-1)}catch(t){}};var ft="closure_listenable_"+(1e6*Math.random()|0),lt=0;function pt(a,b,t,e,n){this.listener=a,this.proxy=null,this.src=b,this.type=t,this.capture=!!e,this.ca=n,this.key=++lt,this.Y=this.Z=!1}function vt(a){a.Y=!0,a.listener=null,a.proxy=null,a.src=null,a.ca=null}function yt(a){this.src=a,this.a={},this.b=0}function gt(a,b){var t=b.type;if(t in a.a){var e,n=a.a[t],r=O(n,b);(e=0<=r)&&Array.prototype.splice.call(n,r,1),e&&(vt(b),0==a.a[t].length&&(delete a.a[t],a.b--))}}function bt(a,b,t,e){for(var n=0;n<a.length;++n){var r=a[n];if(!r.Y&&r.listener==b&&r.capture==!!t&&r.ca==e)return n}return-1}yt.prototype.add=function(a,b,t,e,n){var r=a.toString();(a=this.a[r])||(a=this.a[r]=[],this.b++);var o=bt(a,b,e,n);return-1<o?(b=a[o],t||(b.Z=!1)):((b=new pt(b,this.src,r,!!e,n)).Z=t,a.push(b)),b};var mt="closure_lm_"+(1e6*Math.random()|0),wt={};function It(a,b,t,e,n){if(e&&e.once)return function t(a,b,e,n,r){if(Array.isArray(b)){for(var o=0;o<b.length;o++)t(a,b[o],e,n,r);return null}return e=Dt(e),a&&a[ft]?a.wa(b,e,y(n)?!!n.capture:!!n,r):Et(a,b,e,!0,n,r)}(a,b,t,e,n);if(Array.isArray(b)){for(var r=0;r<b.length;r++)It(a,b[r],t,e,n);return null}return t=Dt(t),a&&a[ft]?a.va(b,t,y(e)?!!e.capture:!!e,n):Et(a,b,t,!1,e,n)}function Et(a,b,t,e,n,r){if(!b)throw Error("Invalid event type");var o=y(n)?!!n.capture:!!n;if(o&&!ot)return null;var c=Nt(a);if(c||(a[mt]=c=new yt(a)),(t=c.add(b,t,e,o,r)).proxy)return t;if(e=function(){var a=At,b=ot?function(t){return a.call(b.src,b.listener,t)}:function(t){if(!(t=a.call(b.src,b.listener,t)))return t};return b}(),t.proxy=e,e.src=a,e.listener=t,a.addEventListener)ut||(n=o),void 0===n&&(n=!1),a.addEventListener(b.toString(),e,n);else if(a.attachEvent)a.attachEvent(Tt(b.toString()),e);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(e)}return t}function _t(a){if("number"!=typeof a&&a&&!a.Y){var b=a.src;if(b&&b[ft])gt(b.c,a);else{var t=a.type,e=a.proxy;b.removeEventListener?b.removeEventListener(t,e,a.capture):b.detachEvent?b.detachEvent(Tt(t),e):b.addListener&&b.removeListener&&b.removeListener(e),(t=Nt(b))?(gt(t,a),0==t.b&&(t.src=null,b[mt]=null)):vt(a)}}}function Tt(a){return a in wt?wt[a]:wt[a]="on"+a}function Ot(a,b){var t=a.listener,e=a.ca||a.src;return a.Z&&_t(a),t.call(e,b)}function At(a,b){if(a.Y)return!0;if(!ot){if(!b)t:{b=["window","event"];for(var t=f,e=0;e<b.length;e++)if(null==(t=t[b[e]])){b=null;break t}b=t}return Ot(a,b=new ct(b,this))}return Ot(a,new ct(b,this))}function Nt(a){return(a=a[mt])instanceof yt?a:null}var St="__closure_events_fn_"+(1e9*Math.random()>>>0);function Dt(a){return"function"==d(a)?a:(a[St]||(a[St]=function(b){return a.handleEvent(b)}),a[St])}function jt(){u.call(this),this.c=new yt(this),this.J=this,this.C=null}function xt(a,b,t,e){if(!(b=a.c.a[String(b)]))return!0;b=b.concat();for(var n=!0,r=0;r<b.length;++r){var o=b[r];if(o&&!o.Y&&o.capture==t){var c=o.listener,h=o.ca||o.src;o.Z&&gt(a.c,o),n=!1!==c.call(h,e)&&n}}return n&&!e.defaultPrevented}T(jt,u),jt.prototype[ft]=!0,(g=jt.prototype).addEventListener=function(a,b,t,e){It(this,a,b,t,e)},g.removeEventListener=function(a,b,t,e){!function t(a,b,e,n,r){if(Array.isArray(b))for(var o=0;o<b.length;o++)t(a,b[o],e,n,r);else n=y(n)?!!n.capture:!!n,e=Dt(e),a&&a[ft]?(a=a.c,(b=String(b).toString())in a.a&&(-1<(e=bt(o=a.a[b],e,n,r))&&(vt(o[e]),Array.prototype.splice.call(o,e,1),0==o.length&&(delete a.a[b],a.b--)))):a&&(a=Nt(a))&&(b=a.a[b.toString()],a=-1,b&&(a=bt(b,e,n,r)),(e=-1<a?b[a]:null)&&_t(e))}(this,a,b,t,e)},g.dispatchEvent=function(a){var b,t=this.C;if(t)for(b=[];t;t=t.C)b.push(t);t=this.J;var e=a.type||a;if("string"==typeof a)a=new at(a,t);else if(a instanceof at)a.target=a.target||t;else{var n=a;U(a=new at(e,t),n)}if(n=!0,b)for(var r=b.length-1;0<=r;r--){var o=a.a=b[r];n=xt(o,e,!0,a)&&n}if(n=xt(o=a.a=t,e,!0,a)&&n,n=xt(o,e,!1,a)&&n,b)for(r=0;r<b.length;r++)n=xt(o=a.a=b[r],e,!1,a)&&n;return n},g.G=function(){if(jt.S.G.call(this),this.c){var t,a=this.c;for(t in a.a){for(var e=a.a[t],n=0;n<e.length;n++)vt(e[n]);delete a.a[t],a.b--}}this.C=null},g.va=function(a,b,t,e){return this.c.add(String(a),b,!1,t,e)},g.wa=function(a,b,t,e){return this.c.add(String(a),b,!0,t,e)};var kt=f.JSON.stringify;function Pt(){this.b=this.a=null}var Lt,Ct=new(function(){function t(a,b,t){this.f=t,this.c=a,this.g=b,this.b=0,this.a=null}return t.prototype.get=function(){var a;return 0<this.b?(this.b--,a=this.a,this.a=a.next,a.next=null):a=this.c(),a},t}())((function(){return new Rt}),(function(a){a.reset()}),100);function Vt(){var a=Ft,b=null;return a.a&&(b=a.a,a.a=a.a.next,a.a||(a.b=null),b.next=null),b}function Rt(){this.next=this.b=this.a=null}function Mt(a){f.setTimeout((function(){throw a}),0)}function Ut(a,b){Lt||function(){var a=f.Promise.resolve(void 0);Lt=function(){a.then(Gt)}}(),qt||(Lt(),qt=!0),Ft.add(a,b)}Pt.prototype.add=function(a,b){var t=Ct.get();t.set(a,b),this.b?this.b.next=t:this.a=t,this.b=t},Rt.prototype.set=function(a,b){this.a=a,this.b=b,this.next=null},Rt.prototype.reset=function(){this.next=this.b=this.a=null};var qt=!1,Ft=new Pt;function Gt(){for(var a;a=Vt();){try{a.a.call(a.b)}catch(t){Mt(t)}var b=Ct;b.g(a),b.b<b.f&&(b.b++,a.next=b.a,b.a=a)}qt=!1}function Bt(a,b){jt.call(this),this.b=a||1,this.a=b||f,this.f=p(this.Ya,this),this.g=q()}function zt(a){a.aa=!1,a.M&&(a.a.clearTimeout(a.M),a.M=null)}function Kt(a,b,t){if("function"==d(a))t&&(a=p(a,t));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=p(a.handleEvent,a)}return 2147483647<Number(b)?-1:f.setTimeout(a,b||0)}function Ht(a){a.a=Kt((function(){a.a=null,a.c&&(a.c=!1,Ht(a))}),a.h);var b=a.b;a.b=null,a.g.apply(null,b)}T(Bt,jt),(g=Bt.prototype).aa=!1,g.M=null,g.Ya=function(){if(this.aa){var a=q()-this.g;0<a&&a<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-a):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(zt(this),this.start()))}},g.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=q())},g.G=function(){Bt.S.G.call(this),zt(this),delete this.a};var Wt=function(t){function e(a,b,e){var n=t.call(this)||this;return n.g=null!=e?a.bind(e):a,n.h=b,n.b=null,n.c=!1,n.a=null,n}return function(t,b){function e(){this.constructor=t}r(t,b),t.prototype=null===b?Object.create(b):(e.prototype=b.prototype,new e)}(e,t),e.prototype.f=function(a){this.b=arguments,this.a?this.c=!0:Ht(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(f.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(u);function Xt(a){u.call(this),this.b=a,this.a={}}T(Xt,u);var Yt=[];function Qt(a,b,t,e){Array.isArray(t)||(t&&(Yt[0]=t.toString()),t=Yt);for(var n=0;n<t.length;n++){var r=It(b,t[n],e||a.handleEvent,!1,a.b||a);if(!r)break;a.a[r.key]=r}}function Jt(a){V(a.a,(function(b,t){this.a.hasOwnProperty(t)&&_t(b)}),a),a.a={}}function $t(){this.a=!0}function Zt(a,b,t,e){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+function(a,b){if(!a.a)return b;if(!b)return null;try{var t=JSON.parse(b);if(t)for(a=0;a<t.length;a++)if(Array.isArray(t[a])){var e=t[a];if(!(2>e.length)){var n=e[1];if(Array.isArray(n)&&!(1>n.length)){var r=n[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<n.length;o++)n[o]=""}}}return kt(t)}catch(t){return b}}(a,t)+(e?" "+e:"")}))}Xt.prototype.G=function(){Xt.S.G.call(this),Jt(this)},Xt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},$t.prototype.info=function(){};var te=null;function ee(){return te=te||new jt}function ne(a){at.call(this,"serverreachability",a)}function re(a){var b=ee();b.dispatchEvent(new ne(b,a))}function ie(a){at.call(this,"statevent",a)}function oe(a){var b=ee();b.dispatchEvent(new ie(b,a))}function se(a){at.call(this,"timingevent",a)}function ue(a,b){if("function"!=d(a))throw Error("Fn must not be null and must be a function");return f.setTimeout((function(){a()}),b)}T(ne,at),T(ie,at),T(se,at);var ae={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},ce={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function he(){}function fe(a){var b;return(b=a.a)||(b=a.a={}),b}function le(){}he.prototype.a=null;var pe,de={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function ve(){at.call(this,"d")}function ye(){at.call(this,"c")}function ge(){}function be(a,b,t,e){this.g=a,this.c=b,this.f=t,this.T=e||1,this.J=new Xt(this),this.P=me,a=H?125:void 0,this.R=new Bt(a),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}T(ve,at),T(ye,at),T(ge,he),pe=new ge;var me=45e3,we={},Ie={};function Ee(a,b,t){a.H=1,a.i=ze(Me(b)),a.j=t,a.I=!0,_e(a,null)}function _e(a,b){a.u=q(),Ae(a),a.l=Me(a.i);var t=a.l,e=a.T;Array.isArray(e)||(e=[String(e)]),nn(t.b,"t",e),a.D=0,a.a=Qn(a.g,a.g.C?b:null),0<a.O&&(a.F=new Wt(p(a.Ca,a,a.a),a.O)),Qt(a.J,a.a,"readystatechange",a.Wa),b=a.B?R(a.B):{},a.j?(a.m||(a.m="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.a.ba(a.l,a.m,a.j,b)):(a.m="GET",a.a.ba(a.l,a.m,null,b)),re(1),function(a,b,t,e,n,r){a.info((function(){if(a.a)if(r)for(var o="",c=r.split("&"),h=0;h<c.length;h++){var f=c[h].split("=");if(1<f.length){var l=f[0];f=f[1];var d=l.split("_");o=2<=d.length&&"type"==d[1]?o+(l+"=")+f+"&":o+(l+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+e+") [attempt "+n+"]: "+b+"\n"+t+"\n"+o}))}(a.c,a.m,a.l,a.f,a.T,a.j)}function Te(a,b,t){for(var e=!0;!a.A&&a.D<t.length;){var n=Oe(a,t);if(n==Ie){4==b&&(a.h=4,oe(14),e=!1),Zt(a.c,a.f,null,"[Incomplete Response]");break}if(n==we){a.h=4,oe(15),Zt(a.c,a.f,t,"[Invalid Chunk]"),e=!1;break}Zt(a.c,a.f,n,null),xe(a,n)}4==b&&0==t.length&&(a.h=1,oe(16),e=!1),a.b=a.b&&e,e?0<t.length&&!a.W&&(a.W=!0,(b=a.g).a==a&&b.V&&!b.F&&(b.c.info("Great, no buffering proxy detected. Bytes received: "+t.length),Gn(b),b.F=!0)):(Zt(a.c,a.f,t,"[Invalid Chunked Response]"),je(a),De(a))}function Oe(a,b){var t=a.D,e=b.indexOf("\n",t);return-1==e?Ie:(t=Number(b.substring(t,e)),isNaN(t)?we:(e+=1)+t>b.length?Ie:(b=b.substr(e,t),a.D=e+t,b))}function Ae(a){a.U=q()+a.P,Ne(a,a.P)}function Ne(a,b){if(null!=a.o)throw Error("WatchDog timer not null");a.o=ue(p(a.Ua,a),b)}function Se(a){a.o&&(f.clearTimeout(a.o),a.o=null)}function De(a){0==a.g.v||a.A||Kn(a.g,a)}function je(a){Se(a);var b=a.F;b&&"function"==typeof b.ja&&b.ja(),a.F=null,zt(a.R),Jt(a.J),a.a&&(b=a.a,a.a=null,b.abort(),b.ja())}function xe(a,b){try{var t=a.g;if(0!=t.v&&(t.a==a||hn(t.b,a)))if(t.I=a.N,!a.C&&hn(t.b,a)&&3==t.v){try{var e=t.ka.a.parse(b)}catch(t){e=null}if(Array.isArray(e)&&3==e.length){var n=e;if(0==n[0]){t:if(!t.j){if(t.a){if(!(t.a.u+3e3<a.u))break t;zn(t),Pn(t)}Fn(t),oe(18)}}else t.oa=n[1],0<t.oa-t.P&&37500>n[2]&&t.H&&0==t.o&&!t.m&&(t.m=ue(p(t.Ra,t),6e3));if(1>=cn(t.b)&&t.ea){try{t.ea()}catch(t){}t.ea=void 0}}else Wn(t,11)}else if((a.C||t.a==a)&&zn(t),!D(b))for(b=e=t.ka.a.parse(b),e=0;e<b.length;e++)if(n=b[e],t.P=n[0],n=n[1],2==t.v)if("c"==n[0]){t.J=n[1],t.ga=n[2];var r=n[3];null!=r&&(t.ha=r,t.c.info("VER="+t.ha));var o=n[4];null!=o&&(t.pa=o,t.c.info("SVER="+t.pa));var c=n[5];if(null!=c&&"number"==typeof c&&0<c){var h=1.5*c;t.D=h,t.c.info("backChannelRequestTimeoutMs_="+h)}h=t;var f=a.a;if(f){var l=f.a?f.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var d=h.b;!d.a&&(k(l,"spdy")||k(l,"quic")||k(l,"h2"))&&(d.f=d.g,d.a=new Set,d.b&&(fn(d,d.b),d.b=null))}if(h.A){var v=f.a?f.a.getResponseHeader("X-HTTP-Session-Id"):null;v&&(h.na=v,Be(h.B,h.A,v))}}t.v=3,t.f&&t.f.ta(),t.V&&(t.N=q()-a.u,t.c.info("Handshake RTT: "+t.N+"ms"));var y=a;if((h=t).la=Yn(h,h.C?h.ga:null,h.fa),y.C){ln(h.b,y);var m=y,w=h.D;w&&m.setTimeout(w),m.o&&(Se(m),Ae(m)),h.a=y}else qn(h);0<t.g.length&&Vn(t)}else"stop"!=n[0]&&"close"!=n[0]||Wn(t,7);else 3==t.v&&("stop"==n[0]||"close"==n[0]?"stop"==n[0]?Wn(t,7):kn(t):"noop"!=n[0]&&t.f&&t.f.sa(n),t.o=0);re(4)}catch(t){}}function ke(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(v(a)||"string"==typeof a)A(a,b,void 0);else{if(a.L&&"function"==typeof a.L)var t=a.L();else if(a.K&&"function"==typeof a.K)t=void 0;else if(v(a)||"string"==typeof a){t=[];for(var e=a.length,n=0;n<e;n++)t.push(n)}else for(n in t=[],e=0,a)t[e++]=n;n=(e=function(a){if(a.K&&"function"==typeof a.K)return a.K();if("string"==typeof a)return a.split("");if(v(a)){for(var b=[],t=a.length,e=0;e<t;e++)b.push(a[e]);return b}for(e in b=[],t=0,a)b[t++]=a[e];return b}(a)).length;for(var r=0;r<n;r++)b.call(void 0,e[r],t&&t[r],a)}}function Pe(a,b){this.b={},this.a=[],this.c=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var e=0;e<t;e+=2)this.set(arguments[e],arguments[e+1])}else if(a)if(a instanceof Pe)for(t=a.L(),e=0;e<t.length;e++)this.set(t[e],a.get(t[e]));else for(e in a)this.set(e,a[e])}function Le(a){if(a.c!=a.a.length){for(var b=0,t=0;b<a.a.length;){var e=a.a[b];Ce(a.b,e)&&(a.a[t++]=e),b++}a.a.length=t}if(a.c!=a.a.length){var n={};for(t=b=0;b<a.a.length;)Ce(n,e=a.a[b])||(a.a[t++]=e,n[e]=1),b++;a.a.length=t}}function Ce(a,b){return Object.prototype.hasOwnProperty.call(a,b)}(g=be.prototype).setTimeout=function(a){this.P=a},g.Wa=function(a){a=a.target;var b=this.F;b&&3==Sn(a)?b.f():this.Ca(a)},g.Ca=function(a){try{if(a==this.a)t:{var b=Sn(this.a),t=this.a.ua(),e=this.a.X();if(!(3>b||3==b&&!H&&!this.a.$())){this.A||4!=b||7==t||re(8==t||0>=e?3:2),Se(this);var n=this.a.X();this.N=n;var r=this.a.$();if(this.b=200==n,function(a,b,t,e,n,r,o){a.info((function(){return"XMLHTTP RESP ("+e+") [ attempt "+n+"]: "+b+"\n"+t+"\n"+r+" "+o}))}(this.c,this.m,this.l,this.f,this.T,b,n),this.b){if(this.V&&!this.C){e:{if(this.a){var o,c=this.a;if((o=c.a?c.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(o)){var h=o;break e}}h=null}if(!h){this.b=!1,this.h=3,oe(12),je(this),De(this);break t}Zt(this.c,this.f,h,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,xe(this,h)}this.I?(Te(this,b,r),H&&this.b&&3==b&&(Qt(this.J,this.R,"tick",this.Va),this.R.start())):(Zt(this.c,this.f,r,null),xe(this,r)),4==b&&je(this),this.b&&!this.A&&(4==b?Kn(this.g,this):(this.b=!1,Ae(this)))}else 400==n&&0<r.indexOf("Unknown SID")?(this.h=3,oe(12)):(this.h=0,oe(13)),je(this),De(this)}}}catch(t){}},g.Va=function(){if(this.a){var a=Sn(this.a),b=this.a.$();this.D<b.length&&(Se(this),Te(this,a,b),this.b&&4!=a&&Ae(this))}},g.cancel=function(){this.A=!0,je(this)},g.Ua=function(){this.o=null;var a=q();0<=a-this.U?(function(a,b){a.info((function(){return"TIMEOUT: "+b}))}(this.c,this.l),2!=this.H&&(re(3),oe(17)),je(this),this.h=2,De(this)):Ne(this,this.U-a)},(g=Pe.prototype).K=function(){Le(this);for(var a=[],b=0;b<this.a.length;b++)a.push(this.b[this.a[b]]);return a},g.L=function(){return Le(this),this.a.concat()},g.get=function(a,b){return Ce(this.b,a)?this.b[a]:b},g.set=function(a,b){Ce(this.b,a)||(this.c++,this.a.push(a)),this.b[a]=b},g.forEach=function(a,b){for(var t=this.L(),e=0;e<t.length;e++){var n=t[e],r=this.get(n);a.call(b,r,n,this)}};var Ve=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Re(a,b){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,a instanceof Re){this.a=void 0!==b?b:a.a,Ue(this,a.f),this.j=a.j,qe(this,a.c),Fe(this,a.h),this.g=a.g,b=a.b;var t=new Ze;t.c=b.c,b.a&&(t.a=new Pe(b.a),t.b=b.b),Ge(this,t),this.i=a.i}else a&&(t=String(a).match(Ve))?(this.a=!!b,Ue(this,t[1]||"",!0),this.j=Ke(t[2]||""),qe(this,t[3]||"",!0),Fe(this,t[4]),this.g=Ke(t[5]||"",!0),Ge(this,t[6]||"",!0),this.i=Ke(t[7]||"")):(this.a=!!b,this.b=new Ze(null,this.a))}function Me(a){return new Re(a)}function Ue(a,b,t){a.f=t?Ke(b,!0):b,a.f&&(a.f=a.f.replace(/:$/,""))}function qe(a,b,t){a.c=t?Ke(b,!0):b}function Fe(a,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);a.h=b}else a.h=null}function Ge(a,b,t){b instanceof Ze?(a.b=b,function(a,b){b&&!a.f&&(tn(a),a.c=null,a.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(dd(this,e),nn(this,n,t))}),a)),a.f=b}(a.b,a.a)):(t||(b=He(b,Je)),a.b=new Ze(b,a.a))}function Be(a,b,t){a.b.set(b,t)}function ze(a){return Be(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)),a}function Ke(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function He(a,b,t){return"string"==typeof a?(a=encodeURI(a).replace(b,We),t&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function We(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}Re.prototype.toString=function(){var a=[],b=this.f;b&&a.push(He(b,Xe,!0),":");var t=this.c;return(t||"file"==b)&&(a.push("//"),(b=this.j)&&a.push(He(b,Xe,!0),"@"),a.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.h)&&a.push(":",String(t))),(t=this.g)&&(this.c&&"/"!=t.charAt(0)&&a.push("/"),a.push(He(t,"/"==t.charAt(0)?Qe:Ye,!0))),(t=this.b.toString())&&a.push("?",t),(t=this.i)&&a.push("#",He(t,$e)),a.join("")};var Xe=/[#\/\?@]/g,Ye=/[#\?:]/g,Qe=/[#\?]/g,Je=/[#\?@]/g,$e=/#/g;function Ze(a,b){this.b=this.a=null,this.c=a||null,this.f=!!b}function tn(a){a.a||(a.a=new Pe,a.b=0,a.c&&function(a,b){if(a){a=a.split("&");for(var t=0;t<a.length;t++){var e=a[t].indexOf("="),n=null;if(0<=e){var r=a[t].substring(0,e);n=a[t].substring(e+1)}else r=a[t];b(r,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(a.c,(function(b,t){a.add(decodeURIComponent(b.replace(/\+/g," ")),t)})))}function dd(a,b){tn(a),b=rn(a,b),Ce(a.a.b,b)&&(a.c=null,a.b-=a.a.get(b).length,Ce((a=a.a).b,b)&&(delete a.b[b],a.c--,a.a.length>2*a.c&&Le(a)))}function en(a,b){return tn(a),b=rn(a,b),Ce(a.a.b,b)}function nn(a,b,t){dd(a,b),0<t.length&&(a.c=null,a.a.set(rn(a,b),S(t)),a.b+=t.length)}function rn(a,b){return b=String(b),a.f&&(b=b.toLowerCase()),b}function on(a,b){this.b=a,this.a=b}function sn(a){this.g=a||un,f.PerformanceNavigationTiming?a=0<(a=f.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(f.ia&&f.ia.ya&&f.ia.ya()&&f.ia.ya().qb),this.f=a?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(g=Ze.prototype).add=function(a,b){tn(this),this.c=null,a=rn(this,a);var t=this.a.get(a);return t||this.a.set(a,t=[]),t.push(b),this.b+=1,this},g.forEach=function(a,b){tn(this),this.a.forEach((function(t,e){A(t,(function(t){a.call(b,t,e,this)}),this)}),this)},g.L=function(){tn(this);for(var a=this.a.K(),b=this.a.L(),t=[],e=0;e<b.length;e++)for(var n=a[e],r=0;r<n.length;r++)t.push(b[e]);return t},g.K=function(a){tn(this);var b=[];if("string"==typeof a)en(this,a)&&(b=N(b,this.a.get(rn(this,a))));else{a=this.a.K();for(var t=0;t<a.length;t++)b=N(b,a[t])}return b},g.set=function(a,b){return tn(this),this.c=null,en(this,a=rn(this,a))&&(this.b-=this.a.get(a).length),this.a.set(a,[b]),this.b+=1,this},g.get=function(a,b){return a&&0<(a=this.K(a)).length?String(a[0]):b},g.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var a=[],b=this.a.L(),t=0;t<b.length;t++){var e=b[t],n=encodeURIComponent(String(e));e=this.K(e);for(var r=0;r<e.length;r++){var o=n;""!==e[r]&&(o+="="+encodeURIComponent(String(e[r]))),a.push(o)}}return this.c=a.join("&")};var un=10;function an(a){return!!a.b||!!a.a&&a.a.size>=a.f}function cn(a){return a.b?1:a.a?a.a.size:0}function hn(a,b){return a.b?a.b==b:!!a.a&&a.a.has(b)}function fn(a,b){a.a?a.a.add(b):a.b=b}function ln(a,b){a.b&&a.b==b?a.b=null:a.a&&a.a.has(b)&&a.a.delete(b)}function pn(a){var t,e;if(null!=a.b)return a.c.concat(a.b.s);if(null!=a.a&&0!==a.a.size){var b=a.c;try{for(var n=o(a.a.values()),r=n.next();!r.done;r=n.next()){var c=r.value;b=b.concat(c.s)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return b}return S(a.c)}function dn(){}function vn(){this.a=new dn}function yn(a,b,t){var e=t||"";try{ke(a,(function(t,n){var r=t;y(t)&&(r=kt(t)),b.push(e+n+"="+encodeURIComponent(r))}))}catch(t){throw b.push(e+"type="+encodeURIComponent("_badmap")),t}}function gn(a,b,t,e,n){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,n(e)}catch(t){}}sn.prototype.cancel=function(){var t,e;if(this.c=pn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=o(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},dn.prototype.stringify=function(a){return f.JSON.stringify(a,void 0)},dn.prototype.parse=function(a){return f.JSON.parse(a,void 0)};var bn=f.JSON.parse;function mn(a){jt.call(this),this.headers=new Pe,this.H=a||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=wn,this.D=this.F=!1}T(mn,jt);var wn="",In=/^https?$/i,En=["POST","PUT"];function _n(a){return"content-type"==a.toLowerCase()}function td(a,b){a.b=!1,a.a&&(a.g=!0,a.a.abort(),a.g=!1),a.f=b,a.h=5,Tn(a),An(a)}function Tn(a){a.u||(a.u=!0,a.dispatchEvent("complete"),a.dispatchEvent("error"))}function On(a){if(a.b&&void 0!==h&&(!a.s[1]||4!=Sn(a)||2!=a.X()))if(a.l&&4==Sn(a))Kt(a.za,0,a);else if(a.dispatchEvent("readystatechange"),4==Sn(a)){a.b=!1;try{var t,b=a.X();t:switch(b){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}if(!(t=e)){var n;if(n=0===b){var r=String(a.B).match(Ve)[1]||null;if(!r&&f.self&&f.self.location){var o=f.self.location.protocol;r=o.substr(0,o.length-1)}n=!In.test(r?r.toLowerCase():"")}t=n}if(t)a.dispatchEvent("complete"),a.dispatchEvent("success");else{a.h=6;try{var c=2<Sn(a)?a.a.statusText:""}catch(t){c=""}a.f=c+" ["+a.X()+"]",Tn(a)}}finally{An(a)}}}function An(a,b){if(a.a){Nn(a);var t=a.a,e=a.s[0]?l:null;a.a=null,a.s=null,b||a.dispatchEvent("ready");try{t.onreadystatechange=e}catch(t){}}}function Nn(a){a.a&&a.D&&(a.a.ontimeout=null),a.m&&(f.clearTimeout(a.m),a.m=null)}function Sn(a){return a.a?a.a.readyState:0}function Dn(a,b,t){t:{for(e in t){var e=!1;break t}e=!0}e||(t=function(a){var b="";return V(a,(function(t,e){b+=e,b+=":",b+=t,b+="\r\n"})),b}(t),"string"==typeof a?null!=t&&encodeURIComponent(String(t)):Be(a,b,t))}function jn(a,b,t){return t&&t.internalChannelParams&&t.internalChannelParams[a]||b}function xn(a){this.pa=0,this.g=[],this.c=new $t,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=jn("failFast",!1,a),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=jn("baseRetryDelayMs",5e3,a),this.Ma=jn("retryDelaySeedMs",1e4,a),this.Ja=jn("forwardChannelMaxRetries",2,a),this.ma=jn("forwardChannelRequestTimeoutMs",2e4,a),this.Ka=a&&a.g||void 0,this.D=void 0,this.C=a&&a.supportsCrossDomainXhr||!1,this.J="",this.b=new sn(a&&a.concurrentRequestLimit),this.ka=new vn,this.da=a&&a.fastHandshake||!1,this.Ga=a&&a.b||!1,a&&a.f&&(this.c.a=!1),a&&a.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&a&&a.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function kn(a){if(Ln(a),3==a.v){var b=a.R++,t=Me(a.B);Be(t,"SID",a.J),Be(t,"RID",b),Be(t,"TYPE","terminate"),Mn(a,t),(b=new be(a,a.c,b,void 0)).H=2,b.i=ze(Me(t)),t=!1,f.navigator&&f.navigator.sendBeacon&&(t=f.navigator.sendBeacon(b.i.toString(),"")),!t&&f.Image&&((new Image).src=b.i,t=!0),t||(b.a=Qn(b.g,null),b.a.ba(b.i)),b.u=q(),Ae(b)}Xn(a)}function Pn(a){a.a&&(Gn(a),a.a.cancel(),a.a=null)}function Ln(a){Pn(a),a.j&&(f.clearTimeout(a.j),a.j=null),zn(a),a.b.cancel(),a.h&&("number"==typeof a.h&&f.clearTimeout(a.h),a.h=null)}function Cn(a,b){a.g.push(new on(a.La++,b)),3==a.v&&Vn(a)}function Vn(a){an(a.b)||a.h||(a.h=!0,Ut(a.Ba,a),a.u=0)}function Rn(a,b){var t;t=b?b.f:a.R++;var e=Me(a.B);Be(e,"SID",a.J),Be(e,"RID",t),Be(e,"AID",a.P),Mn(a,e),a.i&&a.l&&Dn(e,a.i,a.l),t=new be(a,a.c,t,a.u+1),null===a.i&&(t.B=a.l),b&&(a.g=b.s.concat(a.g)),b=Un(a,t,1e3),t.setTimeout(Math.round(.5*a.ma)+Math.round(.5*a.ma*Math.random())),fn(a.b,t),Ee(t,e,b)}function Mn(a,b){a.f&&ke({},(function(t,e){Be(b,e,t)}))}function Un(a,b,t){t=Math.min(a.g.length,t);var e=a.f?p(a.f.Ha,a.f,a):null;t:for(var n=a.g,r=-1;;){var o=["count="+t];-1==r?0<t?(r=n[0].b,o.push("ofs="+r)):r=0:o.push("ofs="+r);for(var c=!0,h=0;h<t;h++){var f=n[h].b,l=n[h].a;if(0>(f-=r))r=Math.max(0,n[h].b-100),c=!1;else try{yn(l,o,"req"+f+"_")}catch(t){e&&e(l)}}if(c){e=o.join("&");break t}}return a=a.g.splice(0,t),b.s=a,e}function qn(a){a.a||a.j||(a.U=1,Ut(a.Aa,a),a.o=0)}function Fn(a){return!(a.a||a.j||3<=a.o)&&(a.U++,a.j=ue(p(a.Aa,a),Hn(a,a.o)),a.o++,!0)}function Gn(a){null!=a.s&&(f.clearTimeout(a.s),a.s=null)}function Bn(a){a.a=new be(a,a.c,"rpc",a.U),null===a.i&&(a.a.B=a.l),a.a.O=0;var b=Me(a.la);Be(b,"RID","rpc"),Be(b,"SID",a.J),Be(b,"CI",a.H?"0":"1"),Be(b,"AID",a.P),Mn(a,b),Be(b,"TYPE","xmlhttp"),a.i&&a.l&&Dn(b,a.i,a.l),a.D&&a.a.setTimeout(a.D);var t=a.a;a=a.ga,t.H=1,t.i=ze(Me(b)),t.j=null,t.I=!0,_e(t,a)}function zn(a){null!=a.m&&(f.clearTimeout(a.m),a.m=null)}function Kn(a,b){var t=null;if(a.a==b){zn(a),Gn(a),a.a=null;var e=2}else{if(!hn(a.b,b))return;t=b.s,ln(a.b,b),e=1}if(a.I=b.N,0!=a.v)if(b.b)if(1==e){t=b.j?b.j.length:0,b=q()-b.u;var n=a.u;(e=ee()).dispatchEvent(new se(e,t,b,n)),Vn(a)}else qn(a);else if(3==(n=b.h)||0==n&&0<a.I||!(1==e&&function(a,b){return!(cn(a.b)>=a.b.f-(a.h?1:0))&&(a.h?(a.g=b.s.concat(a.g),!0):!(1==a.v||2==a.v||a.u>=(a.Ia?0:a.Ja))&&(a.h=ue(p(a.Ba,a,b),Hn(a,a.u)),a.u++,!0))}(a,b)||2==e&&Fn(a)))switch(t&&0<t.length&&(b=a.b,b.c=b.c.concat(t)),n){case 1:Wn(a,5);break;case 4:Wn(a,10);break;case 3:Wn(a,6);break;default:Wn(a,2)}}function Hn(a,b){var t=a.Fa+Math.floor(Math.random()*a.Ma);return a.f||(t*=2),t*b}function Wn(a,b){if(a.c.info("Error code "+b),2==b){var t=null;a.f&&(t=null);var e=p(a.Xa,a);t||(t=new Re("//www.google.com/images/cleardot.gif"),f.location&&"http"==f.location.protocol||Ue(t,"https"),ze(t)),function(a,b){var t=new $t;if(f.Image){var e=new Image;e.onload=_(gn,t,e,"TestLoadImage: loaded",!0,b),e.onerror=_(gn,t,e,"TestLoadImage: error",!1,b),e.onabort=_(gn,t,e,"TestLoadImage: abort",!1,b),e.ontimeout=_(gn,t,e,"TestLoadImage: timeout",!1,b),f.setTimeout((function(){e.ontimeout&&e.ontimeout()}),1e4),e.src=a}else b(!1)}(t.toString(),e)}else oe(2);a.v=0,a.f&&a.f.ra(b),Xn(a),Ln(a)}function Xn(a){a.v=0,a.I=-1,a.f&&(0==pn(a.b).length&&0==a.g.length||(a.b.c.length=0,S(a.g),a.g.length=0),a.f.qa())}function Yn(a,b,t){var e=function(a){return a instanceof Re?Me(a):new Re(a,void 0)}(t);if(""!=e.c)b&&qe(e,b+"."+e.c),Fe(e,e.h);else{var n=f.location;e=function(a,b,t,e){var n=new Re(null,void 0);return a&&Ue(n,a),b&&qe(n,b),t&&Fe(n,t),e&&(n.g=e),n}(n.protocol,b?b+"."+n.hostname:n.hostname,+n.port,t)}return a.W&&V(a.W,(function(t,n){Be(e,n,t)})),b=a.A,t=a.na,b&&t&&Be(e,b,t),Be(e,"VER",a.ha),Mn(a,e),e}function Qn(a,b){if(b&&!a.C)throw Error("Can't create secondary domain capable XhrIo object.");return(b=new mn(a.Ka)).F=a.C,b}function Jn(){}function $n(){if(z&&!(10<=Number(it)))throw Error("Environmental error: no available transport.")}function Zn(a,b){jt.call(this),this.a=new xn(b),this.l=a,this.b=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.a.l=a,a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.a&&(a?a["X-WebChannel-Client-Profile"]=b.a:a={"X-WebChannel-Client-Profile":b.a}),this.a.O=a,(a=b&&b.httpHeadersOverwriteParam)&&!D(a)&&(this.a.i=a),this.h=b&&b.supportsCrossDomainXhr||!1,this.g=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!D(b)&&(this.a.A=b,null!==(a=this.b)&&b in a&&(b in(a=this.b)&&delete a[b])),this.f=new rr(this)}function er(a){ve.call(this);var b=a.__sm__;if(b){t:{for(var t in b){a=t;break t}a=void 0}(this.c=a)?(a=this.c,this.data=null!==b&&a in b?b[a]:void 0):this.data=b}else this.data=a}function nr(){ye.call(this),this.status=1}function rr(a){this.a=a}(g=mn.prototype).ba=function(a,b,t,e){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+a);b=b?b.toUpperCase():"GET",this.B=a,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?fe(this.H):fe(pe),this.a.onreadystatechange=p(this.za,this);try{this.A=!0,this.a.open(b,String(a),!0),this.A=!1}catch(t){return void td(this,t)}a=t||"";var n=new Pe(this.headers);e&&ke(e,(function(t,e){n.set(e,t)})),e=function(a){t:{for(var b=_n,t=a.length,e="string"==typeof a?a.split(""):a,n=0;n<t;n++)if(n in e&&b.call(void 0,e[n],n,a)){b=n;break t}b=-1}return 0>b?null:"string"==typeof a?a.charAt(b):a[b]}(n.L()),t=f.FormData&&a instanceof f.FormData,!(0<=O(En,b))||e||t||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Nn(this),0<this.o&&((this.D=function(a){return z&&et(9)&&"number"==typeof a.timeout&&void 0!==a.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=p(this.xa,this)):this.m=Kt(this.xa,this.o,this)),this.l=!0,this.a.send(a),this.l=!1}catch(t){td(this,t)}},g.xa=function(){void 0!==h&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},g.abort=function(a){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=a||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),An(this))},g.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),An(this,!0)),mn.S.G.call(this)},g.za=function(){this.j||(this.A||this.l||this.g?On(this):this.Ta())},g.Ta=function(){On(this)},g.X=function(){try{return 2<Sn(this)?this.a.status:-1}catch(t){return-1}},g.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},g.Na=function(a){if(this.a){var b=this.a.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),bn(b)}},g.ua=function(){return this.h},g.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(g=xn.prototype).ha=8,g.v=1,g.Ba=function(a){if(this.h)if(this.h=null,1==this.v){if(!a){this.R=Math.floor(1e5*Math.random()),a=this.R++;var t,b=new be(this,this.c,a,void 0),e=this.l;if(this.O&&(e?U(e=R(e),this.O):e=this.O),null===this.i&&(b.B=e),this.da)t:{for(var n=t=0;n<this.g.length;n++){var r=this.g[n];if(void 0===(r="__data__"in r.a&&"string"==typeof(r=r.a.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break t}if(4096===t||n===this.g.length-1){t=n+1;break t}}t=1e3}else t=1e3;t=Un(this,b,t),Be(n=Me(this.B),"RID",a),Be(n,"CVER",22),this.A&&Be(n,"X-HTTP-Session-Id",this.A),Mn(this,n),this.i&&e&&Dn(n,this.i,e),fn(this.b,b),this.Ga&&Be(n,"TYPE","init"),this.da?(Be(n,"$req",t),Be(n,"SID","null"),b.V=!0,Ee(b,n,null)):Ee(b,n,t),this.v=2}}else 3==this.v&&(a?Rn(this,a):0==this.g.length||an(this.b)||Rn(this))},g.Aa=function(){if(this.j=null,Bn(this),this.V&&!(this.F||null==this.a||0>=this.N)){var a=2*this.N;this.c.info("BP detection timer enabled: "+a),this.s=ue(p(this.Sa,this),a)}},g.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Pn(this),Bn(this))},g.Ra=function(){null!=this.m&&(this.m=null,Pn(this),Fn(this),oe(19))},g.Xa=function(a){a?(this.c.info("Successfully pinged google.com"),oe(2)):(this.c.info("Failed to ping google.com"),oe(1))},(g=Jn.prototype).ta=function(){},g.sa=function(){},g.ra=function(){},g.qa=function(){},g.Ha=function(){},$n.prototype.a=function(a,b){return new Zn(a,b)},T(Zn,jt),(g=Zn.prototype).addEventListener=function(a,b,t,e){Zn.S.addEventListener.call(this,a,b,t,e)},g.removeEventListener=function(a,b,t,e){Zn.S.removeEventListener.call(this,a,b,t,e)},g.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var a=this.a,b=this.l,t=this.b||void 0;oe(0),a.fa=b,a.W=t||{},a.H=a.T,a.B=Yn(a,null,a.fa),Vn(a)},g.close=function(){kn(this.a)},g.Pa=function(a){if("string"==typeof a){var b={};b.__data__=a,Cn(this.a,b)}else this.g?((b={}).__data__=kt(a),Cn(this.a,b)):Cn(this.a,a)},g.G=function(){this.a.f=null,delete this.f,kn(this.a),delete this.a,Zn.S.G.call(this)},T(er,ve),T(nr,ye),T(rr,Jn),rr.prototype.ta=function(){this.a.dispatchEvent("a")},rr.prototype.sa=function(a){this.a.dispatchEvent(new er(a))},rr.prototype.ra=function(a){this.a.dispatchEvent(new nr(a))},rr.prototype.qa=function(){this.a.dispatchEvent("b")},$n.prototype.createWebChannel=$n.prototype.a,Zn.prototype.send=Zn.prototype.Pa,Zn.prototype.open=Zn.prototype.Oa,Zn.prototype.close=Zn.prototype.close,ae.NO_ERROR=0,ae.TIMEOUT=8,ae.HTTP_ERROR=6,ce.COMPLETE="complete",le.EventType=de,de.OPEN="a",de.CLOSE="b",de.ERROR="c",de.MESSAGE="d",jt.prototype.listen=jt.prototype.va,mn.prototype.listenOnce=mn.prototype.wa,mn.prototype.getLastError=mn.prototype.Qa,mn.prototype.getLastErrorCode=mn.prototype.ua,mn.prototype.getStatus=mn.prototype.X,mn.prototype.getResponseJson=mn.prototype.Na,mn.prototype.getResponseText=mn.prototype.$,mn.prototype.send=mn.prototype.ba;var ir=function(){return new $n},or=ae,sr=ce,ur=le,ar=mn}).call(this,n(55))},371:function(t,e,n){"use strict";n.r(e);n(355)}}]);